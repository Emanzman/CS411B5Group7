{"ast":null,"code":"import { EJSON, ObjectId } from 'bson';\nimport * as bson from 'bson';\nexport { bson as BSON };\nvar __spreadArray = undefined && undefined.__spreadArray || function (to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n    if (ar || !(i in from)) {\n      if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n      ar[i] = from[i];\n    }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar BrowserInfo = /** @class */function () {\n  function BrowserInfo(name, version, os) {\n    this.name = name;\n    this.version = version;\n    this.os = os;\n    this.type = 'browser';\n  }\n  return BrowserInfo;\n}();\nvar NodeInfo = /** @class */function () {\n  function NodeInfo(version) {\n    this.version = version;\n    this.type = 'node';\n    this.name = 'node';\n    this.os = process.platform;\n  }\n  return NodeInfo;\n}();\nvar SearchBotDeviceInfo = /** @class */function () {\n  function SearchBotDeviceInfo(name, version, os, bot) {\n    this.name = name;\n    this.version = version;\n    this.os = os;\n    this.bot = bot;\n    this.type = 'bot-device';\n  }\n  return SearchBotDeviceInfo;\n}();\nvar BotInfo = /** @class */function () {\n  function BotInfo() {\n    this.type = 'bot';\n    this.bot = true; // NOTE: deprecated test name instead\n    this.name = 'bot';\n    this.version = null;\n    this.os = null;\n  }\n  return BotInfo;\n}();\nvar ReactNativeInfo = /** @class */function () {\n  function ReactNativeInfo() {\n    this.type = 'react-native';\n    this.name = 'react-native';\n    this.version = null;\n    this.os = null;\n  }\n  return ReactNativeInfo;\n}();\n// tslint:disable-next-line:max-line-length\nvar SEARCHBOX_UA_REGEX = /alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/;\nvar SEARCHBOT_OS_REGEX = /(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\\ Jeeves\\/Teoma|ia_archiver)/;\nvar REQUIRED_VERSION_PARTS = 3;\nvar userAgentRules = [['aol', /AOLShield\\/([0-9\\._]+)/], ['edge', /Edge\\/([0-9\\._]+)/], ['edge-ios', /EdgiOS\\/([0-9\\._]+)/], ['yandexbrowser', /YaBrowser\\/([0-9\\._]+)/], ['kakaotalk', /KAKAOTALK\\s([0-9\\.]+)/], ['samsung', /SamsungBrowser\\/([0-9\\.]+)/], ['silk', /\\bSilk\\/([0-9._-]+)\\b/], ['miui', /MiuiBrowser\\/([0-9\\.]+)$/], ['beaker', /BeakerBrowser\\/([0-9\\.]+)/], ['edge-chromium', /EdgA?\\/([0-9\\.]+)/], ['chromium-webview', /(?!Chrom.*OPR)wv\\).*Chrom(?:e|ium)\\/([0-9\\.]+)(:?\\s|$)/], ['chrome', /(?!Chrom.*OPR)Chrom(?:e|ium)\\/([0-9\\.]+)(:?\\s|$)/], ['phantomjs', /PhantomJS\\/([0-9\\.]+)(:?\\s|$)/], ['crios', /CriOS\\/([0-9\\.]+)(:?\\s|$)/], ['firefox', /Firefox\\/([0-9\\.]+)(?:\\s|$)/], ['fxios', /FxiOS\\/([0-9\\.]+)/], ['opera-mini', /Opera Mini.*Version\\/([0-9\\.]+)/], ['opera', /Opera\\/([0-9\\.]+)(?:\\s|$)/], ['opera', /OPR\\/([0-9\\.]+)(:?\\s|$)/], ['ie', /Trident\\/7\\.0.*rv\\:([0-9\\.]+).*\\).*Gecko$/], ['ie', /MSIE\\s([0-9\\.]+);.*Trident\\/[4-7].0/], ['ie', /MSIE\\s(7\\.0)/], ['bb10', /BB10;\\sTouch.*Version\\/([0-9\\.]+)/], ['android', /Android\\s([0-9\\.]+)/], ['ios', /Version\\/([0-9\\._]+).*Mobile.*Safari.*/], ['safari', /Version\\/([0-9\\._]+).*Safari/], ['facebook', /FB[AS]V\\/([0-9\\.]+)/], ['instagram', /Instagram\\s([0-9\\.]+)/], ['ios-webview', /AppleWebKit\\/([0-9\\.]+).*Mobile/], ['ios-webview', /AppleWebKit\\/([0-9\\.]+).*Gecko\\)$/], ['curl', /^curl\\/([0-9\\.]+)$/], ['searchbot', SEARCHBOX_UA_REGEX]];\nvar operatingSystemRules = [['iOS', /iP(hone|od|ad)/], ['Android OS', /Android/], ['BlackBerry OS', /BlackBerry|BB10/], ['Windows Mobile', /IEMobile/], ['Amazon OS', /Kindle/], ['Windows 3.11', /Win16/], ['Windows 95', /(Windows 95)|(Win95)|(Windows_95)/], ['Windows 98', /(Windows 98)|(Win98)/], ['Windows 2000', /(Windows NT 5.0)|(Windows 2000)/], ['Windows XP', /(Windows NT 5.1)|(Windows XP)/], ['Windows Server 2003', /(Windows NT 5.2)/], ['Windows Vista', /(Windows NT 6.0)/], ['Windows 7', /(Windows NT 6.1)/], ['Windows 8', /(Windows NT 6.2)/], ['Windows 8.1', /(Windows NT 6.3)/], ['Windows 10', /(Windows NT 10.0)/], ['Windows ME', /Windows ME/], ['Open BSD', /OpenBSD/], ['Sun OS', /SunOS/], ['Chrome OS', /CrOS/], ['Linux', /(Linux)|(X11)/], ['Mac OS', /(Mac_PowerPC)|(Macintosh)/], ['QNX', /QNX/], ['BeOS', /BeOS/], ['OS/2', /OS\\/2/]];\nfunction detect(userAgent) {\n  if (!!userAgent) {\n    return parseUserAgent(userAgent);\n  }\n  if (typeof document === 'undefined' && typeof navigator !== 'undefined' && navigator.product === 'ReactNative') {\n    return new ReactNativeInfo();\n  }\n  if (typeof navigator !== 'undefined') {\n    return parseUserAgent(navigator.userAgent);\n  }\n  return getNodeVersion();\n}\nfunction matchUserAgent(ua) {\n  // opted for using reduce here rather than Array#first with a regex.test call\n  // this is primarily because using the reduce we only perform the regex\n  // execution once rather than once for the test and for the exec again below\n  // probably something that needs to be benchmarked though\n  return ua !== '' && userAgentRules.reduce(function (matched, _a) {\n    var browser = _a[0],\n      regex = _a[1];\n    if (matched) {\n      return matched;\n    }\n    var uaMatch = regex.exec(ua);\n    return !!uaMatch && [browser, uaMatch];\n  }, false);\n}\nfunction parseUserAgent(ua) {\n  var matchedRule = matchUserAgent(ua);\n  if (!matchedRule) {\n    return null;\n  }\n  var name = matchedRule[0],\n    match = matchedRule[1];\n  if (name === 'searchbot') {\n    return new BotInfo();\n  }\n  // Do not use RegExp for split operation as some browser do not support it (See: http://blog.stevenlevithan.com/archives/cross-browser-split)\n  var versionParts = match[1] && match[1].split('.').join('_').split('_').slice(0, 3);\n  if (versionParts) {\n    if (versionParts.length < REQUIRED_VERSION_PARTS) {\n      versionParts = __spreadArray(__spreadArray([], versionParts, true), createVersionParts(REQUIRED_VERSION_PARTS - versionParts.length), true);\n    }\n  } else {\n    versionParts = [];\n  }\n  var version = versionParts.join('.');\n  var os = detectOS(ua);\n  var searchBotMatch = SEARCHBOT_OS_REGEX.exec(ua);\n  if (searchBotMatch && searchBotMatch[1]) {\n    return new SearchBotDeviceInfo(name, version, os, searchBotMatch[1]);\n  }\n  return new BrowserInfo(name, version, os);\n}\nfunction detectOS(ua) {\n  for (var ii = 0, count = operatingSystemRules.length; ii < count; ii++) {\n    var _a = operatingSystemRules[ii],\n      os = _a[0],\n      regex = _a[1];\n    var match = regex.exec(ua);\n    if (match) {\n      return os;\n    }\n  }\n  return null;\n}\nfunction getNodeVersion() {\n  var isNode = typeof process !== 'undefined' && process.version;\n  return isNode ? new NodeInfo(process.version.slice(1)) : null;\n}\nfunction createVersionParts(count) {\n  var output = [];\n  for (var ii = 0; ii < count; ii++) {\n    output.push('0');\n  }\n  return output;\n}\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\nclass DefaultNetworkTransport {\n  constructor() {\n    if (!DefaultNetworkTransport.fetch) {\n      throw new Error(\"DefaultNetworkTransport.fetch must be set before it's used\");\n    }\n    if (!DefaultNetworkTransport.AbortController) {\n      throw new Error(\"DefaultNetworkTransport.AbortController must be set before it's used\");\n    }\n  }\n  fetchWithCallbacks(request, handler) {\n    // tslint:disable-next-line: no-console\n    this.fetch(request).then(async response => {\n      const decodedBody = await response.text();\n      // Pull out the headers of the response\n      const responseHeaders = {};\n      response.headers.forEach((value, key) => {\n        responseHeaders[key] = value;\n      });\n      return {\n        statusCode: response.status,\n        headers: responseHeaders,\n        body: decodedBody\n      };\n    }).then(r => handler.onSuccess(r)).catch(e => handler.onError(e));\n  }\n  async fetch(request) {\n    const {\n      timeoutMs,\n      url,\n      ...rest\n    } = request;\n    const {\n      signal,\n      cancelTimeout\n    } = this.createTimeoutSignal(timeoutMs);\n    try {\n      // We'll await the response to catch throw our own error\n      return await DefaultNetworkTransport.fetch(url, {\n        signal,\n        ...rest\n      });\n    } finally {\n      // Whatever happens, cancel any timeout\n      cancelTimeout();\n    }\n  }\n  createTimeoutSignal(timeoutMs) {\n    if (typeof timeoutMs === \"number\") {\n      const controller = new DefaultNetworkTransport.AbortController();\n      // Call abort after a specific number of milliseconds\n      const timeout = setTimeout(() => {\n        controller.abort();\n      }, timeoutMs);\n      return {\n        signal: controller.signal,\n        cancelTimeout: () => {\n          clearTimeout(timeout);\n        }\n      };\n    } else {\n      return {\n        signal: undefined,\n        cancelTimeout: () => {\n          /* No-op */\n        }\n      };\n    }\n  }\n}\nDefaultNetworkTransport.DEFAULT_HEADERS = {\n  \"Content-Type\": \"application/json\"\n};\n\n////////////////////////////////////////////////////////////////////////////\nDefaultNetworkTransport.fetch = globalThis.fetch.bind(globalThis);\nDefaultNetworkTransport.AbortController = globalThis.AbortController;\n\n/**\n *  base64.ts\n *\n *  Licensed under the BSD 3-Clause License.\n *    http://opensource.org/licenses/BSD-3-Clause\n *\n *  References:\n *    http://en.wikipedia.org/wiki/Base64\n *\n * @author Dan Kogai (https://github.com/dankogai)\n */\nconst version = '3.7.2';\n/**\n * @deprecated use lowercase `version`.\n */\nconst VERSION = version;\nconst _hasatob = typeof atob === 'function';\nconst _hasbtoa = typeof btoa === 'function';\nconst _hasBuffer = typeof Buffer === 'function';\nconst _TD = typeof TextDecoder === 'function' ? new TextDecoder() : undefined;\nconst _TE = typeof TextEncoder === 'function' ? new TextEncoder() : undefined;\nconst b64ch = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\nconst b64chs = Array.prototype.slice.call(b64ch);\nconst b64tab = (a => {\n  let tab = {};\n  a.forEach((c, i) => tab[c] = i);\n  return tab;\n})(b64chs);\nconst b64re = /^(?:[A-Za-z\\d+\\/]{4})*?(?:[A-Za-z\\d+\\/]{2}(?:==)?|[A-Za-z\\d+\\/]{3}=?)?$/;\nconst _fromCC = String.fromCharCode.bind(String);\nconst _U8Afrom = typeof Uint8Array.from === 'function' ? Uint8Array.from.bind(Uint8Array) : function (it) {\n  let fn = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : x => x;\n  return new Uint8Array(Array.prototype.slice.call(it, 0).map(fn));\n};\nconst _mkUriSafe = src => src.replace(/=/g, '').replace(/[+\\/]/g, m0 => m0 == '+' ? '-' : '_');\nconst _tidyB64 = s => s.replace(/[^A-Za-z0-9\\+\\/]/g, '');\n/**\n * polyfill version of `btoa`\n */\nconst btoaPolyfill = bin => {\n  // console.log('polyfilled');\n  let u32,\n    c0,\n    c1,\n    c2,\n    asc = '';\n  const pad = bin.length % 3;\n  for (let i = 0; i < bin.length;) {\n    if ((c0 = bin.charCodeAt(i++)) > 255 || (c1 = bin.charCodeAt(i++)) > 255 || (c2 = bin.charCodeAt(i++)) > 255) throw new TypeError('invalid character found');\n    u32 = c0 << 16 | c1 << 8 | c2;\n    asc += b64chs[u32 >> 18 & 63] + b64chs[u32 >> 12 & 63] + b64chs[u32 >> 6 & 63] + b64chs[u32 & 63];\n  }\n  return pad ? asc.slice(0, pad - 3) + \"===\".substring(pad) : asc;\n};\n/**\n * does what `window.btoa` of web browsers do.\n * @param {String} bin binary string\n * @returns {string} Base64-encoded string\n */\nconst _btoa = _hasbtoa ? bin => btoa(bin) : _hasBuffer ? bin => Buffer.from(bin, 'binary').toString('base64') : btoaPolyfill;\nconst _fromUint8Array = _hasBuffer ? u8a => Buffer.from(u8a).toString('base64') : u8a => {\n  // cf. https://stackoverflow.com/questions/12710001/how-to-convert-uint8-array-to-base64-encoded-string/12713326#12713326\n  const maxargs = 0x1000;\n  let strs = [];\n  for (let i = 0, l = u8a.length; i < l; i += maxargs) {\n    strs.push(_fromCC.apply(null, u8a.subarray(i, i + maxargs)));\n  }\n  return _btoa(strs.join(''));\n};\n/**\n * converts a Uint8Array to a Base64 string.\n * @param {boolean} [urlsafe] URL-and-filename-safe a la RFC4648 §5\n * @returns {string} Base64 string\n */\nconst fromUint8Array = function (u8a) {\n  let urlsafe = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n  return urlsafe ? _mkUriSafe(_fromUint8Array(u8a)) : _fromUint8Array(u8a);\n};\n// This trick is found broken https://github.com/dankogai/js-base64/issues/130\n// const utob = (src: string) => unescape(encodeURIComponent(src));\n// reverting good old fationed regexp\nconst cb_utob = c => {\n  if (c.length < 2) {\n    var cc = c.charCodeAt(0);\n    return cc < 0x80 ? c : cc < 0x800 ? _fromCC(0xc0 | cc >>> 6) + _fromCC(0x80 | cc & 0x3f) : _fromCC(0xe0 | cc >>> 12 & 0x0f) + _fromCC(0x80 | cc >>> 6 & 0x3f) + _fromCC(0x80 | cc & 0x3f);\n  } else {\n    var cc = 0x10000 + (c.charCodeAt(0) - 0xD800) * 0x400 + (c.charCodeAt(1) - 0xDC00);\n    return _fromCC(0xf0 | cc >>> 18 & 0x07) + _fromCC(0x80 | cc >>> 12 & 0x3f) + _fromCC(0x80 | cc >>> 6 & 0x3f) + _fromCC(0x80 | cc & 0x3f);\n  }\n};\nconst re_utob = /[\\uD800-\\uDBFF][\\uDC00-\\uDFFFF]|[^\\x00-\\x7F]/g;\n/**\n * @deprecated should have been internal use only.\n * @param {string} src UTF-8 string\n * @returns {string} UTF-16 string\n */\nconst utob = u => u.replace(re_utob, cb_utob);\n//\nconst _encode = _hasBuffer ? s => Buffer.from(s, 'utf8').toString('base64') : _TE ? s => _fromUint8Array(_TE.encode(s)) : s => _btoa(utob(s));\n/**\n * converts a UTF-8-encoded string to a Base64 string.\n * @param {boolean} [urlsafe] if `true` make the result URL-safe\n * @returns {string} Base64 string\n */\nconst encode = function (src) {\n  let urlsafe = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n  return urlsafe ? _mkUriSafe(_encode(src)) : _encode(src);\n};\n/**\n * converts a UTF-8-encoded string to URL-safe Base64 RFC4648 §5.\n * @returns {string} Base64 string\n */\nconst encodeURI = src => encode(src, true);\n// This trick is found broken https://github.com/dankogai/js-base64/issues/130\n// const btou = (src: string) => decodeURIComponent(escape(src));\n// reverting good old fationed regexp\nconst re_btou = /[\\xC0-\\xDF][\\x80-\\xBF]|[\\xE0-\\xEF][\\x80-\\xBF]{2}|[\\xF0-\\xF7][\\x80-\\xBF]{3}/g;\nconst cb_btou = cccc => {\n  switch (cccc.length) {\n    case 4:\n      var cp = (0x07 & cccc.charCodeAt(0)) << 18 | (0x3f & cccc.charCodeAt(1)) << 12 | (0x3f & cccc.charCodeAt(2)) << 6 | 0x3f & cccc.charCodeAt(3),\n        offset = cp - 0x10000;\n      return _fromCC((offset >>> 10) + 0xD800) + _fromCC((offset & 0x3FF) + 0xDC00);\n    case 3:\n      return _fromCC((0x0f & cccc.charCodeAt(0)) << 12 | (0x3f & cccc.charCodeAt(1)) << 6 | 0x3f & cccc.charCodeAt(2));\n    default:\n      return _fromCC((0x1f & cccc.charCodeAt(0)) << 6 | 0x3f & cccc.charCodeAt(1));\n  }\n};\n/**\n * @deprecated should have been internal use only.\n * @param {string} src UTF-16 string\n * @returns {string} UTF-8 string\n */\nconst btou = b => b.replace(re_btou, cb_btou);\n/**\n * polyfill version of `atob`\n */\nconst atobPolyfill = asc => {\n  // console.log('polyfilled');\n  asc = asc.replace(/\\s+/g, '');\n  if (!b64re.test(asc)) throw new TypeError('malformed base64.');\n  asc += '=='.slice(2 - (asc.length & 3));\n  let u24,\n    bin = '',\n    r1,\n    r2;\n  for (let i = 0; i < asc.length;) {\n    u24 = b64tab[asc.charAt(i++)] << 18 | b64tab[asc.charAt(i++)] << 12 | (r1 = b64tab[asc.charAt(i++)]) << 6 | (r2 = b64tab[asc.charAt(i++)]);\n    bin += r1 === 64 ? _fromCC(u24 >> 16 & 255) : r2 === 64 ? _fromCC(u24 >> 16 & 255, u24 >> 8 & 255) : _fromCC(u24 >> 16 & 255, u24 >> 8 & 255, u24 & 255);\n  }\n  return bin;\n};\n/**\n * does what `window.atob` of web browsers do.\n * @param {String} asc Base64-encoded string\n * @returns {string} binary string\n */\nconst _atob = _hasatob ? asc => atob(_tidyB64(asc)) : _hasBuffer ? asc => Buffer.from(asc, 'base64').toString('binary') : atobPolyfill;\n//\nconst _toUint8Array = _hasBuffer ? a => _U8Afrom(Buffer.from(a, 'base64')) : a => _U8Afrom(_atob(a), c => c.charCodeAt(0));\n/**\n * converts a Base64 string to a Uint8Array.\n */\nconst toUint8Array = a => _toUint8Array(_unURI(a));\n//\nconst _decode = _hasBuffer ? a => Buffer.from(a, 'base64').toString('utf8') : _TD ? a => _TD.decode(_toUint8Array(a)) : a => btou(_atob(a));\nconst _unURI = a => _tidyB64(a.replace(/[-_]/g, m0 => m0 == '-' ? '+' : '/'));\n/**\n * converts a Base64 string to a UTF-8 string.\n * @param {String} src Base64 string.  Both normal and URL-safe are supported\n * @returns {string} UTF-8 string\n */\nconst decode = src => _decode(_unURI(src));\n/**\n * check if a value is a valid Base64 string\n * @param {String} src a value to check\n  */\nconst isValid = src => {\n  if (typeof src !== 'string') return false;\n  const s = src.replace(/\\s+/g, '').replace(/={0,2}$/, '');\n  return !/[^\\s0-9a-zA-Z\\+/]/.test(s) || !/[^\\s0-9a-zA-Z\\-_]/.test(s);\n};\n//\nconst _noEnum = v => {\n  return {\n    value: v,\n    enumerable: false,\n    writable: true,\n    configurable: true\n  };\n};\n/**\n * extend String.prototype with relevant methods\n */\nconst extendString = function () {\n  const _add = (name, body) => Object.defineProperty(String.prototype, name, _noEnum(body));\n  _add('fromBase64', function () {\n    return decode(this);\n  });\n  _add('toBase64', function (urlsafe) {\n    return encode(this, urlsafe);\n  });\n  _add('toBase64URI', function () {\n    return encode(this, true);\n  });\n  _add('toBase64URL', function () {\n    return encode(this, true);\n  });\n  _add('toUint8Array', function () {\n    return toUint8Array(this);\n  });\n};\n/**\n * extend Uint8Array.prototype with relevant methods\n */\nconst extendUint8Array = function () {\n  const _add = (name, body) => Object.defineProperty(Uint8Array.prototype, name, _noEnum(body));\n  _add('toBase64', function (urlsafe) {\n    return fromUint8Array(this, urlsafe);\n  });\n  _add('toBase64URI', function () {\n    return fromUint8Array(this, true);\n  });\n  _add('toBase64URL', function () {\n    return fromUint8Array(this, true);\n  });\n};\n/**\n * extend Builtin prototypes with relevant methods\n */\nconst extendBuiltins = () => {\n  extendString();\n  extendUint8Array();\n};\nconst gBase64 = {\n  version: version,\n  VERSION: VERSION,\n  atob: _atob,\n  atobPolyfill: atobPolyfill,\n  btoa: _btoa,\n  btoaPolyfill: btoaPolyfill,\n  fromBase64: decode,\n  toBase64: encode,\n  encode: encode,\n  encodeURI: encodeURI,\n  encodeURL: encodeURI,\n  utob: utob,\n  btou: btou,\n  decode: decode,\n  isValid: isValid,\n  fromUint8Array: fromUint8Array,\n  toUint8Array: toUint8Array,\n  extendString: extendString,\n  extendUint8Array: extendUint8Array,\n  extendBuiltins: extendBuiltins\n};\n\n////////////////////////////////////////////////////////////////////////////\nconst SERIALIZATION_OPTIONS = {\n  relaxed: false // Ensure Canonical mode\n};\n/**\n * Serialize an object containing BSON types into extended-JSON.\n *\n * @param obj The object containing BSON types.\n * @returns The document in extended-JSON format.\n */\nfunction serialize(obj) {\n  return EJSON.serialize(obj, SERIALIZATION_OPTIONS);\n}\n/**\n * De-serialize an object or an array of object from extended-JSON into an object or an array of object with BSON types.\n *\n * @param obj The object or array of objects in extended-JSON format.\n * @returns The object or array of objects with inflated BSON types.\n */\nfunction deserialize(obj) {\n  if (Array.isArray(obj)) {\n    return obj.map(doc => EJSON.deserialize(doc));\n  } else {\n    return EJSON.deserialize(obj);\n  }\n}\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * The type of a user.\n */\nvar UserType;\n(function (UserType) {\n  /**\n   * A normal end-user created this user.\n   */\n  UserType[\"Normal\"] = \"normal\";\n  /**\n   * The user was created by the server.\n   */\n  UserType[\"Server\"] = \"server\";\n})(UserType || (UserType = {}));\n/** @ignore */\nvar DataKey;\n(function (DataKey) {\n  /** @ignore */\n  DataKey[\"NAME\"] = \"name\";\n  /** @ignore */\n  DataKey[\"EMAIL\"] = \"email\";\n  /** @ignore */\n  DataKey[\"PICTURE\"] = \"picture\";\n  /** @ignore */\n  DataKey[\"FIRST_NAME\"] = \"first_name\";\n  /** @ignore */\n  DataKey[\"LAST_NAME\"] = \"last_name\";\n  /** @ignore */\n  DataKey[\"GENDER\"] = \"gender\";\n  /** @ignore */\n  DataKey[\"BIRTHDAY\"] = \"birthday\";\n  /** @ignore */\n  DataKey[\"MIN_AGE\"] = \"min_age\";\n  /** @ignore */\n  DataKey[\"MAX_AGE\"] = \"max_age\";\n})(DataKey || (DataKey = {}));\nconst DATA_MAPPING = {\n  [DataKey.NAME]: \"name\",\n  [DataKey.EMAIL]: \"email\",\n  [DataKey.PICTURE]: \"pictureUrl\",\n  [DataKey.FIRST_NAME]: \"firstName\",\n  [DataKey.LAST_NAME]: \"lastName\",\n  [DataKey.GENDER]: \"gender\",\n  [DataKey.BIRTHDAY]: \"birthday\",\n  [DataKey.MIN_AGE]: \"minAge\",\n  [DataKey.MAX_AGE]: \"maxAge\"\n};\n/** @inheritdoc */\nclass UserProfile {\n  /**\n   * @param response The response of a call fetching the users profile.\n   */\n  constructor(response) {\n    /** @ignore */\n    this.type = UserType.Normal;\n    /** @ignore */\n    this.identities = [];\n    if (typeof response === \"object\" && response !== null) {\n      const {\n        type,\n        identities,\n        data\n      } = response;\n      if (typeof type === \"string\") {\n        this.type = type;\n      } else {\n        throw new Error(\"Expected 'type' in the response body\");\n      }\n      if (Array.isArray(identities)) {\n        this.identities = identities.map(identity => {\n          const {\n            id,\n            provider_type: providerType\n          } = identity;\n          return {\n            id,\n            providerType\n          };\n        });\n      } else {\n        throw new Error(\"Expected 'identities' in the response body\");\n      }\n      if (typeof data === \"object\" && data !== null) {\n        const mappedData = Object.fromEntries(Object.entries(data).map(_ref => {\n          let [key, value] = _ref;\n          if (key in DATA_MAPPING) {\n            // Translate any known data field to its JS idiomatic alias\n            return [DATA_MAPPING[key], value];\n          } else {\n            // Pass through any other values\n            return [key, value];\n          }\n        }));\n        // We can use `any` since we trust the user supplies the correct type\n        this.data = deserialize(mappedData);\n      } else {\n        throw new Error(\"Expected 'data' in the response body\");\n      }\n    } else {\n      this.data = {};\n    }\n  }\n}\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\n/**\n * A `Storage` which will prefix a key part to every operation.\n */\nclass PrefixedStorage {\n  /**\n   * Construct a `Storage` which will prefix a key part to every operation.\n   *\n   * @param storage The underlying storage to use for operations.\n   * @param keyPart The part of the key to prefix when performing operations.\n   */\n  constructor(storage, keyPart) {\n    this.storage = storage;\n    this.keyPart = keyPart;\n  }\n  /** @inheritdoc */\n  get(key) {\n    return this.storage.get(this.keyPart + PrefixedStorage.PART_SEPARATOR + key);\n  }\n  /** @inheritdoc */\n  set(key, value) {\n    return this.storage.set(this.keyPart + PrefixedStorage.PART_SEPARATOR + key, value);\n  }\n  /** @inheritdoc */\n  remove(key) {\n    return this.storage.remove(this.keyPart + PrefixedStorage.PART_SEPARATOR + key);\n  }\n  /** @inheritdoc */\n  prefix(keyPart) {\n    return new PrefixedStorage(this, keyPart);\n  }\n  /** @inheritdoc */\n  clear() {\n    let prefix = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"\";\n    return this.storage.clear(this.keyPart + PrefixedStorage.PART_SEPARATOR + prefix);\n  }\n  /** @inheritdoc */\n  addListener(listener) {\n    return this.storage.addListener(listener);\n  }\n  /** @inheritdoc */\n  removeListener(listener) {\n    return this.storage.addListener(listener);\n  }\n}\n/**\n * The string separating two parts.\n */\nPrefixedStorage.PART_SEPARATOR = \":\";\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * In-memory storage that will not be persisted.\n */\nclass MemoryStorage {\n  constructor() {\n    /**\n     * Internal state of the storage.\n     */\n    this.storage = {};\n    /**\n     * A set of listners.\n     */\n    this.listeners = new Set();\n  }\n  /** @inheritdoc */\n  get(key) {\n    if (key in this.storage) {\n      return this.storage[key];\n    } else {\n      return null;\n    }\n  }\n  /** @inheritdoc */\n  set(key, value) {\n    this.storage[key] = value;\n    // Fire the listeners\n    this.fireListeners();\n  }\n  /** @inheritdoc */\n  remove(key) {\n    delete this.storage[key];\n    // Fire the listeners\n    this.fireListeners();\n  }\n  /** @inheritdoc */\n  prefix(keyPart) {\n    return new PrefixedStorage(this, keyPart);\n  }\n  /** @inheritdoc */\n  clear(prefix) {\n    // Iterate all keys and delete their values if they have a matching prefix\n    for (const key of Object.keys(this.storage)) {\n      if (!prefix || key.startsWith(prefix)) {\n        delete this.storage[key];\n      }\n    }\n    // Fire the listeners\n    this.fireListeners();\n  }\n  /** @inheritdoc */\n  addListener(listener) {\n    this.listeners.add(listener);\n  }\n  /** @inheritdoc */\n  removeListener(listener) {\n    this.listeners.delete(listener);\n  }\n  /**\n   * Tell the listeners that a change occurred.\n   */\n  fireListeners() {\n    this.listeners.forEach(listener => listener());\n  }\n}\n\n////////////////////////////////////////////////////////////////////////////\nconst ACCESS_TOKEN_STORAGE_KEY = \"accessToken\";\nconst REFRESH_TOKEN_STORAGE_KEY = \"refreshToken\";\nconst PROFILE_STORAGE_KEY = \"profile\";\nconst PROVIDER_TYPE_STORAGE_KEY = \"providerType\";\n/**\n * Storage specific to the app.\n */\nclass UserStorage extends PrefixedStorage {\n  /**\n   * Construct a storage for a `User`.\n   *\n   * @param storage The underlying storage to wrap.\n   * @param userId The id of the user.\n   */\n  constructor(storage, userId) {\n    super(storage, `user(${userId})`);\n  }\n  /**\n   * Get the access token from storage.\n   *\n   * @returns Access token (null if unknown).\n   */\n  get accessToken() {\n    return this.get(ACCESS_TOKEN_STORAGE_KEY);\n  }\n  /**\n   * Set the access token in storage.\n   *\n   * @param value Access token (null if unknown).\n   */\n  set accessToken(value) {\n    if (value === null) {\n      this.remove(ACCESS_TOKEN_STORAGE_KEY);\n    } else {\n      this.set(ACCESS_TOKEN_STORAGE_KEY, value);\n    }\n  }\n  /**\n   * Get the refresh token from storage.\n   *\n   * @returns Refresh token (null if unknown and user is logged out).\n   */\n  get refreshToken() {\n    return this.get(REFRESH_TOKEN_STORAGE_KEY);\n  }\n  /**\n   * Set the refresh token in storage.\n   *\n   * @param value Refresh token (null if unknown and user is logged out).\n   */\n  set refreshToken(value) {\n    if (value === null) {\n      this.remove(REFRESH_TOKEN_STORAGE_KEY);\n    } else {\n      this.set(REFRESH_TOKEN_STORAGE_KEY, value);\n    }\n  }\n  /**\n   * Get the user profile from storage.\n   *\n   * @returns User profile (undefined if its unknown).\n   */\n  get profile() {\n    const value = this.get(PROFILE_STORAGE_KEY);\n    if (value) {\n      const profile = new UserProfile();\n      // Patch in the values\n      Object.assign(profile, JSON.parse(value));\n      return profile;\n    }\n  }\n  /**\n   * Set the user profile in storage.\n   *\n   * @param value User profile (undefined if its unknown).\n   */\n  set profile(value) {\n    if (value) {\n      this.set(PROFILE_STORAGE_KEY, JSON.stringify(value));\n    } else {\n      this.remove(PROFILE_STORAGE_KEY);\n    }\n  }\n  /**\n   * Get the type of authentication provider used to authenticate\n   *\n   * @returns User profile (undefined if its unknown).\n   */\n  get providerType() {\n    const value = this.get(PROVIDER_TYPE_STORAGE_KEY);\n    if (value) {\n      return value;\n    }\n  }\n  /**\n   * Set the type of authentication provider used to authenticate\n   *\n   * @param value Type of authentication provider.\n   */\n  set providerType(value) {\n    if (value) {\n      this.set(PROVIDER_TYPE_STORAGE_KEY, value);\n    } else {\n      this.remove(PROVIDER_TYPE_STORAGE_KEY);\n    }\n  }\n}\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\n/**\n * @param obj The object to remove keys (and undefined values from)\n * @returns A new object without the keys where the value is undefined.\n */\nfunction removeKeysWithUndefinedValues(obj) {\n  return Object.fromEntries(Object.entries(obj).filter(entry => typeof entry[1] !== \"undefined\"));\n}\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * Generate a random sequence of characters.\n *\n * @param length The length of the string.\n * @param alphabet The alphabet of characters to pick from.\n * @returns A string of characters picked randomly from `alphabet`.\n */\nfunction generateRandomString(length, alphabet) {\n  let result = \"\";\n  for (let i = 0; i < length; i++) {\n    result += alphabet[Math.floor(Math.random() * alphabet.length)];\n  }\n  return result;\n}\n/**\n * Encode an object mapping from string to string, into a query string to be appended a URL.\n *\n * @param params The parameters to include in the string.\n * @param prefixed Should the \"?\" prefix be added if values exists?\n * @returns A URL encoded representation of the parameters (omitting a \"?\" prefix).\n */\nfunction encodeQueryString(params) {\n  let prefixed = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n  // Filter out undefined values\n  const cleanedParams = removeKeysWithUndefinedValues(params);\n  // Determine if a prefixed \"?\" is appropreate\n  const prefix = prefixed && Object.keys(cleanedParams).length > 0 ? \"?\" : \"\";\n  // Transform keys and values to a query string\n  return prefix + Object.entries(cleanedParams).map(_ref2 => {\n    let [k, v] = _ref2;\n    return `${k}=${encodeURIComponent(v)}`;\n  }).join(\"&\");\n}\n/**\n * Decodes a query string into an object.\n *\n * @param str The query string to decode.\n * @returns The decoded query string.\n */\nfunction decodeQueryString(str) {\n  const cleanStr = str[0] === \"?\" ? str.substr(1) : str;\n  return Object.fromEntries(cleanStr.split(\"&\").filter(s => s.length > 0).map(kvp => kvp.split(\"=\")).map(_ref3 => {\n    let [k, v] = _ref3;\n    return [k, decodeURIComponent(v)];\n  }));\n}\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * A list of names that functions cannot have to be callable through the functions proxy.\n */\nconst RESERVED_NAMES = [\"inspect\", \"callFunction\", \"callFunctionStreaming\",\n// Methods defined on the Object.prototype might be \"typeof probed\" and called by libraries and runtime environments.\n...Object.getOwnPropertyNames(Object.prototype)];\n/**\n * Remove the key for any fields with undefined values.\n *\n * @param args The arguments to clean.\n * @returns The cleaned arguments.\n */\nfunction cleanArgs(args) {\n  for (const arg of args) {\n    if (typeof arg === \"object\" && arg) {\n      for (const [key, value] of Object.entries(arg)) {\n        if (value === undefined) {\n          delete arg[key];\n        }\n      }\n    }\n  }\n  return args;\n}\n/**\n * Remove keys for any undefined values and serialize to EJSON.\n *\n * @param args The arguments to clean and serialize.\n * @returns The cleaned and serialized arguments.\n */\nfunction cleanArgsAndSerialize(args) {\n  const cleaned = cleanArgs(args);\n  return cleaned.map(arg => typeof arg === \"object\" ? serialize(arg) : arg);\n}\n/**\n * Defines how functions are called.\n */\nclass FunctionsFactory {\n  /**\n   * @param fetcher The underlying fetcher to use when sending requests.\n   * @param config Additional configuration parameters.\n   */\n  constructor(fetcher) {\n    let config = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    this.fetcher = fetcher;\n    this.serviceName = config.serviceName;\n    this.argsTransformation = config.argsTransformation || cleanArgsAndSerialize;\n  }\n  /**\n   * Create a factory of functions, wrapped in a Proxy that returns bound copies of `callFunction` on any property.\n   *\n   * @param fetcher The underlying fetcher to use when requesting.\n   * @param config Additional configuration parameters.\n   * @returns The newly created factory of functions.\n   */\n  static create(fetcher) {\n    let config = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    // Create a proxy, wrapping a simple object returning methods that calls functions\n    // TODO: Lazily fetch available functions and return these from the ownKeys() trap\n    const factory = new FunctionsFactory(fetcher, config);\n    // Wrap the factory in a proxy that calls the internal call method\n    return new Proxy(factory, {\n      get(target, p, receiver) {\n        if (typeof p === \"string\" && RESERVED_NAMES.indexOf(p) === -1) {\n          return target.callFunction.bind(target, p);\n        } else {\n          const prop = Reflect.get(target, p, receiver);\n          return typeof prop === \"function\" ? prop.bind(target) : prop;\n        }\n      }\n    });\n  }\n  /**\n   * Call a remote function by it's name.\n   *\n   * @param name Name of the remote function.\n   * @param args Arguments to pass to the remote function.\n   * @returns A promise of the value returned when executing the remote function.\n   */\n  async callFunction(name) {\n    for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      args[_key - 1] = arguments[_key];\n    }\n    // See https://github.com/mongodb/stitch-js-sdk/blob/master/packages/core/sdk/src/services/internal/CoreStitchServiceClientImpl.ts\n    const body = {\n      name,\n      arguments: this.argsTransformation ? this.argsTransformation(args) : args\n    };\n    if (this.serviceName) {\n      body.service = this.serviceName;\n    }\n    const appRoute = this.fetcher.appRoute;\n    return this.fetcher.fetchJSON({\n      method: \"POST\",\n      path: appRoute.functionsCall().path,\n      body\n    });\n  }\n  /**\n   * Call a remote function by it's name.\n   *\n   * @param name Name of the remote function.\n   * @param args Arguments to pass to the remote function.\n   * @returns A promise of the value returned when executing the remote function.\n   */\n  callFunctionStreaming(name) {\n    for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n      args[_key2 - 1] = arguments[_key2];\n    }\n    const body = {\n      name,\n      arguments: this.argsTransformation ? this.argsTransformation(args) : args\n    };\n    if (this.serviceName) {\n      body.service = this.serviceName;\n    }\n    const appRoute = this.fetcher.appRoute;\n    const qs = encodeQueryString({\n      [\"baas_request\"]: gBase64.encode(JSON.stringify(body))\n    });\n    return this.fetcher.fetchStream({\n      method: \"GET\",\n      path: appRoute.functionsCall().path + qs\n    });\n  }\n}\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2021 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\n/**\n * Check whether the user's app is running in \"development mode\" (e.g. `npm run dev`\n * for a React app, or `NODE_ENV=development` for a Node app). Each platform's entry\n * point should define the value of this using `setIsDevelopmentMode`.\n * The default behaviour is to always return `false`.\n *\n * @returns true if the user's app is running in development mode, false otherwise\n */\nlet isDevelopmentMode = false;\n/**\n * Set the value of `isDevelopmentMode`. This allows each entry point (node vs DOM)\n * to use its own method for determining whether we are in development mode.\n *\n * @param state A boolean indicating whether the user's app is running in\n * development mode or not.\n */\nconst setIsDevelopmentMode = state => {\n  isDevelopmentMode = state;\n};\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * Display a deprecation warning for features being removed in the next major version\n * to users in development mode (as best as we can detect this, see `isDevelopmentMode`)\n *\n * @param deprecatedItem The method signature or name of the deprecated item\n * @param suggestedReplacement The method signature or name of the suggested replacement\n */\nconst deprecationWarning = (deprecatedItem, suggestedReplacement) => {\n  if (!isDevelopmentMode) return;\n  console.warn(`Deprecation warning from Realm: ${deprecatedItem} is deprecated and will be removed in a future major release. Consider switching to ${suggestedReplacement}.`);\n};\n/**\n * Helper function for migrating from positional arguments to a single dictionary argument.\n * Check the arguments passed to a function, if the first argument is not an object (i.e. it\n * is presumed to be a deprecated positional-style call), shows a deprecation warning and\n * converts the positional arguments into an object matching the expected \"new\" shape.\n *\n * @param args Array of arguments passed to the function (captured with `...args`).\n * @param methodName The name of the method, used to show the deprecation warning.\n * @param argNames The list of positional argument names, used to covert them into\n * an object if a deprecated call is made and to show the deprecation warning.\n * @param hasRestArgs Optional flag indicating that the function's final argument is\n * `...args` (to capture any extra arguments), in which case we capture them and return\n * as the second element of the return array.\n *\n * @returns An object containing:\n *\n * argsObject: a dictionary of function arguments, either passed through from args[0] if\n * args[0] is an object, or created from `args` and `argNames` if the args are a\n * deprecated positional argument call.\n *\n * restArgs: an array of the \"...args\" passed to the function if `hasRestArgs` is true;\n * otherwise it is `undefined`.\n */\n// Allow use of `object` type\n// eslint-disable-next-line @typescript-eslint/ban-types\nconst handleDeprecatedPositionalArgs = (args, methodName, argNames, hasRestArgs) => {\n  if (typeof args[0] !== \"object\") {\n    const restArgsText = hasRestArgs ? \", ...args\" : \"\";\n    deprecationWarning(`${methodName}(${argNames.join(\", \")}${restArgsText})`, `${methodName}({ ${argNames.join(\", \")} }${restArgsText})`);\n    // Convert the array of arguments into a dictionary keyed by the relevant argName\n    const argsObject = argNames.reduce((prev, argName, index) => {\n      return {\n        ...prev,\n        [argName]: args[index]\n      };\n    }, {});\n    const restArgs = hasRestArgs ? args.slice(argNames.length) : undefined;\n    return {\n      argsObject,\n      restArgs\n    };\n  }\n  return {\n    argsObject: args[0],\n    restArgs: hasRestArgs ? args.slice(1) : undefined\n  };\n};\n\n////////////////////////////////////////////////////////////////////////////\n// React/React Native set a global __DEV__ variable when running in dev mode\nsetIsDevelopmentMode(typeof __DEV__ !== \"undefined\" && __DEV__);\n\n////////////////////////////////////////////////////////////////////////////\n/** @inheritdoc */\nclass EmailPasswordAuth {\n  /**\n   * Construct an interface to the email / password authentication provider.\n   *\n   * @param fetcher The underlying fetcher used to request the services.\n   * @param providerName Optional custom name of the authentication provider.\n   */\n  constructor(fetcher) {\n    let providerName = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"local-userpass\";\n    this.fetcher = fetcher;\n    this.providerName = providerName;\n  }\n  async registerUser() {\n    for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n      args[_key3] = arguments[_key3];\n    }\n    const {\n      argsObject: userDetails\n    } = handleDeprecatedPositionalArgs(args, \"registerUser\", [\"email\", \"password\"]);\n    const appRoute = this.fetcher.appRoute;\n    await this.fetcher.fetchJSON({\n      method: \"POST\",\n      path: appRoute.emailPasswordAuth(this.providerName).register().path,\n      body: userDetails\n    });\n  }\n  async confirmUser() {\n    for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n      args[_key4] = arguments[_key4];\n    }\n    const {\n      argsObject: tokenDetails\n    } = handleDeprecatedPositionalArgs(args, \"confirmUser\", [\"token\", \"tokenId\"]);\n    const appRoute = this.fetcher.appRoute;\n    await this.fetcher.fetchJSON({\n      method: \"POST\",\n      path: appRoute.emailPasswordAuth(this.providerName).confirm().path,\n      body: tokenDetails\n    });\n  }\n  async resendConfirmationEmail() {\n    for (var _len5 = arguments.length, args = new Array(_len5), _key5 = 0; _key5 < _len5; _key5++) {\n      args[_key5] = arguments[_key5];\n    }\n    const {\n      argsObject: emailDetails\n    } = handleDeprecatedPositionalArgs(args, \"resendConfirmationEmail\", [\"email\"]);\n    const appRoute = this.fetcher.appRoute;\n    await this.fetcher.fetchJSON({\n      method: \"POST\",\n      path: appRoute.emailPasswordAuth(this.providerName).confirmSend().path,\n      body: emailDetails\n    });\n  }\n  async retryCustomConfirmation() {\n    for (var _len6 = arguments.length, args = new Array(_len6), _key6 = 0; _key6 < _len6; _key6++) {\n      args[_key6] = arguments[_key6];\n    }\n    const {\n      argsObject: emailDetails\n    } = handleDeprecatedPositionalArgs(args, \"retryCustomConfirmation\", [\"email\"]);\n    const appRoute = this.fetcher.appRoute;\n    await this.fetcher.fetchJSON({\n      method: \"POST\",\n      path: appRoute.emailPasswordAuth(this.providerName).confirmCall().path,\n      body: emailDetails\n    });\n  }\n  async resetPassword() {\n    for (var _len7 = arguments.length, args = new Array(_len7), _key7 = 0; _key7 < _len7; _key7++) {\n      args[_key7] = arguments[_key7];\n    }\n    const {\n      argsObject: resetDetails\n    } = handleDeprecatedPositionalArgs(args, \"resetPassword\", [\"token\", \"tokenId\", \"password\"]);\n    const appRoute = this.fetcher.appRoute;\n    await this.fetcher.fetchJSON({\n      method: \"POST\",\n      path: appRoute.emailPasswordAuth(this.providerName).reset().path,\n      body: resetDetails\n    });\n  }\n  async sendResetPasswordEmail() {\n    for (var _len8 = arguments.length, args = new Array(_len8), _key8 = 0; _key8 < _len8; _key8++) {\n      args[_key8] = arguments[_key8];\n    }\n    const {\n      argsObject: emailDetails\n    } = handleDeprecatedPositionalArgs(args, \"sendResetPasswordEmail\", [\"email\"]);\n    const appRoute = this.fetcher.appRoute;\n    await this.fetcher.fetchJSON({\n      method: \"POST\",\n      path: appRoute.emailPasswordAuth(this.providerName).resetSend().path,\n      body: emailDetails\n    });\n  }\n  async callResetPasswordFunction() {\n    for (var _len9 = arguments.length, args = new Array(_len9), _key9 = 0; _key9 < _len9; _key9++) {\n      args[_key9] = arguments[_key9];\n    }\n    const {\n      argsObject: resetDetails,\n      restArgs\n    } = handleDeprecatedPositionalArgs(args, \"callResetPasswordFunction\", [\"email\", \"password\"], true);\n    const appRoute = this.fetcher.appRoute;\n    await this.fetcher.fetchJSON({\n      method: \"POST\",\n      path: appRoute.emailPasswordAuth(this.providerName).resetCall().path,\n      body: {\n        ...resetDetails,\n        arguments: restArgs\n      }\n    });\n  }\n}\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\n/**\n * @returns The base api route.\n */\nfunction api() {\n  return {\n    path: \"/api/client/v2.0\",\n    /**\n     * @param appId The id of the app.\n     * @returns The URL of the app endpoint.\n     */\n    app(appId) {\n      return {\n        path: this.path + `/app/${appId}`,\n        /**\n         * @returns The URL of the app location endpoint.\n         */\n        location() {\n          return {\n            path: this.path + \"/location\"\n          };\n        },\n        /**\n         * @param providerName The name of the provider.\n         * @returns The app url concatinated with the /auth/providers/{providerName}\n         */\n        authProvider(providerName) {\n          return {\n            path: this.path + `/auth/providers/${providerName}`,\n            /**\n             * @returns Get the URL of an authentication provider.\n             */\n            login() {\n              return {\n                path: this.path + \"/login\"\n              };\n            }\n          };\n        },\n        /**\n         * @param providerName The name of the provider.\n         * @returns The app url concatinated with the /auth/providers/{providerName}\n         */\n        emailPasswordAuth(providerName) {\n          const authProviderRoutes = this.authProvider(providerName);\n          return {\n            ...authProviderRoutes,\n            register() {\n              return {\n                path: this.path + \"/register\"\n              };\n            },\n            confirm() {\n              return {\n                path: this.path + \"/confirm\"\n              };\n            },\n            confirmSend() {\n              return {\n                path: this.path + \"/confirm/send\"\n              };\n            },\n            confirmCall() {\n              return {\n                path: this.path + \"/confirm/call\"\n              };\n            },\n            reset() {\n              return {\n                path: this.path + \"/reset\"\n              };\n            },\n            resetSend() {\n              return {\n                path: this.path + \"/reset/send\"\n              };\n            },\n            resetCall() {\n              return {\n                path: this.path + \"/reset/call\"\n              };\n            }\n          };\n        },\n        functionsCall() {\n          return {\n            path: this.path + \"/functions/call\"\n          };\n        }\n      };\n    },\n    auth() {\n      return {\n        path: this.path + \"/auth\",\n        apiKeys() {\n          return {\n            path: this.path + \"/api_keys\",\n            key(id) {\n              return {\n                path: this.path + `/${id}`,\n                enable() {\n                  return {\n                    path: this.path + \"/enable\"\n                  };\n                },\n                disable() {\n                  return {\n                    path: this.path + \"/disable\"\n                  };\n                }\n              };\n            }\n          };\n        },\n        profile() {\n          return {\n            path: this.path + \"/profile\"\n          };\n        },\n        session() {\n          return {\n            path: this.path + \"/session\"\n          };\n        }\n      };\n    }\n  };\n}\nvar routes = {\n  api\n};\n\n////////////////////////////////////////////////////////////////////////////\n/** @inheritdoc */\nclass ApiKeyAuth {\n  /**\n   * Construct an interface to the API-key authentication provider.\n   *\n   * @param fetcher The fetcher used to send requests to services.\n   */\n  constructor(fetcher) {\n    this.fetcher = fetcher;\n  }\n  /** @inheritdoc */\n  create(name) {\n    return this.fetcher.fetchJSON({\n      method: \"POST\",\n      body: {\n        name\n      },\n      path: routes.api().auth().apiKeys().path,\n      tokenType: \"refresh\"\n    });\n  }\n  /** @inheritdoc */\n  fetch(keyId) {\n    return this.fetcher.fetchJSON({\n      method: \"GET\",\n      path: routes.api().auth().apiKeys().key(keyId).path,\n      tokenType: \"refresh\"\n    });\n  }\n  /** @inheritdoc */\n  fetchAll() {\n    return this.fetcher.fetchJSON({\n      method: \"GET\",\n      tokenType: \"refresh\",\n      path: routes.api().auth().apiKeys().path\n    });\n  }\n  /** @inheritdoc */\n  async delete(keyId) {\n    await this.fetcher.fetchJSON({\n      method: \"DELETE\",\n      path: routes.api().auth().apiKeys().key(keyId).path,\n      tokenType: \"refresh\"\n    });\n  }\n  /** @inheritdoc */\n  async enable(keyId) {\n    await this.fetcher.fetchJSON({\n      method: \"PUT\",\n      path: routes.api().auth().apiKeys().key(keyId).enable().path,\n      tokenType: \"refresh\"\n    });\n  }\n  /** @inheritdoc */\n  async disable(keyId) {\n    await this.fetcher.fetchJSON({\n      method: \"PUT\",\n      path: routes.api().auth().apiKeys().key(keyId).disable().path,\n      tokenType: \"refresh\"\n    });\n  }\n}\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\nlet environment = null;\n/**\n * Set the environment of execution.\n * Note: This should be called as the first thing before executing any code which calls getEnvironment()\n *\n * @param e An object containing environment specific implementations.\n */\nfunction setEnvironment(e) {\n  environment = e;\n}\n/**\n * Get the environment of execution.\n *\n * @returns An object containing environment specific implementations.\n */\nfunction getEnvironment() {\n  if (environment) {\n    return environment;\n  } else {\n    throw new Error(\"Cannot get environment before it's set\");\n  }\n}\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\n/**\n * An error occured during the parsing of a watch stream.\n */\nclass WatchError extends Error {\n  constructor(_ref4) {\n    let {\n      message,\n      code\n    } = _ref4;\n    super(message);\n    /**\n     * The name of this type of error\n     */\n    this.name = \"WatchError\";\n    this.code = code;\n  }\n}\n\n////////////////////////////////////////////////////////////////////////////\n// NOTE: this is a fully processed event, not a single \"data: foo\" line!\n/**\n * The state of a WatchStream.\n */\nvar WatchStreamState;\n(function (WatchStreamState) {\n  /**\n   * Need to call one of the feed functions.\n   */\n  WatchStreamState[\"NEED_DATA\"] = \"NEED_DATA\";\n  /**\n   * Call nextEvent() to consume an event.\n   */\n  WatchStreamState[\"HAVE_EVENT\"] = \"HAVE_EVENT\";\n  /**\n   * Call error().\n   */\n  WatchStreamState[\"HAVE_ERROR\"] = \"HAVE_ERROR\";\n})(WatchStreamState || (WatchStreamState = {}));\n/**\n * Represents a stream of events\n */\nclass WatchStream {\n  constructor() {\n    this._state = WatchStreamState.NEED_DATA;\n    this._error = null;\n    // Used by feedBuffer to construct lines\n    this._textDecoder = new (getEnvironment().TextDecoder)();\n    this._buffer = \"\";\n    this._bufferOffset = 0;\n    // Used by feedLine for building the next SSE\n    this._eventType = \"\";\n    this._dataBuffer = \"\";\n  }\n  // Call these when you have data, in whatever shape is easiest for your SDK to get.\n  // Pick one, mixing and matching on a single instance isn't supported.\n  // These can only be called in NEED_DATA state, which is the initial state.\n  feedBuffer(buffer) {\n    this.assertState(WatchStreamState.NEED_DATA);\n    this._buffer += this._textDecoder.decode(buffer, {\n      stream: true\n    });\n    this.advanceBufferState();\n  }\n  feedLine(line) {\n    this.assertState(WatchStreamState.NEED_DATA);\n    // This is an implementation of the algorithm described at\n    // https://html.spec.whatwg.org/multipage/server-sent-events.html#event-stream-interpretation.\n    // Currently the server does not use id or retry lines, so that processing isn't implemented.\n    // ignore trailing LF if not removed by SDK.\n    if (line.endsWith(\"\\n\")) line = line.substr(0, line.length - 1);\n    // ignore trailing CR from CRLF\n    if (line.endsWith(\"\\r\")) line = line.substr(0, line.length - 1);\n    if (line.length === 0) {\n      // This is the \"dispatch the event\" portion of the algorithm.\n      if (this._dataBuffer.length === 0) {\n        this._eventType = \"\";\n        return;\n      }\n      if (this._dataBuffer.endsWith(\"\\n\")) this._dataBuffer = this._dataBuffer.substr(0, this._dataBuffer.length - 1);\n      this.feedSse({\n        data: this._dataBuffer,\n        eventType: this._eventType\n      });\n      this._dataBuffer = \"\";\n      this._eventType = \"\";\n    }\n    if (line[0] === \":\") return;\n    const colon = line.indexOf(\":\");\n    const field = line.substr(0, colon);\n    let value = colon === -1 ? \"\" : line.substr(colon + 1);\n    if (value.startsWith(\" \")) value = value.substr(1);\n    if (field === \"event\") {\n      this._eventType = value;\n    } else if (field === \"data\") {\n      this._dataBuffer += value;\n      this._dataBuffer += \"\\n\";\n    } else ;\n  }\n  feedSse(sse) {\n    this.assertState(WatchStreamState.NEED_DATA);\n    const firstPercentIndex = sse.data.indexOf(\"%\");\n    if (firstPercentIndex !== -1) {\n      // For some reason, the stich server decided to add percent-encoding for '%', '\\n', and '\\r' to its\n      // event-stream replies. But it isn't real urlencoding, since most characters pass through, so we can't use\n      // uri_percent_decode() here.\n      let buffer = \"\";\n      let start = 0;\n      for (let percentIndex = firstPercentIndex; percentIndex !== -1; percentIndex = sse.data.indexOf(\"%\", start)) {\n        buffer += sse.data.substr(start, percentIndex - start);\n        const encoded = sse.data.substr(percentIndex, 3); // may be smaller than 3 if string ends with %\n        if (encoded === \"%25\") {\n          buffer += \"%\";\n        } else if (encoded === \"%0A\") {\n          buffer += \"\\x0A\"; // '\\n'\n        } else if (encoded === \"%0D\") {\n          buffer += \"\\x0D\"; // '\\r'\n        } else {\n          buffer += encoded; // propagate as-is\n        }\n\n        start = percentIndex + encoded.length;\n      }\n      // Advance the buffer with the last part\n      buffer += sse.data.substr(start);\n      sse.data = buffer;\n    }\n    if (!sse.eventType || sse.eventType === \"message\") {\n      try {\n        const parsed = EJSON.parse(sse.data);\n        if (typeof parsed === \"object\") {\n          // ???\n          this._nextEvent = parsed;\n          this._state = WatchStreamState.HAVE_EVENT;\n          return;\n        }\n      } catch {\n        // fallthrough to same handling as for non-document value.\n      }\n      this._state = WatchStreamState.HAVE_ERROR;\n      this._error = new WatchError({\n        message: \"server returned malformed event: \" + sse.data,\n        code: \"bad bson parse\"\n      });\n    } else if (sse.eventType === \"error\") {\n      this._state = WatchStreamState.HAVE_ERROR;\n      // default error message if we have issues parsing the reply.\n      this._error = new WatchError({\n        message: sse.data,\n        code: \"unknown\"\n      });\n      try {\n        const {\n          error_code: errorCode,\n          error\n        } = EJSON.parse(sse.data);\n        if (typeof errorCode !== \"string\") return;\n        if (typeof error !== \"string\") return;\n        // XXX in realm-js, object-store will error if the error_code is not one of the known\n        // error code enum values.\n        this._error = new WatchError({\n          message: error,\n          code: errorCode\n        });\n      } catch {\n        return; // Use the default state.\n      }\n    } else ;\n  }\n  get state() {\n    return this._state;\n  }\n  // Consumes the returned event. If you used feedBuffer(), there may be another event or error after this one,\n  // so you need to call state() again to see what to do next.\n  nextEvent() {\n    this.assertState(WatchStreamState.HAVE_EVENT);\n    // We can use \"as ChangeEvent<T>\" since we just asserted the state.\n    const out = this._nextEvent;\n    this._state = WatchStreamState.NEED_DATA;\n    this.advanceBufferState();\n    return out;\n  }\n  // Once this enters the error state, it stays that way. You should not feed any more data.\n  get error() {\n    return this._error;\n  }\n  ////////////////////////////////////////////\n  advanceBufferState() {\n    this.assertState(WatchStreamState.NEED_DATA);\n    while (this.state === WatchStreamState.NEED_DATA) {\n      if (this._bufferOffset === this._buffer.length) {\n        this._buffer = \"\";\n        this._bufferOffset = 0;\n        return;\n      }\n      // NOTE not supporting CR-only newlines, just LF and CRLF.\n      const nextNewlineIndex = this._buffer.indexOf(\"\\n\", this._bufferOffset);\n      if (nextNewlineIndex === -1) {\n        // We have a partial line.\n        if (this._bufferOffset !== 0) {\n          // Slide the partial line down to the front of the buffer.\n          this._buffer = this._buffer.substr(this._bufferOffset, this._buffer.length - this._bufferOffset);\n          this._bufferOffset = 0;\n        }\n        return;\n      }\n      this.feedLine(this._buffer.substr(this._bufferOffset, nextNewlineIndex - this._bufferOffset));\n      this._bufferOffset = nextNewlineIndex + 1; // Advance past this line, including its newline.\n    }\n  }\n\n  assertState(state) {\n    if (this._state !== state) {\n      throw Error(`Expected WatchStream to be in state ${state}, but in state ${this._state}`);\n    }\n  }\n}\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * A remote collection of documents.\n */\nclass MongoDBCollection {\n  /**\n   * Construct a remote collection of documents.\n   *\n   * @param fetcher The fetcher to use when requesting the service.\n   * @param serviceName The name of the remote service.\n   * @param databaseName The name of the database.\n   * @param collectionName The name of the remote collection.\n   */\n  constructor(fetcher, serviceName, databaseName, collectionName) {\n    this.functions = FunctionsFactory.create(fetcher, {\n      serviceName\n    });\n    this.databaseName = databaseName;\n    this.collectionName = collectionName;\n    this.serviceName = serviceName;\n    this.fetcher = fetcher;\n  }\n  /** @inheritdoc */\n  find() {\n    let filter = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    return this.functions.find({\n      database: this.databaseName,\n      collection: this.collectionName,\n      query: filter,\n      project: options.projection,\n      sort: options.sort,\n      limit: options.limit\n    });\n  }\n  /** @inheritdoc */\n  findOne() {\n    let filter = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    return this.functions.findOne({\n      database: this.databaseName,\n      collection: this.collectionName,\n      query: filter,\n      project: options.projection,\n      sort: options.sort\n    });\n  }\n  /** @inheritdoc */\n  findOneAndUpdate() {\n    let filter = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    let update = arguments.length > 1 ? arguments[1] : undefined;\n    let options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    return this.functions.findOneAndUpdate({\n      database: this.databaseName,\n      collection: this.collectionName,\n      filter,\n      update,\n      sort: options.sort,\n      projection: options.projection,\n      upsert: options.upsert,\n      returnNewDocument: options.returnNewDocument\n    });\n  }\n  /** @inheritdoc */\n  findOneAndReplace() {\n    let filter = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    let replacement = arguments.length > 1 ? arguments[1] : undefined;\n    let options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    return this.functions.findOneAndReplace({\n      database: this.databaseName,\n      collection: this.collectionName,\n      filter: filter,\n      update: replacement,\n      sort: options.sort,\n      projection: options.projection,\n      upsert: options.upsert,\n      returnNewDocument: options.returnNewDocument\n    });\n  }\n  /** @inheritdoc */\n  findOneAndDelete() {\n    let filter = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    return this.functions.findOneAndReplace({\n      database: this.databaseName,\n      collection: this.collectionName,\n      filter,\n      sort: options.sort,\n      projection: options.projection\n    });\n  }\n  /** @inheritdoc */\n  aggregate(pipeline) {\n    return this.functions.aggregate({\n      database: this.databaseName,\n      collection: this.collectionName,\n      pipeline\n    });\n  }\n  /** @inheritdoc */\n  count() {\n    let filter = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    return this.functions.count({\n      database: this.databaseName,\n      collection: this.collectionName,\n      query: filter,\n      limit: options.limit\n    });\n  }\n  /** @inheritdoc */\n  insertOne(document) {\n    return this.functions.insertOne({\n      database: this.databaseName,\n      collection: this.collectionName,\n      document\n    });\n  }\n  /** @inheritdoc */\n  insertMany(documents) {\n    return this.functions.insertMany({\n      database: this.databaseName,\n      collection: this.collectionName,\n      documents\n    });\n  }\n  /** @inheritdoc */\n  deleteOne() {\n    let filter = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    return this.functions.deleteOne({\n      database: this.databaseName,\n      collection: this.collectionName,\n      query: filter\n    });\n  }\n  /** @inheritdoc */\n  deleteMany() {\n    let filter = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    return this.functions.deleteMany({\n      database: this.databaseName,\n      collection: this.collectionName,\n      query: filter\n    });\n  }\n  /** @inheritdoc */\n  updateOne(filter, update) {\n    let options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    return this.functions.updateOne({\n      database: this.databaseName,\n      collection: this.collectionName,\n      query: filter,\n      update,\n      upsert: options.upsert\n    });\n  }\n  /** @inheritdoc */\n  updateMany(filter, update) {\n    let options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    return this.functions.updateMany({\n      database: this.databaseName,\n      collection: this.collectionName,\n      query: filter,\n      update,\n      upsert: options.upsert\n    });\n  }\n  watch() {\n    try {\n      var _this = this;\n      let {\n        ids,\n        filter\n      } = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      return async function* () {\n        const iterator = await _this.functions.callFunctionStreaming(\"watch\", {\n          database: _this.databaseName,\n          collection: _this.collectionName,\n          ids,\n          filter\n        });\n        const watchStream = new WatchStream();\n        for await (const chunk of iterator) {\n          if (!chunk) continue;\n          watchStream.feedBuffer(chunk);\n          while (watchStream.state == WatchStreamState.HAVE_EVENT) {\n            yield watchStream.nextEvent();\n          }\n          if (watchStream.state == WatchStreamState.HAVE_ERROR)\n            // XXX this is just throwing an error like {error_code: \"BadRequest, error: \"message\"},\n            // which matches realm-js, but is different from how errors are handled in realm-web\n            throw watchStream.error;\n        }\n      }();\n    } catch (e) {\n      return Promise.reject(e);\n    }\n  }\n}\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * Creates an Remote MongoDB Collection.\n * Note: This method exists to enable function binding.\n *\n * @param fetcher The underlying fetcher.\n * @param serviceName A service name.\n * @param databaseName A database name.\n * @param collectionName A collection name.\n * @returns The collection.\n */\nfunction createCollection(fetcher, serviceName, databaseName, collectionName) {\n  return new MongoDBCollection(fetcher, serviceName, databaseName, collectionName);\n}\n/**\n * Creates a Remote MongoDB Database.\n * Note: This method exists to enable function binding.\n *\n * @param fetcher The underlying fetcher\n * @param serviceName A service name\n * @param databaseName A database name\n * @returns The database.\n */\nfunction createDatabase(fetcher, serviceName, databaseName) {\n  return {\n    collection: createCollection.bind(null, fetcher, serviceName, databaseName)\n  };\n}\n/**\n * Creates a Remote MongoDB Service.\n * Note: This method exists to enable function binding.\n *\n * @param fetcher The underlying fetcher.\n * @param serviceName An optional service name.\n * @returns The service.\n */\nfunction createService(fetcher) {\n  let serviceName = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"mongo-db\";\n  return {\n    db: createDatabase.bind(null, fetcher, serviceName)\n  };\n}\n\n////////////////////////////////////////////////////////////////////////////\nconst DEFAULT_DEVICE_ID = \"000000000000000000000000\";\n/** The state of a user within the app */\nvar UserState;\n(function (UserState) {\n  /** Active, with both access and refresh tokens */\n  UserState[\"Active\"] = \"active\";\n  /** Logged out, but there might still be data persisted about the user, in the browser. */\n  UserState[\"LoggedOut\"] = \"logged-out\";\n  /** Logged out and all data about the user has been removed. */\n  UserState[\"Removed\"] = \"removed\";\n})(UserState || (UserState = {}));\n/** The type of a user. */\nvar UserType$1;\n(function (UserType) {\n  /** Created by the user itself. */\n  UserType[\"Normal\"] = \"normal\";\n  /** Created by an administrator of the app. */\n  UserType[\"Server\"] = \"server\";\n})(UserType$1 || (UserType$1 = {}));\n/**\n * Representation of an authenticated user of an app.\n */\nclass User {\n  /**\n   * @param parameters Parameters of the user.\n   */\n  constructor(parameters) {\n    this.app = parameters.app;\n    this.id = parameters.id;\n    this.storage = new UserStorage(this.app.storage, this.id);\n    if (\"accessToken\" in parameters && \"refreshToken\" in parameters && \"providerType\" in parameters) {\n      this._accessToken = parameters.accessToken;\n      this._refreshToken = parameters.refreshToken;\n      this.providerType = parameters.providerType;\n      // Save the parameters to storage, for future instances to be hydrated from\n      this.storage.accessToken = parameters.accessToken;\n      this.storage.refreshToken = parameters.refreshToken;\n      this.storage.providerType = parameters.providerType;\n    } else {\n      // Hydrate the rest of the parameters from storage\n      this._accessToken = this.storage.accessToken;\n      this._refreshToken = this.storage.refreshToken;\n      const providerType = this.storage.providerType;\n      this._profile = this.storage.profile;\n      if (providerType) {\n        this.providerType = providerType;\n      } else {\n        throw new Error(\"Storage is missing a provider type\");\n      }\n    }\n    this.fetcher = this.app.fetcher.clone({\n      userContext: {\n        currentUser: this\n      }\n    });\n    this.apiKeys = new ApiKeyAuth(this.fetcher);\n    this.functions = FunctionsFactory.create(this.fetcher);\n  }\n  /**\n   * @returns The access token used to authenticate the user towards MongoDB Realm.\n   */\n  get accessToken() {\n    return this._accessToken;\n  }\n  /**\n   * @param token The new access token.\n   */\n  set accessToken(token) {\n    this._accessToken = token;\n    this.storage.accessToken = token;\n  }\n  /**\n   * @returns The refresh token used to issue new access tokens.\n   */\n  get refreshToken() {\n    return this._refreshToken;\n  }\n  /**\n   * @param token The new refresh token.\n   */\n  set refreshToken(token) {\n    this._refreshToken = token;\n    this.storage.refreshToken = token;\n  }\n  /**\n   * @returns The current state of the user.\n   */\n  get state() {\n    if (this.id in this.app.allUsers) {\n      return this.refreshToken === null ? UserState.LoggedOut : UserState.Active;\n    } else {\n      return UserState.Removed;\n    }\n  }\n  /**\n   * @returns The logged in state of the user.\n   */\n  get isLoggedIn() {\n    return this.state === UserState.Active;\n  }\n  get customData() {\n    if (this.accessToken) {\n      const decodedToken = this.decodeAccessToken();\n      return decodedToken.userData;\n    } else {\n      throw new Error(\"Cannot read custom data without an access token\");\n    }\n  }\n  /**\n   * @returns Profile containing detailed information about the user.\n   */\n  get profile() {\n    if (this._profile) {\n      return this._profile.data;\n    } else {\n      throw new Error(\"A profile was never fetched for this user\");\n    }\n  }\n  get identities() {\n    if (this._profile) {\n      return this._profile.identities;\n    } else {\n      throw new Error(\"A profile was never fetched for this user\");\n    }\n  }\n  get deviceId() {\n    if (this.accessToken) {\n      const payload = this.accessToken.split(\".\")[1];\n      if (payload) {\n        const parsedPayload = JSON.parse(gBase64.decode(payload));\n        const deviceId = parsedPayload[\"baas_device_id\"];\n        if (typeof deviceId === \"string\" && deviceId !== DEFAULT_DEVICE_ID) {\n          return deviceId;\n        }\n      }\n    }\n    return null;\n  }\n  /**\n   * Refresh the users profile data.\n   */\n  async refreshProfile() {\n    // Fetch the latest profile\n    const response = await this.fetcher.fetchJSON({\n      method: \"GET\",\n      path: routes.api().auth().profile().path\n    });\n    // Create a profile instance\n    this._profile = new UserProfile(response);\n    // Store this for later hydration\n    this.storage.profile = this._profile;\n  }\n  /**\n   * Log out the user, invalidating the session (and its refresh token).\n   */\n  async logOut() {\n    // Invalidate the refresh token\n    try {\n      if (this._refreshToken !== null) {\n        await this.fetcher.fetchJSON({\n          method: \"DELETE\",\n          path: routes.api().auth().session().path,\n          tokenType: \"refresh\"\n        });\n      }\n    } finally {\n      // Forget the access and refresh token\n      this.accessToken = null;\n      this.refreshToken = null;\n    }\n  }\n  /** @inheritdoc */\n  async linkCredentials(credentials) {\n    const response = await this.app.authenticator.authenticate(credentials, this);\n    // Sanity check the response\n    if (this.id !== response.userId) {\n      const details = `got user id ${response.userId} expected ${this.id}`;\n      throw new Error(`Link response ment for another user (${details})`);\n    }\n    // Update the access token\n    this.accessToken = response.accessToken;\n    // Refresh the profile to include the new identity\n    await this.refreshProfile();\n  }\n  /**\n   * Request a new access token, using the refresh token.\n   */\n  async refreshAccessToken() {\n    const response = await this.fetcher.fetchJSON({\n      method: \"POST\",\n      path: routes.api().auth().session().path,\n      tokenType: \"refresh\"\n    });\n    const {\n      access_token: accessToken\n    } = response;\n    if (typeof accessToken === \"string\") {\n      this.accessToken = accessToken;\n    } else {\n      throw new Error(\"Expected an 'access_token' in the response\");\n    }\n  }\n  /** @inheritdoc */\n  async refreshCustomData() {\n    await this.refreshAccessToken();\n    return this.customData;\n  }\n  /** @inheritdoc */\n  callFunction(name) {\n    for (var _len10 = arguments.length, args = new Array(_len10 > 1 ? _len10 - 1 : 0), _key10 = 1; _key10 < _len10; _key10++) {\n      args[_key10 - 1] = arguments[_key10];\n    }\n    return this.functions.callFunction(name, ...args);\n  }\n  /**\n   * @returns A plain ol' JavaScript object representation of the user.\n   */\n  toJSON() {\n    return {\n      id: this.id,\n      accessToken: this.accessToken,\n      refreshToken: this.refreshToken,\n      profile: this._profile,\n      state: this.state,\n      customData: this.customData\n    };\n  }\n  /** @inheritdoc */\n  push() {\n    throw new Error(\"Not yet implemented\");\n  }\n  /** @inheritdoc */\n  mongoClient(serviceName) {\n    return createService(this.fetcher, serviceName);\n  }\n  decodeAccessToken() {\n    if (this.accessToken) {\n      // Decode and spread the token\n      const parts = this.accessToken.split(\".\");\n      if (parts.length !== 3) {\n        throw new Error(\"Expected an access token with three parts\");\n      }\n      // Decode the payload\n      const encodedPayload = parts[1];\n      const decodedPayload = gBase64.decode(encodedPayload);\n      const parsedPayload = JSON.parse(decodedPayload);\n      const {\n        exp: expires,\n        iat: issuedAt,\n        sub: subject,\n        user_data: userData = {}\n      } = parsedPayload;\n      // Validate the types\n      if (typeof expires !== \"number\") {\n        throw new Error(\"Failed to decode access token 'exp'\");\n      } else if (typeof issuedAt !== \"number\") {\n        throw new Error(\"Failed to decode access token 'iat'\");\n      }\n      return {\n        expires,\n        issuedAt,\n        subject,\n        userData\n      };\n    } else {\n      throw new Error(\"Missing an access token\");\n    }\n  }\n}\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\n// TODO: Ensure the static interface of the Credentials class implements the static interface of Realm.Credentials\n// See https://stackoverflow.com/a/43484801\n/**\n * Instances of this class can be passed to the `app.logIn` method to authenticate an end-user.\n */\nclass Credentials {\n  /**\n   * Constructs an instance of credentials.\n   *\n   * @param providerName The name of the authentication provider used when authenticating.\n   * @param providerType The type of the authentication provider used when authenticating.\n   * @param payload The data being sent to the service when authenticating.\n   */\n  constructor(providerName, providerType, payload) {\n    this.providerName = providerName;\n    this.providerType = providerType;\n    this.payload = payload;\n  }\n  /**\n   * Creates credentials that logs in using the [Anonymous Provider](https://docs.mongodb.com/realm/authentication/anonymous/).\n   *\n   * @returns The credentials instance, which can be passed to `app.logIn`.\n   */\n  static anonymous() {\n    return new Credentials(\"anon-user\", \"anon-user\", {});\n  }\n  /**\n   * Creates credentials that logs in using the [API Key Provider](https://docs.mongodb.com/realm/authentication/api-key/).\n   *\n   * @deprecated Use `Credentials.apiKey`.\n   * @param key The secret content of the API key.\n   * @returns The credentials instance, which can be passed to `app.logIn`.\n   */\n  static userApiKey(key) {\n    return new Credentials(\"api-key\", \"api-key\", {\n      key\n    });\n  }\n  /**\n   * Creates credentials that logs in using the [API Key Provider](https://docs.mongodb.com/realm/authentication/api-key/).\n   *\n   * @deprecated Use `Credentials.apiKey`.\n   * @param key The secret content of the API key.\n   * @returns The credentials instance, which can be passed to `app.logIn`.\n   */\n  static serverApiKey(key) {\n    return new Credentials(\"api-key\", \"api-key\", {\n      key\n    });\n  }\n  /**\n   * Creates credentials that logs in using the [API Key Provider](https://docs.mongodb.com/realm/authentication/api-key/).\n   *\n   * @param key The secret content of the API key.\n   * @returns The credentials instance, which can be passed to `app.logIn`.\n   */\n  static apiKey(key) {\n    return new Credentials(\"api-key\", \"api-key\", {\n      key\n    });\n  }\n  /**\n   * Creates credentials that logs in using the [Email/Password Provider](https://docs.mongodb.com/realm/authentication/email-password/).\n   * Note: This was formerly known as the \"Username/Password\" provider.\n   *\n   * @param email The end-users email address.\n   * @param password The end-users password.\n   * @returns The credentials instance, which can be passed to `app.logIn`.\n   */\n  static emailPassword(email, password) {\n    return new Credentials(\"local-userpass\", \"local-userpass\", {\n      username: email,\n      password\n    });\n  }\n  /**\n   * Creates credentials that logs in using the [Custom Function Provider](https://docs.mongodb.com/realm/authentication/custom-function/).\n   *\n   * @param payload The custom payload as expected by the server.\n   * @returns The credentials instance, which can be passed to `app.logIn`.\n   */\n  static function(payload) {\n    return new Credentials(\"custom-function\", \"custom-function\", payload);\n  }\n  /**\n   * Creates credentials that logs in using the [Custom JWT Provider](https://docs.mongodb.com/realm/authentication/custom-jwt/).\n   *\n   * @param token The JSON Web Token (JWT).\n   * @returns The credentials instance, which can be passed to `app.logIn`.\n   */\n  static jwt(token) {\n    return new Credentials(\"custom-token\", \"custom-token\", {\n      token\n    });\n  }\n  /**\n   * Creates credentials that logs in using the [Google Provider](https://docs.mongodb.com/realm/authentication/google/).\n   *\n   * @param payload The URL that users should be redirected to, the auth code or id token from Google.\n   * @returns The credentials instance, which can be passed to `app.logIn`.\n   */\n  static google(payload) {\n    return new Credentials(\"oauth2-google\", \"oauth2-google\", Credentials.derivePayload(payload));\n  }\n  /**\n   * @param payload The payload string.\n   * @returns A payload object based on the string.\n   */\n  static derivePayload(payload) {\n    if (typeof payload === \"string\") {\n      if (payload.includes(\"://\")) {\n        return this.derivePayload({\n          redirectUrl: payload\n        });\n      } else if (payload.startsWith(\"4/\")) {\n        return this.derivePayload({\n          authCode: payload\n        });\n      } else if (payload.startsWith(\"ey\")) {\n        return this.derivePayload({\n          idToken: payload\n        });\n      } else {\n        throw new Error(`Unexpected payload: ${payload}`);\n      }\n    } else if (Object.keys(payload).length === 1) {\n      if (\"authCode\" in payload || \"redirectUrl\" in payload) {\n        return payload;\n      } else if (\"idToken\" in payload) {\n        return {\n          id_token: payload.idToken\n        };\n      } else {\n        throw new Error(\"Unexpected payload: \" + JSON.stringify(payload));\n      }\n    } else {\n      throw new Error(\"Expected only one property in payload, got \" + JSON.stringify(payload));\n    }\n  }\n  /**\n   * Creates credentials that logs in using the [Facebook Provider](https://docs.mongodb.com/realm/authentication/facebook/).\n   *\n   * @param redirectUrlOrAccessToken The URL that users should be redirected to or the auth code returned from Facebook.\n   * @returns The credentials instance, which can be passed to `app.logIn`.\n   */\n  static facebook(redirectUrlOrAccessToken) {\n    return new Credentials(\"oauth2-facebook\", \"oauth2-facebook\", redirectUrlOrAccessToken.includes(\"://\") ? {\n      redirectUrl: redirectUrlOrAccessToken\n    } : {\n      accessToken: redirectUrlOrAccessToken\n    });\n  }\n  /**\n   * Creates credentials that logs in using the [Apple ID Provider](https://docs.mongodb.com/realm/authentication/apple/).\n   *\n   * @param redirectUrlOrIdToken The URL that users should be redirected to or the id_token returned from Apple.\n   * @returns The credentials instance, which can be passed to `app.logIn`.\n   */\n  static apple(redirectUrlOrIdToken) {\n    return new Credentials(\"oauth2-apple\", \"oauth2-apple\", redirectUrlOrIdToken.includes(\"://\") ? {\n      redirectUrl: redirectUrlOrIdToken\n    } : {\n      id_token: redirectUrlOrIdToken\n    });\n  }\n}\n\n////////////////////////////////////////////////////////////////////////////\nconst USER_IDS_STORAGE_KEY = \"userIds\";\nconst DEVICE_ID_STORAGE_KEY = \"deviceId\";\n/**\n * Storage specific to the app.\n */\nclass AppStorage extends PrefixedStorage {\n  /**\n   * @param storage The underlying storage to wrap.\n   * @param appId The id of the app.\n   */\n  constructor(storage, appId) {\n    super(storage, `app(${appId})`);\n  }\n  /**\n   * Reads out the list of user ids from storage.\n   *\n   * @returns A list of user ids.\n   */\n  getUserIds() {\n    const userIdsString = this.get(USER_IDS_STORAGE_KEY);\n    const userIds = userIdsString ? JSON.parse(userIdsString) : [];\n    if (Array.isArray(userIds)) {\n      // Remove any duplicates that might have been added\n      // The Set preserves insertion order\n      return [...new Set(userIds)];\n    } else {\n      throw new Error(\"Expected the user ids to be an array\");\n    }\n  }\n  /**\n   * Sets the list of ids in storage.\n   * Optionally merging with existing ids stored in the storage, by prepending these while voiding duplicates.\n   *\n   * @param userIds The list of ids to store.\n   * @param mergeWithExisting Prepend existing ids to avoid data-races with other apps using this storage.\n   */\n  setUserIds(userIds, mergeWithExisting) {\n    if (mergeWithExisting) {\n      // Add any existing user id to the end of this list, avoiding duplicates\n      const existingIds = this.getUserIds();\n      for (const id of existingIds) {\n        if (userIds.indexOf(id) === -1) {\n          userIds.push(id);\n        }\n      }\n    }\n    // Store the list of ids\n    this.set(USER_IDS_STORAGE_KEY, JSON.stringify(userIds));\n  }\n  /**\n   * Remove an id from the list of ids.\n   *\n   * @param userId The id of a User to be removed.\n   */\n  removeUserId(userId) {\n    const existingIds = this.getUserIds();\n    const userIds = existingIds.filter(id => id !== userId);\n    // Store the list of ids\n    this.setUserIds(userIds, false);\n  }\n  /**\n   * @returns id of this device (if any exists)\n   */\n  getDeviceId() {\n    return this.get(DEVICE_ID_STORAGE_KEY);\n  }\n  /**\n   * @param deviceId The id of this device, to send on subsequent authentication requests.\n   */\n  setDeviceId(deviceId) {\n    this.set(DEVICE_ID_STORAGE_KEY, deviceId);\n  }\n}\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\nconst LOWERCASE_LETTERS = \"abcdefghijklmnopqrstuvwxyz\";\nconst CLOSE_CHECK_INTERVAL = 100; // 10 times per second\nconst REDIRECT_HASH_TO_RESULT = {\n  _stitch_client_app_id: \"appId\",\n  _baas_client_app_id: \"appId\",\n  _stitch_ua: \"userAuth\",\n  _baas_ua: \"userAuth\",\n  _stitch_link: \"link\",\n  _baas_link: \"link\",\n  _stitch_error: \"error\",\n  _baas_error: \"error\",\n  _stitch_state: \"state\",\n  _baas_state: \"state\"\n};\n/**\n * A collection of methods helping implement the OAuth2 flow.\n */\nclass OAuth2Helper {\n  /**\n   * @param storage The underlying storage to use when storing and retriving secrets.\n   * @param openWindow An optional function called when a browser window needs to open.\n   */\n  constructor(storage) {\n    let openWindow = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : getEnvironment().openWindow;\n    this.storage = storage.prefix(\"oauth2\");\n    this.openWindow = openWindow;\n  }\n  /**\n   * Parses the query string from the final step of the OAuth flow.\n   *\n   * @param queryString The query string passed through in location.hash.\n   * @returns The result of the OAuth flow.\n   */\n  static parseRedirectLocation(queryString) {\n    const params = decodeQueryString(queryString);\n    const result = {};\n    for (const [p, r] of Object.entries(REDIRECT_HASH_TO_RESULT)) {\n      const value = params[p];\n      if (value) {\n        result[r] = value;\n      }\n    }\n    return result;\n  }\n  /**\n   * Handle the redirect querystring by parsing it and storing it for others to consume.\n   *\n   * @param queryString The query string containing the encoded result from the OAuth provider.\n   * @param storage The underlying storage used to persist the result.\n   */\n  static handleRedirect(queryString) {\n    let storage = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : getEnvironment().defaultStorage;\n    const result = OAuth2Helper.parseRedirectLocation(queryString);\n    const {\n      state,\n      error\n    } = result;\n    if (typeof state === \"string\") {\n      const oauth2Storage = storage.prefix(\"oauth2\");\n      const stateStorage = OAuth2Helper.getStateStorage(oauth2Storage, state);\n      stateStorage.set(\"result\", JSON.stringify(result));\n    } else if (error) {\n      throw new Error(`Failed to handle OAuth 2.0 redirect: ${error}`);\n    } else {\n      throw new Error(\"Failed to handle OAuth 2.0 redirect.\");\n    }\n  }\n  /**\n   * Decodes the authInfo string into its seperate parts.\n   *\n   * @param authInfo An authInfo string returned from the server.\n   * @returns An object containing the separate parts of the authInfo string.\n   */\n  static decodeAuthInfo(authInfo) {\n    const parts = (authInfo || \"\").split(\"$\");\n    if (parts.length === 4) {\n      const [accessToken, refreshToken, userId, deviceId] = parts;\n      return {\n        accessToken,\n        refreshToken,\n        userId,\n        deviceId\n      };\n    } else {\n      throw new Error(\"Failed to decode 'authInfo' into ids and tokens\");\n    }\n  }\n  /**\n   * Get the storage key associated of an secret associated with a state.\n   *\n   * @param storage The root storage used to derive a \"state namespaced\" storage.\n   * @param state The random state.\n   * @returns The storage associated with a particular state.\n   */\n  static getStateStorage(storage, state) {\n    return storage.prefix(`state(${state})`);\n  }\n  /**\n   * Open a window and wait for the redirect to be handled.\n   *\n   * @param url The URL to open.\n   * @param state The state which will be used to listen for storage updates.\n   * @returns The result passed through the redirect.\n   */\n  openWindowAndWaitForRedirect(url, state) {\n    const stateStorage = OAuth2Helper.getStateStorage(this.storage, state);\n    // Return a promise that resolves when the  gets known\n    return new Promise((resolve, reject) => {\n      let redirectWindow = null;\n      // We're declaring the interval now to enable referencing before its initialized\n      let windowClosedInterval; // eslint-disable-line prefer-const\n      const handleStorageUpdate = () => {\n        // Trying to get the secret from storage\n        const result = stateStorage.get(\"result\");\n        if (result) {\n          const parsedResult = JSON.parse(result);\n          // The secret got updated!\n          stateStorage.removeListener(handleStorageUpdate);\n          // Clear the storage to prevent others from reading this\n          stateStorage.clear();\n          // Try closing the newly created window\n          try {\n            if (redirectWindow) {\n              // Stop checking if the window closed\n              clearInterval(windowClosedInterval);\n              redirectWindow.close();\n            }\n          } catch (err) {\n            console.warn(`Failed closing redirect window: ${err}`);\n          } finally {\n            resolve(parsedResult);\n          }\n        }\n      };\n      // Add a listener to the state storage, awaiting an update to the secret\n      stateStorage.addListener(handleStorageUpdate);\n      // Open up a window\n      redirectWindow = this.openWindow(url);\n      // Not using a const, because we need the two listeners to reference each other when removing the other.\n      windowClosedInterval = setInterval(() => {\n        // Polling \"closed\" because registering listeners on the window violates cross-origin policies\n        if (!redirectWindow) {\n          // No need to keep polling for a window that we can't check\n          clearInterval(windowClosedInterval);\n        } else if (redirectWindow.closed) {\n          // Stop polling the window state\n          clearInterval(windowClosedInterval);\n          // Stop listening for changes to the storage\n          stateStorage.removeListener(handleStorageUpdate);\n          // Reject the promise\n          const err = new Error(\"Window closed\");\n          reject(err);\n        }\n      }, CLOSE_CHECK_INTERVAL);\n    });\n  }\n  /**\n   * Generate a random state string.\n   *\n   * @returns The random state string.\n   */\n  generateState() {\n    return generateRandomString(12, LOWERCASE_LETTERS);\n  }\n}\n\n////////////////////////////////////////////////////////////////////////////\nconst REDIRECT_LOCATION_HEADER = \"x-baas-location\";\n/**\n * Handles authentication and linking of users.\n */\nclass Authenticator {\n  /**\n   * @param fetcher The fetcher used to fetch responses from the server.\n   * @param storage The storage used when completing OAuth 2.0 flows (should not be scoped to a specific app).\n   * @param getDeviceInformation Called to get device information to be sent to the server.\n   */\n  constructor(fetcher, storage, getDeviceInformation) {\n    this.fetcher = fetcher;\n    this.oauth2 = new OAuth2Helper(storage);\n    this.getDeviceInformation = getDeviceInformation;\n  }\n  /**\n   * @param credentials Credentials to use when logging in.\n   * @param linkingUser A user requesting to link.\n   * @returns A promise resolving to the response from the server.\n   */\n  async authenticate(credentials, linkingUser) {\n    const deviceInformation = this.getDeviceInformation();\n    const isLinking = typeof linkingUser === \"object\";\n    if (credentials.providerType.startsWith(\"oauth2\") && typeof credentials.payload.redirectUrl === \"string\") {\n      // Initiate the OAuth2 flow by generating a state and fetch a redirect URL\n      const state = this.oauth2.generateState();\n      const url = await this.getLogInUrl(credentials, isLinking, {\n        state,\n        redirect: credentials.payload.redirectUrl,\n        // Ensure redirects are communicated in a header different from \"Location\" and status remains 200 OK\n        providerRedirectHeader: isLinking ? true : undefined,\n        // Add the device information, only if we're not linking - since that request won't have a body of its own.\n        device: !isLinking ? deviceInformation.encode() : undefined\n      });\n      // If we're linking, we need to send the users access token in the request\n      if (isLinking) {\n        const response = await this.fetcher.fetch({\n          method: \"GET\",\n          url,\n          tokenType: isLinking ? \"access\" : \"none\",\n          user: linkingUser,\n          // The response will set a cookie that we need to tell the browser to store\n          mode: \"cors\",\n          credentials: \"include\"\n        });\n        // If a response header contains a redirect URL: Open a window and wait for the redirect to be handled\n        const redirectUrl = response.headers.get(REDIRECT_LOCATION_HEADER);\n        if (redirectUrl) {\n          return this.openWindowAndWaitForAuthResponse(redirectUrl, state);\n        } else {\n          throw new Error(`Missing ${REDIRECT_LOCATION_HEADER} header`);\n        }\n      } else {\n        // Otherwise we can open a window and let the server redirect the user right away\n        // This gives lower latency (as we don't need the client to receive and execute the redirect in code)\n        // This also has less dependency on cookies and doesn't sent any tokens.\n        return this.openWindowAndWaitForAuthResponse(url, state);\n      }\n    } else {\n      const logInUrl = await this.getLogInUrl(credentials, isLinking);\n      const response = await this.fetcher.fetchJSON({\n        method: \"POST\",\n        url: logInUrl,\n        body: {\n          ...credentials.payload,\n          options: {\n            device: deviceInformation.toJSON()\n          }\n        },\n        tokenType: isLinking ? \"access\" : \"none\",\n        user: linkingUser\n      });\n      // Spread out values from the response and ensure they're valid\n      const {\n        user_id: userId,\n        access_token: accessToken,\n        refresh_token: refreshToken = null,\n        device_id: deviceId\n      } = response;\n      if (typeof userId !== \"string\") {\n        throw new Error(\"Expected a user id in the response\");\n      }\n      if (typeof accessToken !== \"string\") {\n        throw new Error(\"Expected an access token in the response\");\n      }\n      if (typeof refreshToken !== \"string\" && refreshToken !== null) {\n        throw new Error(\"Expected refresh token to be a string or null\");\n      }\n      if (typeof deviceId !== \"string\") {\n        throw new Error(\"Expected device id to be a string\");\n      }\n      return {\n        userId,\n        accessToken,\n        refreshToken,\n        deviceId\n      };\n    }\n  }\n  /**\n   * @param credentials Credentials to use when logging in.\n   * @param link Should the request link with the current user?\n   * @param extraQueryParams Any extra parameters to include in the query string\n   * @returns A promise resolving to the url to be used when logging in.\n   */\n  async getLogInUrl(credentials) {\n    let link = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n    let extraQueryParams = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    // See https://github.com/mongodb/stitch-js-sdk/blob/310f0bd5af80f818cdfbc3caf1ae29ffa8e9c7cf/packages/core/sdk/src/auth/internal/CoreStitchAuth.ts#L746-L780\n    const appRoute = this.fetcher.appRoute;\n    const loginRoute = appRoute.authProvider(credentials.providerName).login();\n    const qs = encodeQueryString({\n      link: link ? \"true\" : undefined,\n      ...extraQueryParams\n    });\n    const locationUrl = await this.fetcher.locationUrl;\n    return locationUrl + loginRoute.path + qs;\n  }\n  async openWindowAndWaitForAuthResponse(redirectUrl, state) {\n    const redirectResult = await this.oauth2.openWindowAndWaitForRedirect(redirectUrl, state);\n    // Decode the auth info (id, tokens, etc.) from the result of the redirect\n    return OAuth2Helper.decodeAuthInfo(redirectResult.userAuth);\n  }\n}\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\n// TODO: Determine if the shape of an error response is specific to each service or widely used.\n/**\n * An error produced while communicating with the MongoDB Realm server.\n */\nclass MongoDBRealmError extends Error {\n  constructor(method, url, statusCode, statusText, error, errorCode, link) {\n    const summary = statusText ? `status ${statusCode} ${statusText}` : `status ${statusCode}`;\n    if (typeof error === \"string\") {\n      super(`Request failed (${method} ${url}): ${error} (${summary})`);\n    } else {\n      super(`Request failed (${method} ${url}): (${summary})`);\n    }\n    this.method = method;\n    this.url = url;\n    this.statusText = statusText;\n    this.statusCode = statusCode;\n    this.error = error;\n    this.errorCode = errorCode;\n    this.link = link;\n  }\n  /**\n   * Constructs and returns an error from a request and a response.\n   * Note: The caller must throw this error themselves.\n   *\n   * @param request The request sent to the server.\n   * @param response A raw response, as returned from the server.\n   * @returns An error from a request and a response.\n   */\n  static async fromRequestAndResponse(request, response) {\n    var _a;\n    const {\n      url,\n      method\n    } = request;\n    const {\n      status,\n      statusText\n    } = response;\n    if ((_a = response.headers.get(\"content-type\")) === null || _a === void 0 ? void 0 : _a.startsWith(\"application/json\")) {\n      const body = await response.json();\n      if (typeof body === \"object\" && body) {\n        const {\n          error,\n          error_code: errorCode,\n          link\n        } = body;\n        return new MongoDBRealmError(method, url, status, statusText, typeof error === \"string\" ? error : undefined, typeof errorCode === \"string\" ? errorCode : undefined, typeof link === \"string\" ? link : undefined);\n      }\n    }\n    return new MongoDBRealmError(method, url, status, statusText);\n  }\n}\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * @param body A possible resonse body.\n * @returns An async iterator.\n */\nfunction asyncIteratorFromResponseBody(body) {\n  if (typeof body !== \"object\" || body === null) {\n    throw new Error(\"Expected a non-null object\");\n  } else if (Symbol.asyncIterator in body) {\n    return body;\n  } else if (\"getReader\" in body) {\n    const stream = body;\n    return {\n      [Symbol.asyncIterator]() {\n        const reader = stream.getReader();\n        return {\n          next() {\n            return reader.read();\n          },\n          async return() {\n            await reader.cancel();\n            return {\n              done: true,\n              value: null\n            };\n          }\n        };\n      }\n    };\n  } else {\n    throw new Error(\"Expected an AsyncIterable or a ReadableStream\");\n  }\n}\n/**\n * Wraps a NetworkTransport from the \"realm-network-transport\" package.\n * Extracts error messages and throws `MongoDBRealmError` objects upon failures.\n * Injects access or refresh tokens for a current or specific user.\n * Refreshes access tokens if requests fails due to a 401 error.\n * Optionally parses response as JSON before returning it.\n * Fetches and exposes an app's location url.\n */\nclass Fetcher {\n  /**\n   * @param config A configuration of the fetcher.\n   * @param config.appId The application id.\n   * @param config.transport The transport used when fetching.\n   * @param config.userContext An object used to determine the requesting user.\n   * @param config.locationUrlContext An object used to determine the location / base URL.\n   */\n  constructor(_ref5) {\n    let {\n      appId,\n      transport,\n      userContext,\n      locationUrlContext\n    } = _ref5;\n    this.appId = appId;\n    this.transport = transport;\n    this.userContext = userContext;\n    this.locationUrlContext = locationUrlContext;\n  }\n  /**\n   * @param user An optional user to generate the header for.\n   * @param tokenType The type of token (access or refresh).\n   * @returns An object containing the user's token as \"Authorization\" header or undefined if no user is given.\n   */\n  static buildAuthorizationHeader(user, tokenType) {\n    if (!user || tokenType === \"none\") {\n      return {};\n    } else if (tokenType === \"access\") {\n      return {\n        Authorization: `Bearer ${user.accessToken}`\n      };\n    } else if (tokenType === \"refresh\") {\n      return {\n        Authorization: `Bearer ${user.refreshToken}`\n      };\n    } else {\n      throw new Error(`Unexpected token type (${tokenType})`);\n    }\n  }\n  /**\n   * @param body The body string or object passed from a request.\n   * @returns An object optionally specifying the \"Content-Type\" header.\n   */\n  static buildBody(body) {\n    if (!body) {\n      return;\n    } else if (typeof body === \"object\" && body !== null) {\n      return JSON.stringify(serialize(body));\n    } else if (typeof body === \"string\") {\n      return body;\n    } else {\n      console.log(\"body is\", body);\n      throw new Error(\"Unexpected type of body\");\n    }\n  }\n  /**\n   * @param body The body string or object passed from a request.\n   * @returns An object optionally specifying the \"Content-Type\" header.\n   */\n  static buildJsonHeader(body) {\n    if (body && body.length > 0) {\n      return {\n        \"Content-Type\": \"application/json\"\n      };\n    } else {\n      return {};\n    }\n  }\n  clone(config) {\n    return new Fetcher({\n      appId: this.appId,\n      transport: this.transport,\n      userContext: this.userContext,\n      locationUrlContext: this.locationUrlContext,\n      ...config\n    });\n  }\n  /**\n   * Fetch a network resource as an authenticated user.\n   *\n   * @param request The request which should be sent to the server.\n   * @returns The response from the server.\n   */\n  async fetch(request) {\n    const {\n      path,\n      url,\n      tokenType = \"access\",\n      user = this.userContext.currentUser,\n      ...restOfRequest\n    } = request;\n    if (typeof path === \"string\" && typeof url === \"string\") {\n      throw new Error(\"Use of 'url' and 'path' mutually exclusive\");\n    } else if (typeof path === \"string\") {\n      // Derive the URL\n      const url = (await this.locationUrlContext.locationUrl) + path;\n      return this.fetch({\n        ...request,\n        path: undefined,\n        url\n      });\n    } else if (typeof url === \"string\") {\n      const response = await this.transport.fetch({\n        ...restOfRequest,\n        url,\n        headers: {\n          ...Fetcher.buildAuthorizationHeader(user, tokenType),\n          ...request.headers\n        }\n      });\n      if (response.ok) {\n        return response;\n      } else if (user && response.status === 401 && tokenType === \"access\") {\n        // If the access token has expired, it would help refreshing it\n        await user.refreshAccessToken();\n        // Retry with the specific user, since the currentUser might have changed.\n        return this.fetch({\n          ...request,\n          user\n        });\n      } else {\n        if (user && response.status === 401 && tokenType === \"refresh\") {\n          // A 401 error while using the refresh token indicates the token has an issue.\n          // Reset the tokens to prevent a lock.\n          user.accessToken = null;\n          user.refreshToken = null;\n        }\n        // Throw an error with a message extracted from the body\n        throw await MongoDBRealmError.fromRequestAndResponse(request, response);\n      }\n    } else {\n      throw new Error(\"Expected either 'url' or 'path'\");\n    }\n  }\n  /**\n   * Fetch a network resource as an authenticated user and parse the result as extended JSON.\n   *\n   * @param request The request which should be sent to the server.\n   * @returns The response from the server, parsed as extended JSON.\n   */\n  async fetchJSON(request) {\n    const {\n      body\n    } = request;\n    const serializedBody = Fetcher.buildBody(body);\n    const contentTypeHeaders = Fetcher.buildJsonHeader(serializedBody);\n    const response = await this.fetch({\n      ...request,\n      body: serializedBody,\n      headers: {\n        Accept: \"application/json\",\n        ...contentTypeHeaders,\n        ...request.headers\n      }\n    });\n    const contentType = response.headers.get(\"content-type\");\n    if (contentType === null || contentType === void 0 ? void 0 : contentType.startsWith(\"application/json\")) {\n      const responseBody = await response.json();\n      return deserialize(responseBody);\n    } else if (contentType === null) {\n      return null;\n    } else {\n      throw new Error(`Expected JSON response, got \"${contentType}\"`);\n    }\n  }\n  /**\n   * Fetch an \"event-stream\" resource as an authenticated user.\n   *\n   * @param request The request which should be sent to the server.\n   * @returns An async iterator over the response body.\n   */\n  async fetchStream(request) {\n    const {\n      body\n    } = await this.fetch({\n      ...request,\n      headers: {\n        Accept: \"text/event-stream\",\n        ...request.headers\n      }\n    });\n    return asyncIteratorFromResponseBody(body);\n  }\n  /**\n   * @returns The path of the app route.\n   */\n  get appRoute() {\n    return routes.api().app(this.appId);\n  }\n  /**\n   * @returns A promise of the location URL of the app.\n   */\n  get locationUrl() {\n    return this.locationUrlContext.locationUrl;\n  }\n}\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * The key in a storage on which the device id is stored.\n */\nconst DEVICE_ID_STORAGE_KEY$1 = \"deviceId\";\nvar DeviceFields;\n(function (DeviceFields) {\n  DeviceFields[\"DEVICE_ID\"] = \"deviceId\";\n  DeviceFields[\"APP_ID\"] = \"appId\";\n  DeviceFields[\"APP_VERSION\"] = \"appVersion\";\n  DeviceFields[\"PLATFORM\"] = \"platform\";\n  DeviceFields[\"PLATFORM_VERSION\"] = \"platformVersion\";\n  DeviceFields[\"SDK_VERSION\"] = \"sdkVersion\";\n})(DeviceFields || (DeviceFields = {}));\n/**\n * Information describing the device, app and SDK.\n */\nclass DeviceInformation {\n  /**\n   * @param params Construct the device information from these parameters.\n   * @param params.appId A user-defined application id.\n   * @param params.appVersion A user-defined application version.\n   * @param params.deviceId An unique id for the end-users device.\n   */\n  constructor(_ref6) {\n    let {\n      appId,\n      appVersion,\n      deviceId\n    } = _ref6;\n    /**\n     * The version of the Realm Web SDK (constant provided by Rollup).\n     */\n    this.sdkVersion = \"1.5.1\";\n    const environment = getEnvironment();\n    this.platform = environment.platform;\n    this.platformVersion = environment.platformVersion;\n    this.appId = appId;\n    this.appVersion = appVersion;\n    this.deviceId = deviceId;\n  }\n  /**\n   * @returns An base64 URI encoded representation of the device information.\n   */\n  encode() {\n    const obj = removeKeysWithUndefinedValues(this);\n    return gBase64.encode(JSON.stringify(obj));\n  }\n  /**\n   * @returns The defaults\n   */\n  toJSON() {\n    return removeKeysWithUndefinedValues(this);\n  }\n}\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * Default base url to prefix all requests if no baseUrl is specified in the configuration.\n */\nconst DEFAULT_BASE_URL = \"https://stitch.mongodb.com\";\n/**\n * MongoDB Realm App\n */\nclass App {\n  /**\n   * Construct a Realm App, either from the Realm App id visible from the MongoDB Realm UI or a configuration.\n   *\n   * @param idOrConfiguration The Realm App id or a configuration to use for this app.\n   */\n  constructor(idOrConfiguration) {\n    /**\n     * An array of active and logged-out users.\n     * Elements in the beginning of the array is considered more recent than the later elements.\n     */\n    this.users = [];\n    /**\n     * A promise resolving to the App's location url.\n     */\n    this._locationUrl = null;\n    // If the argument is a string, convert it to a simple configuration object.\n    const configuration = typeof idOrConfiguration === \"string\" ? {\n      id: idOrConfiguration\n    } : idOrConfiguration;\n    // Initialize properties from the configuration\n    if (typeof configuration === \"object\" && typeof configuration.id === \"string\") {\n      this.id = configuration.id;\n    } else {\n      throw new Error(\"Missing a MongoDB Realm app-id\");\n    }\n    this.baseUrl = configuration.baseUrl || DEFAULT_BASE_URL;\n    if (configuration.skipLocationRequest) {\n      // Use the base url directly, instead of requesting a location URL from the server\n      this._locationUrl = Promise.resolve(this.baseUrl);\n    }\n    this.localApp = configuration.app;\n    const {\n      storage,\n      transport = new DefaultNetworkTransport()\n    } = configuration;\n    // Construct a fetcher wrapping the network transport\n    this.fetcher = new Fetcher({\n      appId: this.id,\n      userContext: this,\n      locationUrlContext: this,\n      transport\n    });\n    // Construct the auth providers\n    this.emailPasswordAuth = new EmailPasswordAuth(this.fetcher);\n    // Construct the storage\n    const baseStorage = storage || getEnvironment().defaultStorage;\n    this.storage = new AppStorage(baseStorage, this.id);\n    this.authenticator = new Authenticator(this.fetcher, baseStorage, () => this.deviceInformation);\n    // Hydrate the app state from storage\n    try {\n      this.hydrate();\n    } catch (err) {\n      // The storage was corrupted\n      this.storage.clear();\n      // A failed hydration shouldn't throw and break the app experience\n      // Since this is \"just\" persisted state that unfortunately got corrupted or partially lost\n      console.warn(\"Realm app hydration failed:\", err.message);\n    }\n  }\n  /**\n   * Get or create a singleton Realm App from an id.\n   * Calling this function multiple times with the same id will return the same instance.\n   *\n   * @param id The Realm App id visible from the MongoDB Realm UI or a configuration.\n   * @returns The Realm App instance.\n   */\n  static getApp(id) {\n    if (id in App.appCache) {\n      return App.appCache[id];\n    } else {\n      const instance = new App(id);\n      App.appCache[id] = instance;\n      return instance;\n    }\n  }\n  /**\n   * Switch user.\n   *\n   * @param nextUser The user or id of the user to switch to.\n   */\n  switchUser(nextUser) {\n    const index = this.users.findIndex(u => u === nextUser);\n    if (index === -1) {\n      throw new Error(\"The user was never logged into this app\");\n    }\n    // Remove the user from the stack\n    const [user] = this.users.splice(index, 1);\n    // Insert the user in the beginning of the stack\n    this.users.unshift(user);\n  }\n  /**\n   * Log in a user.\n   *\n   * @param credentials Credentials to use when logging in.\n   * @param fetchProfile Should the users profile be fetched? (default: true)\n   * @returns A promise resolving to the newly logged in user.\n   */\n  async logIn(credentials) {\n    let fetchProfile = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n    const response = await this.authenticator.authenticate(credentials);\n    const user = this.createOrUpdateUser(response, credentials.providerType);\n    // Let's ensure this will be the current user, in case the user object was reused.\n    this.switchUser(user);\n    // If neeeded, fetch and set the profile on the user\n    if (fetchProfile) {\n      await user.refreshProfile();\n    }\n    // Persist the user id in the storage,\n    // merging to avoid overriding logins from other apps using the same underlying storage\n    this.storage.setUserIds(this.users.map(u => u.id), true);\n    // Read out and store the device id from the server\n    const deviceId = response.deviceId;\n    if (deviceId && deviceId !== \"000000000000000000000000\") {\n      this.storage.set(DEVICE_ID_STORAGE_KEY$1, deviceId);\n    }\n    // Return the user\n    return user;\n  }\n  /**\n   * @inheritdoc\n   */\n  async removeUser(user) {\n    // Remove the user from the list of users\n    const index = this.users.findIndex(u => u === user);\n    if (index === -1) {\n      throw new Error(\"The user was never logged into this app\");\n    }\n    this.users.splice(index, 1);\n    // Log out the user - this removes access and refresh tokens from storage\n    await user.logOut();\n    // Remove the users profile from storage\n    this.storage.remove(`user(${user.id}):profile`);\n    // Remove the user from the storage\n    this.storage.removeUserId(user.id);\n  }\n  /**\n   * The currently active user (or null if no active users exists).\n   *\n   * @returns the currently active user or null.\n   */\n  get currentUser() {\n    const activeUsers = this.users.filter(user => user.state === UserState.Active);\n    if (activeUsers.length === 0) {\n      return null;\n    } else {\n      // Current user is the top of the stack\n      return activeUsers[0];\n    }\n  }\n  /**\n   * All active and logged-out users:\n   *  - First in the list are active users (ordered by most recent call to switchUser or login)\n   *  - Followed by logged out users (also ordered by most recent call to switchUser or login).\n   *\n   * @returns An array of users active or loggedout users (current user being the first).\n   */\n  get allUsers() {\n    // Returning a freezed copy of the list of users to prevent outside changes\n    return Object.fromEntries(this.users.map(user => [user.id, user]));\n  }\n  /**\n   * @returns A promise of the app URL, with the app location resolved.\n   */\n  get locationUrl() {\n    if (!this._locationUrl) {\n      const path = routes.api().app(this.id).location().path;\n      this._locationUrl = this.fetcher.fetchJSON({\n        method: \"GET\",\n        url: this.baseUrl + path,\n        tokenType: \"none\"\n      }).then(body => {\n        if (typeof body !== \"object\") {\n          throw new Error(\"Expected response body be an object\");\n        } else {\n          return body;\n        }\n      }).then(_ref7 => {\n        let {\n          hostname\n        } = _ref7;\n        if (typeof hostname !== \"string\") {\n          throw new Error(\"Expected response to contain a 'hostname'\");\n        } else {\n          return hostname;\n        }\n      }).catch(err => {\n        // Reset the location to allow another request to fetch again.\n        this._locationUrl = null;\n        throw err;\n      });\n    }\n    return this._locationUrl;\n  }\n  /**\n   * @returns Information about the current device, sent to the server when authenticating.\n   */\n  get deviceInformation() {\n    const deviceIdStr = this.storage.getDeviceId();\n    const deviceId = typeof deviceIdStr === \"string\" && deviceIdStr !== \"000000000000000000000000\" ? new ObjectId(deviceIdStr) : undefined;\n    return new DeviceInformation({\n      appId: this.localApp ? this.localApp.name : undefined,\n      appVersion: this.localApp ? this.localApp.version : undefined,\n      deviceId\n    });\n  }\n  /**\n   * Create (and store) a new user or update an existing user's access and refresh tokens.\n   * This helps de-duplicating users in the list of users known to the app.\n   *\n   * @param response A response from the Authenticator.\n   * @param providerType The type of the authentication provider used.\n   * @returns A new or an existing user.\n   */\n  createOrUpdateUser(response, providerType) {\n    const existingUser = this.users.find(u => u.id === response.userId);\n    if (existingUser) {\n      // Update the users access and refresh tokens\n      existingUser.accessToken = response.accessToken;\n      existingUser.refreshToken = response.refreshToken;\n      return existingUser;\n    } else {\n      // Create and store a new user\n      if (!response.refreshToken) {\n        throw new Error(\"No refresh token in response from server\");\n      }\n      const user = new User({\n        app: this,\n        id: response.userId,\n        accessToken: response.accessToken,\n        refreshToken: response.refreshToken,\n        providerType\n      });\n      this.users.unshift(user);\n      return user;\n    }\n  }\n  /**\n   * Restores the state of the app (active and logged-out users) from the storage\n   */\n  hydrate() {\n    const userIds = this.storage.getUserIds();\n    this.users = userIds.map(id => new User({\n      app: this,\n      id\n    }));\n  }\n}\n/**\n * A map of app instances returned from calling getApp.\n */\nApp.appCache = {};\n/**\n * Instances of this class can be passed to the `app.logIn` method to authenticate an end-user.\n */\nApp.Credentials = Credentials;\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * Get or create a singleton Realm App from an id.\n * Calling this function multiple times with the same id will return the same instance.\n *\n * @param id The Realm App id visible from the MongoDB Realm UI or a configuration.\n * @returns The Realm App instance.\n */\nfunction getApp(id) {\n  return App.getApp(id);\n}\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * In-memory storage that will not be persisted.\n */\nclass LocalStorage {\n  /**\n   * Constructs a LocalStorage using the global window.\n   */\n  constructor() {\n    if (typeof globalThis.localStorage === \"object\") {\n      this.global = globalThis;\n    } else {\n      throw new Error(\"Cannot use LocalStorage without a global localStorage object\");\n    }\n  }\n  /** @inheritdoc */\n  get(key) {\n    return this.global.localStorage.getItem(key);\n  }\n  /** @inheritdoc */\n  set(key, value) {\n    return this.global.localStorage.setItem(key, value);\n  }\n  /** @inheritdoc */\n  remove(key) {\n    return this.global.localStorage.removeItem(key);\n  }\n  /** @inheritdoc */\n  prefix(keyPart) {\n    return new PrefixedStorage(this, keyPart);\n  }\n  /** @inheritdoc */\n  clear(prefix) {\n    const keys = [];\n    // Iterate all keys to find the once have a matching prefix.\n    for (let i = 0; i < this.global.localStorage.length; i++) {\n      const key = this.global.localStorage.key(i);\n      if (key && (!prefix || key.startsWith(prefix))) {\n        keys.push(key);\n      }\n    }\n    // Remove the items in a seperate loop to avoid updating while iterating.\n    for (const key of keys) {\n      this.global.localStorage.removeItem(key);\n    }\n  }\n  /** @inheritdoc */\n  addListener(listener) {\n    return this.global.addEventListener(\"storage\", listener);\n  }\n  /** @inheritdoc */\n  removeListener(listener) {\n    return this.global.removeEventListener(\"storage\", listener);\n  }\n}\n\n////////////////////////////////////////////////////////////////////////////\nconst browser = detect();\nconst DefaultStorage = \"localStorage\" in globalThis ? LocalStorage : MemoryStorage;\n/**\n * Attempt to use the browser to open a window\n *\n * @param url The url to open a window to.\n * @returns Then newly create window.\n */\nfunction openWindow(url) {\n  if (typeof globalThis.open === \"function\") {\n    return globalThis.open(url);\n  } else {\n    console.log(`Please open ${url}`);\n    return null;\n  }\n}\nconst environment$1 = {\n  defaultStorage: new DefaultStorage().prefix(\"realm-web\"),\n  openWindow,\n  platform: (browser === null || browser === void 0 ? void 0 : browser.name) || \"web\",\n  platformVersion: (browser === null || browser === void 0 ? void 0 : browser.version) || \"0.0.0\",\n  TextDecoder\n};\nsetEnvironment(environment$1);\n/**\n * Handle an OAuth 2.0 redirect.\n *\n * @param location An optional location to use (defaults to the windows current location).\n * @param storage Optional storage used to save any results from the location.\n */\nfunction handleAuthRedirect() {\n  let location = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : globalThis.location;\n  let storage = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : environment$1.defaultStorage;\n  try {\n    const queryString = location.hash.substr(1); // Strip the initial # from the hash\n    OAuth2Helper.handleRedirect(queryString, storage);\n  } catch (err) {\n    // Ensure calling this never throws: It should not interrupt a users flow.\n    console.warn(err);\n  }\n}\nexport { App, Credentials, DEFAULT_BASE_URL, LocalStorage, MongoDBRealmError, User, UserState, UserType$1 as UserType, getApp, getEnvironment, handleAuthRedirect, setEnvironment };","map":{"version":3,"names":["EJSON","ObjectId","bson","BSON","__spreadArray","undefined","to","from","pack","arguments","length","i","l","ar","Array","prototype","slice","call","concat","BrowserInfo","name","version","os","type","NodeInfo","process","platform","SearchBotDeviceInfo","bot","BotInfo","ReactNativeInfo","SEARCHBOX_UA_REGEX","SEARCHBOT_OS_REGEX","REQUIRED_VERSION_PARTS","userAgentRules","operatingSystemRules","detect","userAgent","parseUserAgent","document","navigator","product","getNodeVersion","matchUserAgent","ua","reduce","matched","_a","browser","regex","uaMatch","exec","matchedRule","match","versionParts","split","join","createVersionParts","detectOS","searchBotMatch","ii","count","isNode","output","push","DefaultNetworkTransport","constructor","fetch","Error","AbortController","fetchWithCallbacks","request","handler","then","response","decodedBody","text","responseHeaders","headers","forEach","value","key","statusCode","status","body","r","onSuccess","catch","e","onError","timeoutMs","url","rest","signal","cancelTimeout","createTimeoutSignal","controller","timeout","setTimeout","abort","clearTimeout","DEFAULT_HEADERS","globalThis","bind","VERSION","_hasatob","atob","_hasbtoa","btoa","_hasBuffer","Buffer","_TD","TextDecoder","_TE","TextEncoder","b64ch","b64chs","b64tab","a","tab","c","b64re","_fromCC","String","fromCharCode","_U8Afrom","Uint8Array","it","fn","x","map","_mkUriSafe","src","replace","m0","_tidyB64","s","btoaPolyfill","bin","u32","c0","c1","c2","asc","pad","charCodeAt","TypeError","substring","_btoa","toString","_fromUint8Array","u8a","maxargs","strs","apply","subarray","fromUint8Array","urlsafe","cb_utob","cc","re_utob","utob","u","_encode","encode","encodeURI","re_btou","cb_btou","cccc","cp","offset","btou","b","atobPolyfill","test","u24","r1","r2","charAt","_atob","_toUint8Array","toUint8Array","_unURI","_decode","decode","isValid","_noEnum","v","enumerable","writable","configurable","extendString","_add","Object","defineProperty","extendUint8Array","extendBuiltins","gBase64","fromBase64","toBase64","encodeURL","SERIALIZATION_OPTIONS","relaxed","serialize","obj","deserialize","isArray","doc","UserType","DataKey","DATA_MAPPING","NAME","EMAIL","PICTURE","FIRST_NAME","LAST_NAME","GENDER","BIRTHDAY","MIN_AGE","MAX_AGE","UserProfile","Normal","identities","data","identity","id","provider_type","providerType","mappedData","fromEntries","entries","_ref","PrefixedStorage","storage","keyPart","get","PART_SEPARATOR","set","remove","prefix","clear","addListener","listener","removeListener","MemoryStorage","listeners","Set","fireListeners","keys","startsWith","add","delete","ACCESS_TOKEN_STORAGE_KEY","REFRESH_TOKEN_STORAGE_KEY","PROFILE_STORAGE_KEY","PROVIDER_TYPE_STORAGE_KEY","UserStorage","userId","accessToken","refreshToken","profile","assign","JSON","parse","stringify","removeKeysWithUndefinedValues","filter","entry","generateRandomString","alphabet","result","Math","floor","random","encodeQueryString","params","prefixed","cleanedParams","_ref2","k","encodeURIComponent","decodeQueryString","str","cleanStr","substr","kvp","_ref3","decodeURIComponent","RESERVED_NAMES","getOwnPropertyNames","cleanArgs","args","arg","cleanArgsAndSerialize","cleaned","FunctionsFactory","fetcher","config","serviceName","argsTransformation","create","factory","Proxy","target","p","receiver","indexOf","callFunction","prop","Reflect","_len","_key","service","appRoute","fetchJSON","method","path","functionsCall","callFunctionStreaming","_len2","_key2","qs","fetchStream","isDevelopmentMode","setIsDevelopmentMode","state","deprecationWarning","deprecatedItem","suggestedReplacement","console","warn","handleDeprecatedPositionalArgs","methodName","argNames","hasRestArgs","restArgsText","argsObject","prev","argName","index","restArgs","__DEV__","EmailPasswordAuth","providerName","registerUser","_len3","_key3","userDetails","emailPasswordAuth","register","confirmUser","_len4","_key4","tokenDetails","confirm","resendConfirmationEmail","_len5","_key5","emailDetails","confirmSend","retryCustomConfirmation","_len6","_key6","confirmCall","resetPassword","_len7","_key7","resetDetails","reset","sendResetPasswordEmail","_len8","_key8","resetSend","callResetPasswordFunction","_len9","_key9","resetCall","api","app","appId","location","authProvider","login","authProviderRoutes","auth","apiKeys","enable","disable","session","routes","ApiKeyAuth","tokenType","keyId","fetchAll","environment","setEnvironment","getEnvironment","WatchError","_ref4","message","code","WatchStreamState","WatchStream","_state","NEED_DATA","_error","_textDecoder","_buffer","_bufferOffset","_eventType","_dataBuffer","feedBuffer","buffer","assertState","stream","advanceBufferState","feedLine","line","endsWith","feedSse","eventType","colon","field","sse","firstPercentIndex","start","percentIndex","encoded","parsed","_nextEvent","HAVE_EVENT","HAVE_ERROR","error_code","errorCode","error","nextEvent","out","nextNewlineIndex","MongoDBCollection","databaseName","collectionName","functions","find","options","database","collection","query","project","projection","sort","limit","findOne","findOneAndUpdate","update","upsert","returnNewDocument","findOneAndReplace","replacement","findOneAndDelete","aggregate","pipeline","insertOne","insertMany","documents","deleteOne","deleteMany","updateOne","updateMany","watch","_this","ids","iterator","watchStream","chunk","Promise","reject","createCollection","createDatabase","createService","db","DEFAULT_DEVICE_ID","UserState","UserType$1","User","parameters","_accessToken","_refreshToken","_profile","clone","userContext","currentUser","token","allUsers","LoggedOut","Active","Removed","isLoggedIn","customData","decodedToken","decodeAccessToken","userData","deviceId","payload","parsedPayload","refreshProfile","logOut","linkCredentials","credentials","authenticator","authenticate","details","refreshAccessToken","access_token","refreshCustomData","_len10","_key10","toJSON","mongoClient","parts","encodedPayload","decodedPayload","exp","expires","iat","issuedAt","sub","subject","user_data","Credentials","anonymous","userApiKey","serverApiKey","apiKey","emailPassword","email","password","username","function","jwt","google","derivePayload","includes","redirectUrl","authCode","idToken","id_token","facebook","redirectUrlOrAccessToken","apple","redirectUrlOrIdToken","USER_IDS_STORAGE_KEY","DEVICE_ID_STORAGE_KEY","AppStorage","getUserIds","userIdsString","userIds","setUserIds","mergeWithExisting","existingIds","removeUserId","getDeviceId","setDeviceId","LOWERCASE_LETTERS","CLOSE_CHECK_INTERVAL","REDIRECT_HASH_TO_RESULT","_stitch_client_app_id","_baas_client_app_id","_stitch_ua","_baas_ua","_stitch_link","_baas_link","_stitch_error","_baas_error","_stitch_state","_baas_state","OAuth2Helper","openWindow","parseRedirectLocation","queryString","handleRedirect","defaultStorage","oauth2Storage","stateStorage","getStateStorage","decodeAuthInfo","authInfo","openWindowAndWaitForRedirect","resolve","redirectWindow","windowClosedInterval","handleStorageUpdate","parsedResult","clearInterval","close","err","setInterval","closed","generateState","REDIRECT_LOCATION_HEADER","Authenticator","getDeviceInformation","oauth2","linkingUser","deviceInformation","isLinking","getLogInUrl","redirect","providerRedirectHeader","device","user","mode","openWindowAndWaitForAuthResponse","logInUrl","user_id","refresh_token","device_id","link","extraQueryParams","loginRoute","locationUrl","redirectResult","userAuth","MongoDBRealmError","statusText","summary","fromRequestAndResponse","json","asyncIteratorFromResponseBody","Symbol","asyncIterator","reader","getReader","next","read","return","cancel","done","Fetcher","_ref5","transport","locationUrlContext","buildAuthorizationHeader","Authorization","buildBody","log","buildJsonHeader","restOfRequest","ok","serializedBody","contentTypeHeaders","Accept","contentType","responseBody","DEVICE_ID_STORAGE_KEY$1","DeviceFields","DeviceInformation","_ref6","appVersion","sdkVersion","platformVersion","DEFAULT_BASE_URL","App","idOrConfiguration","users","_locationUrl","configuration","baseUrl","skipLocationRequest","localApp","baseStorage","hydrate","getApp","appCache","instance","switchUser","nextUser","findIndex","splice","unshift","logIn","fetchProfile","createOrUpdateUser","removeUser","activeUsers","_ref7","hostname","deviceIdStr","existingUser","LocalStorage","localStorage","global","getItem","setItem","removeItem","addEventListener","removeEventListener","DefaultStorage","open","environment$1","handleAuthRedirect","hash"],"sources":["C:/Users/sethk/Desktop/CS411B5Group7/ChatGPTInsta/node_modules/realm-web/dist/bundle.dom.es.js"],"sourcesContent":["import { EJSON, ObjectId } from 'bson';\nimport * as bson from 'bson';\nexport { bson as BSON };\n\nvar __spreadArray = (undefined && undefined.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar BrowserInfo = /** @class */ (function () {\n    function BrowserInfo(name, version, os) {\n        this.name = name;\n        this.version = version;\n        this.os = os;\n        this.type = 'browser';\n    }\n    return BrowserInfo;\n}());\nvar NodeInfo = /** @class */ (function () {\n    function NodeInfo(version) {\n        this.version = version;\n        this.type = 'node';\n        this.name = 'node';\n        this.os = process.platform;\n    }\n    return NodeInfo;\n}());\nvar SearchBotDeviceInfo = /** @class */ (function () {\n    function SearchBotDeviceInfo(name, version, os, bot) {\n        this.name = name;\n        this.version = version;\n        this.os = os;\n        this.bot = bot;\n        this.type = 'bot-device';\n    }\n    return SearchBotDeviceInfo;\n}());\nvar BotInfo = /** @class */ (function () {\n    function BotInfo() {\n        this.type = 'bot';\n        this.bot = true; // NOTE: deprecated test name instead\n        this.name = 'bot';\n        this.version = null;\n        this.os = null;\n    }\n    return BotInfo;\n}());\nvar ReactNativeInfo = /** @class */ (function () {\n    function ReactNativeInfo() {\n        this.type = 'react-native';\n        this.name = 'react-native';\n        this.version = null;\n        this.os = null;\n    }\n    return ReactNativeInfo;\n}());\n// tslint:disable-next-line:max-line-length\nvar SEARCHBOX_UA_REGEX = /alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/;\nvar SEARCHBOT_OS_REGEX = /(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\\ Jeeves\\/Teoma|ia_archiver)/;\nvar REQUIRED_VERSION_PARTS = 3;\nvar userAgentRules = [\n    ['aol', /AOLShield\\/([0-9\\._]+)/],\n    ['edge', /Edge\\/([0-9\\._]+)/],\n    ['edge-ios', /EdgiOS\\/([0-9\\._]+)/],\n    ['yandexbrowser', /YaBrowser\\/([0-9\\._]+)/],\n    ['kakaotalk', /KAKAOTALK\\s([0-9\\.]+)/],\n    ['samsung', /SamsungBrowser\\/([0-9\\.]+)/],\n    ['silk', /\\bSilk\\/([0-9._-]+)\\b/],\n    ['miui', /MiuiBrowser\\/([0-9\\.]+)$/],\n    ['beaker', /BeakerBrowser\\/([0-9\\.]+)/],\n    ['edge-chromium', /EdgA?\\/([0-9\\.]+)/],\n    [\n        'chromium-webview',\n        /(?!Chrom.*OPR)wv\\).*Chrom(?:e|ium)\\/([0-9\\.]+)(:?\\s|$)/,\n    ],\n    ['chrome', /(?!Chrom.*OPR)Chrom(?:e|ium)\\/([0-9\\.]+)(:?\\s|$)/],\n    ['phantomjs', /PhantomJS\\/([0-9\\.]+)(:?\\s|$)/],\n    ['crios', /CriOS\\/([0-9\\.]+)(:?\\s|$)/],\n    ['firefox', /Firefox\\/([0-9\\.]+)(?:\\s|$)/],\n    ['fxios', /FxiOS\\/([0-9\\.]+)/],\n    ['opera-mini', /Opera Mini.*Version\\/([0-9\\.]+)/],\n    ['opera', /Opera\\/([0-9\\.]+)(?:\\s|$)/],\n    ['opera', /OPR\\/([0-9\\.]+)(:?\\s|$)/],\n    ['ie', /Trident\\/7\\.0.*rv\\:([0-9\\.]+).*\\).*Gecko$/],\n    ['ie', /MSIE\\s([0-9\\.]+);.*Trident\\/[4-7].0/],\n    ['ie', /MSIE\\s(7\\.0)/],\n    ['bb10', /BB10;\\sTouch.*Version\\/([0-9\\.]+)/],\n    ['android', /Android\\s([0-9\\.]+)/],\n    ['ios', /Version\\/([0-9\\._]+).*Mobile.*Safari.*/],\n    ['safari', /Version\\/([0-9\\._]+).*Safari/],\n    ['facebook', /FB[AS]V\\/([0-9\\.]+)/],\n    ['instagram', /Instagram\\s([0-9\\.]+)/],\n    ['ios-webview', /AppleWebKit\\/([0-9\\.]+).*Mobile/],\n    ['ios-webview', /AppleWebKit\\/([0-9\\.]+).*Gecko\\)$/],\n    ['curl', /^curl\\/([0-9\\.]+)$/],\n    ['searchbot', SEARCHBOX_UA_REGEX],\n];\nvar operatingSystemRules = [\n    ['iOS', /iP(hone|od|ad)/],\n    ['Android OS', /Android/],\n    ['BlackBerry OS', /BlackBerry|BB10/],\n    ['Windows Mobile', /IEMobile/],\n    ['Amazon OS', /Kindle/],\n    ['Windows 3.11', /Win16/],\n    ['Windows 95', /(Windows 95)|(Win95)|(Windows_95)/],\n    ['Windows 98', /(Windows 98)|(Win98)/],\n    ['Windows 2000', /(Windows NT 5.0)|(Windows 2000)/],\n    ['Windows XP', /(Windows NT 5.1)|(Windows XP)/],\n    ['Windows Server 2003', /(Windows NT 5.2)/],\n    ['Windows Vista', /(Windows NT 6.0)/],\n    ['Windows 7', /(Windows NT 6.1)/],\n    ['Windows 8', /(Windows NT 6.2)/],\n    ['Windows 8.1', /(Windows NT 6.3)/],\n    ['Windows 10', /(Windows NT 10.0)/],\n    ['Windows ME', /Windows ME/],\n    ['Open BSD', /OpenBSD/],\n    ['Sun OS', /SunOS/],\n    ['Chrome OS', /CrOS/],\n    ['Linux', /(Linux)|(X11)/],\n    ['Mac OS', /(Mac_PowerPC)|(Macintosh)/],\n    ['QNX', /QNX/],\n    ['BeOS', /BeOS/],\n    ['OS/2', /OS\\/2/],\n];\nfunction detect(userAgent) {\n    if (!!userAgent) {\n        return parseUserAgent(userAgent);\n    }\n    if (typeof document === 'undefined' &&\n        typeof navigator !== 'undefined' &&\n        navigator.product === 'ReactNative') {\n        return new ReactNativeInfo();\n    }\n    if (typeof navigator !== 'undefined') {\n        return parseUserAgent(navigator.userAgent);\n    }\n    return getNodeVersion();\n}\nfunction matchUserAgent(ua) {\n    // opted for using reduce here rather than Array#first with a regex.test call\n    // this is primarily because using the reduce we only perform the regex\n    // execution once rather than once for the test and for the exec again below\n    // probably something that needs to be benchmarked though\n    return (ua !== '' &&\n        userAgentRules.reduce(function (matched, _a) {\n            var browser = _a[0], regex = _a[1];\n            if (matched) {\n                return matched;\n            }\n            var uaMatch = regex.exec(ua);\n            return !!uaMatch && [browser, uaMatch];\n        }, false));\n}\nfunction parseUserAgent(ua) {\n    var matchedRule = matchUserAgent(ua);\n    if (!matchedRule) {\n        return null;\n    }\n    var name = matchedRule[0], match = matchedRule[1];\n    if (name === 'searchbot') {\n        return new BotInfo();\n    }\n    // Do not use RegExp for split operation as some browser do not support it (See: http://blog.stevenlevithan.com/archives/cross-browser-split)\n    var versionParts = match[1] && match[1].split('.').join('_').split('_').slice(0, 3);\n    if (versionParts) {\n        if (versionParts.length < REQUIRED_VERSION_PARTS) {\n            versionParts = __spreadArray(__spreadArray([], versionParts, true), createVersionParts(REQUIRED_VERSION_PARTS - versionParts.length), true);\n        }\n    }\n    else {\n        versionParts = [];\n    }\n    var version = versionParts.join('.');\n    var os = detectOS(ua);\n    var searchBotMatch = SEARCHBOT_OS_REGEX.exec(ua);\n    if (searchBotMatch && searchBotMatch[1]) {\n        return new SearchBotDeviceInfo(name, version, os, searchBotMatch[1]);\n    }\n    return new BrowserInfo(name, version, os);\n}\nfunction detectOS(ua) {\n    for (var ii = 0, count = operatingSystemRules.length; ii < count; ii++) {\n        var _a = operatingSystemRules[ii], os = _a[0], regex = _a[1];\n        var match = regex.exec(ua);\n        if (match) {\n            return os;\n        }\n    }\n    return null;\n}\nfunction getNodeVersion() {\n    var isNode = typeof process !== 'undefined' && process.version;\n    return isNode ? new NodeInfo(process.version.slice(1)) : null;\n}\nfunction createVersionParts(count) {\n    var output = [];\n    for (var ii = 0; ii < count; ii++) {\n        output.push('0');\n    }\n    return output;\n}\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\nclass DefaultNetworkTransport {\n    constructor() {\n        if (!DefaultNetworkTransport.fetch) {\n            throw new Error(\"DefaultNetworkTransport.fetch must be set before it's used\");\n        }\n        if (!DefaultNetworkTransport.AbortController) {\n            throw new Error(\"DefaultNetworkTransport.AbortController must be set before it's used\");\n        }\n    }\n    fetchWithCallbacks(request, handler) {\n        // tslint:disable-next-line: no-console\n        this.fetch(request)\n            .then(async (response) => {\n            const decodedBody = await response.text();\n            // Pull out the headers of the response\n            const responseHeaders = {};\n            response.headers.forEach((value, key) => {\n                responseHeaders[key] = value;\n            });\n            return {\n                statusCode: response.status,\n                headers: responseHeaders,\n                body: decodedBody,\n            };\n        })\n            .then((r) => handler.onSuccess(r))\n            .catch((e) => handler.onError(e));\n    }\n    async fetch(request) {\n        const { timeoutMs, url, ...rest } = request;\n        const { signal, cancelTimeout } = this.createTimeoutSignal(timeoutMs);\n        try {\n            // We'll await the response to catch throw our own error\n            return await DefaultNetworkTransport.fetch(url, {\n                signal,\n                ...rest,\n            });\n        }\n        finally {\n            // Whatever happens, cancel any timeout\n            cancelTimeout();\n        }\n    }\n    createTimeoutSignal(timeoutMs) {\n        if (typeof timeoutMs === \"number\") {\n            const controller = new DefaultNetworkTransport.AbortController();\n            // Call abort after a specific number of milliseconds\n            const timeout = setTimeout(() => {\n                controller.abort();\n            }, timeoutMs);\n            return {\n                signal: controller.signal,\n                cancelTimeout: () => {\n                    clearTimeout(timeout);\n                },\n            };\n        }\n        else {\n            return {\n                signal: undefined,\n                cancelTimeout: () => {\n                    /* No-op */\n                },\n            };\n        }\n    }\n}\nDefaultNetworkTransport.DEFAULT_HEADERS = {\n    \"Content-Type\": \"application/json\",\n};\n\n////////////////////////////////////////////////////////////////////////////\nDefaultNetworkTransport.fetch = globalThis.fetch.bind(globalThis);\nDefaultNetworkTransport.AbortController = globalThis.AbortController;\n\n/**\n *  base64.ts\n *\n *  Licensed under the BSD 3-Clause License.\n *    http://opensource.org/licenses/BSD-3-Clause\n *\n *  References:\n *    http://en.wikipedia.org/wiki/Base64\n *\n * @author Dan Kogai (https://github.com/dankogai)\n */\nconst version = '3.7.2';\n/**\n * @deprecated use lowercase `version`.\n */\nconst VERSION = version;\nconst _hasatob = typeof atob === 'function';\nconst _hasbtoa = typeof btoa === 'function';\nconst _hasBuffer = typeof Buffer === 'function';\nconst _TD = typeof TextDecoder === 'function' ? new TextDecoder() : undefined;\nconst _TE = typeof TextEncoder === 'function' ? new TextEncoder() : undefined;\nconst b64ch = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\nconst b64chs = Array.prototype.slice.call(b64ch);\nconst b64tab = ((a) => {\n    let tab = {};\n    a.forEach((c, i) => tab[c] = i);\n    return tab;\n})(b64chs);\nconst b64re = /^(?:[A-Za-z\\d+\\/]{4})*?(?:[A-Za-z\\d+\\/]{2}(?:==)?|[A-Za-z\\d+\\/]{3}=?)?$/;\nconst _fromCC = String.fromCharCode.bind(String);\nconst _U8Afrom = typeof Uint8Array.from === 'function'\n    ? Uint8Array.from.bind(Uint8Array)\n    : (it, fn = (x) => x) => new Uint8Array(Array.prototype.slice.call(it, 0).map(fn));\nconst _mkUriSafe = (src) => src\n    .replace(/=/g, '').replace(/[+\\/]/g, (m0) => m0 == '+' ? '-' : '_');\nconst _tidyB64 = (s) => s.replace(/[^A-Za-z0-9\\+\\/]/g, '');\n/**\n * polyfill version of `btoa`\n */\nconst btoaPolyfill = (bin) => {\n    // console.log('polyfilled');\n    let u32, c0, c1, c2, asc = '';\n    const pad = bin.length % 3;\n    for (let i = 0; i < bin.length;) {\n        if ((c0 = bin.charCodeAt(i++)) > 255 ||\n            (c1 = bin.charCodeAt(i++)) > 255 ||\n            (c2 = bin.charCodeAt(i++)) > 255)\n            throw new TypeError('invalid character found');\n        u32 = (c0 << 16) | (c1 << 8) | c2;\n        asc += b64chs[u32 >> 18 & 63]\n            + b64chs[u32 >> 12 & 63]\n            + b64chs[u32 >> 6 & 63]\n            + b64chs[u32 & 63];\n    }\n    return pad ? asc.slice(0, pad - 3) + \"===\".substring(pad) : asc;\n};\n/**\n * does what `window.btoa` of web browsers do.\n * @param {String} bin binary string\n * @returns {string} Base64-encoded string\n */\nconst _btoa = _hasbtoa ? (bin) => btoa(bin)\n    : _hasBuffer ? (bin) => Buffer.from(bin, 'binary').toString('base64')\n        : btoaPolyfill;\nconst _fromUint8Array = _hasBuffer\n    ? (u8a) => Buffer.from(u8a).toString('base64')\n    : (u8a) => {\n        // cf. https://stackoverflow.com/questions/12710001/how-to-convert-uint8-array-to-base64-encoded-string/12713326#12713326\n        const maxargs = 0x1000;\n        let strs = [];\n        for (let i = 0, l = u8a.length; i < l; i += maxargs) {\n            strs.push(_fromCC.apply(null, u8a.subarray(i, i + maxargs)));\n        }\n        return _btoa(strs.join(''));\n    };\n/**\n * converts a Uint8Array to a Base64 string.\n * @param {boolean} [urlsafe] URL-and-filename-safe a la RFC4648 §5\n * @returns {string} Base64 string\n */\nconst fromUint8Array = (u8a, urlsafe = false) => urlsafe ? _mkUriSafe(_fromUint8Array(u8a)) : _fromUint8Array(u8a);\n// This trick is found broken https://github.com/dankogai/js-base64/issues/130\n// const utob = (src: string) => unescape(encodeURIComponent(src));\n// reverting good old fationed regexp\nconst cb_utob = (c) => {\n    if (c.length < 2) {\n        var cc = c.charCodeAt(0);\n        return cc < 0x80 ? c\n            : cc < 0x800 ? (_fromCC(0xc0 | (cc >>> 6))\n                + _fromCC(0x80 | (cc & 0x3f)))\n                : (_fromCC(0xe0 | ((cc >>> 12) & 0x0f))\n                    + _fromCC(0x80 | ((cc >>> 6) & 0x3f))\n                    + _fromCC(0x80 | (cc & 0x3f)));\n    }\n    else {\n        var cc = 0x10000\n            + (c.charCodeAt(0) - 0xD800) * 0x400\n            + (c.charCodeAt(1) - 0xDC00);\n        return (_fromCC(0xf0 | ((cc >>> 18) & 0x07))\n            + _fromCC(0x80 | ((cc >>> 12) & 0x3f))\n            + _fromCC(0x80 | ((cc >>> 6) & 0x3f))\n            + _fromCC(0x80 | (cc & 0x3f)));\n    }\n};\nconst re_utob = /[\\uD800-\\uDBFF][\\uDC00-\\uDFFFF]|[^\\x00-\\x7F]/g;\n/**\n * @deprecated should have been internal use only.\n * @param {string} src UTF-8 string\n * @returns {string} UTF-16 string\n */\nconst utob = (u) => u.replace(re_utob, cb_utob);\n//\nconst _encode = _hasBuffer\n    ? (s) => Buffer.from(s, 'utf8').toString('base64')\n    : _TE\n        ? (s) => _fromUint8Array(_TE.encode(s))\n        : (s) => _btoa(utob(s));\n/**\n * converts a UTF-8-encoded string to a Base64 string.\n * @param {boolean} [urlsafe] if `true` make the result URL-safe\n * @returns {string} Base64 string\n */\nconst encode = (src, urlsafe = false) => urlsafe\n    ? _mkUriSafe(_encode(src))\n    : _encode(src);\n/**\n * converts a UTF-8-encoded string to URL-safe Base64 RFC4648 §5.\n * @returns {string} Base64 string\n */\nconst encodeURI = (src) => encode(src, true);\n// This trick is found broken https://github.com/dankogai/js-base64/issues/130\n// const btou = (src: string) => decodeURIComponent(escape(src));\n// reverting good old fationed regexp\nconst re_btou = /[\\xC0-\\xDF][\\x80-\\xBF]|[\\xE0-\\xEF][\\x80-\\xBF]{2}|[\\xF0-\\xF7][\\x80-\\xBF]{3}/g;\nconst cb_btou = (cccc) => {\n    switch (cccc.length) {\n        case 4:\n            var cp = ((0x07 & cccc.charCodeAt(0)) << 18)\n                | ((0x3f & cccc.charCodeAt(1)) << 12)\n                | ((0x3f & cccc.charCodeAt(2)) << 6)\n                | (0x3f & cccc.charCodeAt(3)), offset = cp - 0x10000;\n            return (_fromCC((offset >>> 10) + 0xD800)\n                + _fromCC((offset & 0x3FF) + 0xDC00));\n        case 3:\n            return _fromCC(((0x0f & cccc.charCodeAt(0)) << 12)\n                | ((0x3f & cccc.charCodeAt(1)) << 6)\n                | (0x3f & cccc.charCodeAt(2)));\n        default:\n            return _fromCC(((0x1f & cccc.charCodeAt(0)) << 6)\n                | (0x3f & cccc.charCodeAt(1)));\n    }\n};\n/**\n * @deprecated should have been internal use only.\n * @param {string} src UTF-16 string\n * @returns {string} UTF-8 string\n */\nconst btou = (b) => b.replace(re_btou, cb_btou);\n/**\n * polyfill version of `atob`\n */\nconst atobPolyfill = (asc) => {\n    // console.log('polyfilled');\n    asc = asc.replace(/\\s+/g, '');\n    if (!b64re.test(asc))\n        throw new TypeError('malformed base64.');\n    asc += '=='.slice(2 - (asc.length & 3));\n    let u24, bin = '', r1, r2;\n    for (let i = 0; i < asc.length;) {\n        u24 = b64tab[asc.charAt(i++)] << 18\n            | b64tab[asc.charAt(i++)] << 12\n            | (r1 = b64tab[asc.charAt(i++)]) << 6\n            | (r2 = b64tab[asc.charAt(i++)]);\n        bin += r1 === 64 ? _fromCC(u24 >> 16 & 255)\n            : r2 === 64 ? _fromCC(u24 >> 16 & 255, u24 >> 8 & 255)\n                : _fromCC(u24 >> 16 & 255, u24 >> 8 & 255, u24 & 255);\n    }\n    return bin;\n};\n/**\n * does what `window.atob` of web browsers do.\n * @param {String} asc Base64-encoded string\n * @returns {string} binary string\n */\nconst _atob = _hasatob ? (asc) => atob(_tidyB64(asc))\n    : _hasBuffer ? (asc) => Buffer.from(asc, 'base64').toString('binary')\n        : atobPolyfill;\n//\nconst _toUint8Array = _hasBuffer\n    ? (a) => _U8Afrom(Buffer.from(a, 'base64'))\n    : (a) => _U8Afrom(_atob(a), c => c.charCodeAt(0));\n/**\n * converts a Base64 string to a Uint8Array.\n */\nconst toUint8Array = (a) => _toUint8Array(_unURI(a));\n//\nconst _decode = _hasBuffer\n    ? (a) => Buffer.from(a, 'base64').toString('utf8')\n    : _TD\n        ? (a) => _TD.decode(_toUint8Array(a))\n        : (a) => btou(_atob(a));\nconst _unURI = (a) => _tidyB64(a.replace(/[-_]/g, (m0) => m0 == '-' ? '+' : '/'));\n/**\n * converts a Base64 string to a UTF-8 string.\n * @param {String} src Base64 string.  Both normal and URL-safe are supported\n * @returns {string} UTF-8 string\n */\nconst decode = (src) => _decode(_unURI(src));\n/**\n * check if a value is a valid Base64 string\n * @param {String} src a value to check\n  */\nconst isValid = (src) => {\n    if (typeof src !== 'string')\n        return false;\n    const s = src.replace(/\\s+/g, '').replace(/={0,2}$/, '');\n    return !/[^\\s0-9a-zA-Z\\+/]/.test(s) || !/[^\\s0-9a-zA-Z\\-_]/.test(s);\n};\n//\nconst _noEnum = (v) => {\n    return {\n        value: v, enumerable: false, writable: true, configurable: true\n    };\n};\n/**\n * extend String.prototype with relevant methods\n */\nconst extendString = function () {\n    const _add = (name, body) => Object.defineProperty(String.prototype, name, _noEnum(body));\n    _add('fromBase64', function () { return decode(this); });\n    _add('toBase64', function (urlsafe) { return encode(this, urlsafe); });\n    _add('toBase64URI', function () { return encode(this, true); });\n    _add('toBase64URL', function () { return encode(this, true); });\n    _add('toUint8Array', function () { return toUint8Array(this); });\n};\n/**\n * extend Uint8Array.prototype with relevant methods\n */\nconst extendUint8Array = function () {\n    const _add = (name, body) => Object.defineProperty(Uint8Array.prototype, name, _noEnum(body));\n    _add('toBase64', function (urlsafe) { return fromUint8Array(this, urlsafe); });\n    _add('toBase64URI', function () { return fromUint8Array(this, true); });\n    _add('toBase64URL', function () { return fromUint8Array(this, true); });\n};\n/**\n * extend Builtin prototypes with relevant methods\n */\nconst extendBuiltins = () => {\n    extendString();\n    extendUint8Array();\n};\nconst gBase64 = {\n    version: version,\n    VERSION: VERSION,\n    atob: _atob,\n    atobPolyfill: atobPolyfill,\n    btoa: _btoa,\n    btoaPolyfill: btoaPolyfill,\n    fromBase64: decode,\n    toBase64: encode,\n    encode: encode,\n    encodeURI: encodeURI,\n    encodeURL: encodeURI,\n    utob: utob,\n    btou: btou,\n    decode: decode,\n    isValid: isValid,\n    fromUint8Array: fromUint8Array,\n    toUint8Array: toUint8Array,\n    extendString: extendString,\n    extendUint8Array: extendUint8Array,\n    extendBuiltins: extendBuiltins,\n};\n\n////////////////////////////////////////////////////////////////////////////\nconst SERIALIZATION_OPTIONS = {\n    relaxed: false, // Ensure Canonical mode\n};\n/**\n * Serialize an object containing BSON types into extended-JSON.\n *\n * @param obj The object containing BSON types.\n * @returns The document in extended-JSON format.\n */\nfunction serialize(obj) {\n    return EJSON.serialize(obj, SERIALIZATION_OPTIONS);\n}\n/**\n * De-serialize an object or an array of object from extended-JSON into an object or an array of object with BSON types.\n *\n * @param obj The object or array of objects in extended-JSON format.\n * @returns The object or array of objects with inflated BSON types.\n */\nfunction deserialize(obj) {\n    if (Array.isArray(obj)) {\n        return obj.map((doc) => EJSON.deserialize(doc));\n    }\n    else {\n        return EJSON.deserialize(obj);\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * The type of a user.\n */\nvar UserType;\n(function (UserType) {\n    /**\n     * A normal end-user created this user.\n     */\n    UserType[\"Normal\"] = \"normal\";\n    /**\n     * The user was created by the server.\n     */\n    UserType[\"Server\"] = \"server\";\n})(UserType || (UserType = {}));\n/** @ignore */\nvar DataKey;\n(function (DataKey) {\n    /** @ignore */\n    DataKey[\"NAME\"] = \"name\";\n    /** @ignore */\n    DataKey[\"EMAIL\"] = \"email\";\n    /** @ignore */\n    DataKey[\"PICTURE\"] = \"picture\";\n    /** @ignore */\n    DataKey[\"FIRST_NAME\"] = \"first_name\";\n    /** @ignore */\n    DataKey[\"LAST_NAME\"] = \"last_name\";\n    /** @ignore */\n    DataKey[\"GENDER\"] = \"gender\";\n    /** @ignore */\n    DataKey[\"BIRTHDAY\"] = \"birthday\";\n    /** @ignore */\n    DataKey[\"MIN_AGE\"] = \"min_age\";\n    /** @ignore */\n    DataKey[\"MAX_AGE\"] = \"max_age\";\n})(DataKey || (DataKey = {}));\nconst DATA_MAPPING = {\n    [DataKey.NAME]: \"name\",\n    [DataKey.EMAIL]: \"email\",\n    [DataKey.PICTURE]: \"pictureUrl\",\n    [DataKey.FIRST_NAME]: \"firstName\",\n    [DataKey.LAST_NAME]: \"lastName\",\n    [DataKey.GENDER]: \"gender\",\n    [DataKey.BIRTHDAY]: \"birthday\",\n    [DataKey.MIN_AGE]: \"minAge\",\n    [DataKey.MAX_AGE]: \"maxAge\",\n};\n/** @inheritdoc */\nclass UserProfile {\n    /**\n     * @param response The response of a call fetching the users profile.\n     */\n    constructor(response) {\n        /** @ignore */\n        this.type = UserType.Normal;\n        /** @ignore */\n        this.identities = [];\n        if (typeof response === \"object\" && response !== null) {\n            const { type, identities, data } = response;\n            if (typeof type === \"string\") {\n                this.type = type;\n            }\n            else {\n                throw new Error(\"Expected 'type' in the response body\");\n            }\n            if (Array.isArray(identities)) {\n                this.identities = identities.map((identity) => {\n                    const { id, provider_type: providerType } = identity;\n                    return { id, providerType };\n                });\n            }\n            else {\n                throw new Error(\"Expected 'identities' in the response body\");\n            }\n            if (typeof data === \"object\" && data !== null) {\n                const mappedData = Object.fromEntries(Object.entries(data).map(([key, value]) => {\n                    if (key in DATA_MAPPING) {\n                        // Translate any known data field to its JS idiomatic alias\n                        return [DATA_MAPPING[key], value];\n                    }\n                    else {\n                        // Pass through any other values\n                        return [key, value];\n                    }\n                }));\n                // We can use `any` since we trust the user supplies the correct type\n                this.data = deserialize(mappedData);\n            }\n            else {\n                throw new Error(\"Expected 'data' in the response body\");\n            }\n        }\n        else {\n            this.data = {};\n        }\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\n/**\n * A `Storage` which will prefix a key part to every operation.\n */\nclass PrefixedStorage {\n    /**\n     * Construct a `Storage` which will prefix a key part to every operation.\n     *\n     * @param storage The underlying storage to use for operations.\n     * @param keyPart The part of the key to prefix when performing operations.\n     */\n    constructor(storage, keyPart) {\n        this.storage = storage;\n        this.keyPart = keyPart;\n    }\n    /** @inheritdoc */\n    get(key) {\n        return this.storage.get(this.keyPart + PrefixedStorage.PART_SEPARATOR + key);\n    }\n    /** @inheritdoc */\n    set(key, value) {\n        return this.storage.set(this.keyPart + PrefixedStorage.PART_SEPARATOR + key, value);\n    }\n    /** @inheritdoc */\n    remove(key) {\n        return this.storage.remove(this.keyPart + PrefixedStorage.PART_SEPARATOR + key);\n    }\n    /** @inheritdoc */\n    prefix(keyPart) {\n        return new PrefixedStorage(this, keyPart);\n    }\n    /** @inheritdoc */\n    clear(prefix = \"\") {\n        return this.storage.clear(this.keyPart + PrefixedStorage.PART_SEPARATOR + prefix);\n    }\n    /** @inheritdoc */\n    addListener(listener) {\n        return this.storage.addListener(listener);\n    }\n    /** @inheritdoc */\n    removeListener(listener) {\n        return this.storage.addListener(listener);\n    }\n}\n/**\n * The string separating two parts.\n */\nPrefixedStorage.PART_SEPARATOR = \":\";\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * In-memory storage that will not be persisted.\n */\nclass MemoryStorage {\n    constructor() {\n        /**\n         * Internal state of the storage.\n         */\n        this.storage = {};\n        /**\n         * A set of listners.\n         */\n        this.listeners = new Set();\n    }\n    /** @inheritdoc */\n    get(key) {\n        if (key in this.storage) {\n            return this.storage[key];\n        }\n        else {\n            return null;\n        }\n    }\n    /** @inheritdoc */\n    set(key, value) {\n        this.storage[key] = value;\n        // Fire the listeners\n        this.fireListeners();\n    }\n    /** @inheritdoc */\n    remove(key) {\n        delete this.storage[key];\n        // Fire the listeners\n        this.fireListeners();\n    }\n    /** @inheritdoc */\n    prefix(keyPart) {\n        return new PrefixedStorage(this, keyPart);\n    }\n    /** @inheritdoc */\n    clear(prefix) {\n        // Iterate all keys and delete their values if they have a matching prefix\n        for (const key of Object.keys(this.storage)) {\n            if (!prefix || key.startsWith(prefix)) {\n                delete this.storage[key];\n            }\n        }\n        // Fire the listeners\n        this.fireListeners();\n    }\n    /** @inheritdoc */\n    addListener(listener) {\n        this.listeners.add(listener);\n    }\n    /** @inheritdoc */\n    removeListener(listener) {\n        this.listeners.delete(listener);\n    }\n    /**\n     * Tell the listeners that a change occurred.\n     */\n    fireListeners() {\n        this.listeners.forEach((listener) => listener());\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\nconst ACCESS_TOKEN_STORAGE_KEY = \"accessToken\";\nconst REFRESH_TOKEN_STORAGE_KEY = \"refreshToken\";\nconst PROFILE_STORAGE_KEY = \"profile\";\nconst PROVIDER_TYPE_STORAGE_KEY = \"providerType\";\n/**\n * Storage specific to the app.\n */\nclass UserStorage extends PrefixedStorage {\n    /**\n     * Construct a storage for a `User`.\n     *\n     * @param storage The underlying storage to wrap.\n     * @param userId The id of the user.\n     */\n    constructor(storage, userId) {\n        super(storage, `user(${userId})`);\n    }\n    /**\n     * Get the access token from storage.\n     *\n     * @returns Access token (null if unknown).\n     */\n    get accessToken() {\n        return this.get(ACCESS_TOKEN_STORAGE_KEY);\n    }\n    /**\n     * Set the access token in storage.\n     *\n     * @param value Access token (null if unknown).\n     */\n    set accessToken(value) {\n        if (value === null) {\n            this.remove(ACCESS_TOKEN_STORAGE_KEY);\n        }\n        else {\n            this.set(ACCESS_TOKEN_STORAGE_KEY, value);\n        }\n    }\n    /**\n     * Get the refresh token from storage.\n     *\n     * @returns Refresh token (null if unknown and user is logged out).\n     */\n    get refreshToken() {\n        return this.get(REFRESH_TOKEN_STORAGE_KEY);\n    }\n    /**\n     * Set the refresh token in storage.\n     *\n     * @param value Refresh token (null if unknown and user is logged out).\n     */\n    set refreshToken(value) {\n        if (value === null) {\n            this.remove(REFRESH_TOKEN_STORAGE_KEY);\n        }\n        else {\n            this.set(REFRESH_TOKEN_STORAGE_KEY, value);\n        }\n    }\n    /**\n     * Get the user profile from storage.\n     *\n     * @returns User profile (undefined if its unknown).\n     */\n    get profile() {\n        const value = this.get(PROFILE_STORAGE_KEY);\n        if (value) {\n            const profile = new UserProfile();\n            // Patch in the values\n            Object.assign(profile, JSON.parse(value));\n            return profile;\n        }\n    }\n    /**\n     * Set the user profile in storage.\n     *\n     * @param value User profile (undefined if its unknown).\n     */\n    set profile(value) {\n        if (value) {\n            this.set(PROFILE_STORAGE_KEY, JSON.stringify(value));\n        }\n        else {\n            this.remove(PROFILE_STORAGE_KEY);\n        }\n    }\n    /**\n     * Get the type of authentication provider used to authenticate\n     *\n     * @returns User profile (undefined if its unknown).\n     */\n    get providerType() {\n        const value = this.get(PROVIDER_TYPE_STORAGE_KEY);\n        if (value) {\n            return value;\n        }\n    }\n    /**\n     * Set the type of authentication provider used to authenticate\n     *\n     * @param value Type of authentication provider.\n     */\n    set providerType(value) {\n        if (value) {\n            this.set(PROVIDER_TYPE_STORAGE_KEY, value);\n        }\n        else {\n            this.remove(PROVIDER_TYPE_STORAGE_KEY);\n        }\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\n/**\n * @param obj The object to remove keys (and undefined values from)\n * @returns A new object without the keys where the value is undefined.\n */\nfunction removeKeysWithUndefinedValues(obj) {\n    return Object.fromEntries(Object.entries(obj).filter((entry) => typeof entry[1] !== \"undefined\"));\n}\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * Generate a random sequence of characters.\n *\n * @param length The length of the string.\n * @param alphabet The alphabet of characters to pick from.\n * @returns A string of characters picked randomly from `alphabet`.\n */\nfunction generateRandomString(length, alphabet) {\n    let result = \"\";\n    for (let i = 0; i < length; i++) {\n        result += alphabet[Math.floor(Math.random() * alphabet.length)];\n    }\n    return result;\n}\n/**\n * Encode an object mapping from string to string, into a query string to be appended a URL.\n *\n * @param params The parameters to include in the string.\n * @param prefixed Should the \"?\" prefix be added if values exists?\n * @returns A URL encoded representation of the parameters (omitting a \"?\" prefix).\n */\nfunction encodeQueryString(params, prefixed = true) {\n    // Filter out undefined values\n    const cleanedParams = removeKeysWithUndefinedValues(params);\n    // Determine if a prefixed \"?\" is appropreate\n    const prefix = prefixed && Object.keys(cleanedParams).length > 0 ? \"?\" : \"\";\n    // Transform keys and values to a query string\n    return (prefix +\n        Object.entries(cleanedParams)\n            .map(([k, v]) => `${k}=${encodeURIComponent(v)}`)\n            .join(\"&\"));\n}\n/**\n * Decodes a query string into an object.\n *\n * @param str The query string to decode.\n * @returns The decoded query string.\n */\nfunction decodeQueryString(str) {\n    const cleanStr = str[0] === \"?\" ? str.substr(1) : str;\n    return Object.fromEntries(cleanStr\n        .split(\"&\")\n        .filter((s) => s.length > 0)\n        .map((kvp) => kvp.split(\"=\"))\n        .map(([k, v]) => [k, decodeURIComponent(v)]));\n}\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * A list of names that functions cannot have to be callable through the functions proxy.\n */\nconst RESERVED_NAMES = [\n    \"inspect\",\n    \"callFunction\",\n    \"callFunctionStreaming\",\n    // Methods defined on the Object.prototype might be \"typeof probed\" and called by libraries and runtime environments.\n    ...Object.getOwnPropertyNames(Object.prototype),\n];\n/**\n * Remove the key for any fields with undefined values.\n *\n * @param args The arguments to clean.\n * @returns The cleaned arguments.\n */\nfunction cleanArgs(args) {\n    for (const arg of args) {\n        if (typeof arg === \"object\" && arg) {\n            for (const [key, value] of Object.entries(arg)) {\n                if (value === undefined) {\n                    delete arg[key];\n                }\n            }\n        }\n    }\n    return args;\n}\n/**\n * Remove keys for any undefined values and serialize to EJSON.\n *\n * @param args The arguments to clean and serialize.\n * @returns The cleaned and serialized arguments.\n */\nfunction cleanArgsAndSerialize(args) {\n    const cleaned = cleanArgs(args);\n    return cleaned.map((arg) => (typeof arg === \"object\" ? serialize(arg) : arg));\n}\n/**\n * Defines how functions are called.\n */\nclass FunctionsFactory {\n    /**\n     * @param fetcher The underlying fetcher to use when sending requests.\n     * @param config Additional configuration parameters.\n     */\n    constructor(fetcher, config = {}) {\n        this.fetcher = fetcher;\n        this.serviceName = config.serviceName;\n        this.argsTransformation = config.argsTransformation || cleanArgsAndSerialize;\n    }\n    /**\n     * Create a factory of functions, wrapped in a Proxy that returns bound copies of `callFunction` on any property.\n     *\n     * @param fetcher The underlying fetcher to use when requesting.\n     * @param config Additional configuration parameters.\n     * @returns The newly created factory of functions.\n     */\n    static create(fetcher, config = {}) {\n        // Create a proxy, wrapping a simple object returning methods that calls functions\n        // TODO: Lazily fetch available functions and return these from the ownKeys() trap\n        const factory = new FunctionsFactory(fetcher, config);\n        // Wrap the factory in a proxy that calls the internal call method\n        return new Proxy(factory, {\n            get(target, p, receiver) {\n                if (typeof p === \"string\" && RESERVED_NAMES.indexOf(p) === -1) {\n                    return target.callFunction.bind(target, p);\n                }\n                else {\n                    const prop = Reflect.get(target, p, receiver);\n                    return typeof prop === \"function\" ? prop.bind(target) : prop;\n                }\n            },\n        });\n    }\n    /**\n     * Call a remote function by it's name.\n     *\n     * @param name Name of the remote function.\n     * @param args Arguments to pass to the remote function.\n     * @returns A promise of the value returned when executing the remote function.\n     */\n    async callFunction(name, ...args) {\n        // See https://github.com/mongodb/stitch-js-sdk/blob/master/packages/core/sdk/src/services/internal/CoreStitchServiceClientImpl.ts\n        const body = {\n            name,\n            arguments: this.argsTransformation ? this.argsTransformation(args) : args,\n        };\n        if (this.serviceName) {\n            body.service = this.serviceName;\n        }\n        const appRoute = this.fetcher.appRoute;\n        return this.fetcher.fetchJSON({\n            method: \"POST\",\n            path: appRoute.functionsCall().path,\n            body,\n        });\n    }\n    /**\n     * Call a remote function by it's name.\n     *\n     * @param name Name of the remote function.\n     * @param args Arguments to pass to the remote function.\n     * @returns A promise of the value returned when executing the remote function.\n     */\n    callFunctionStreaming(name, ...args) {\n        const body = {\n            name,\n            arguments: this.argsTransformation ? this.argsTransformation(args) : args,\n        };\n        if (this.serviceName) {\n            body.service = this.serviceName;\n        }\n        const appRoute = this.fetcher.appRoute;\n        const qs = encodeQueryString({\n            [\"baas_request\"]: gBase64.encode(JSON.stringify(body)),\n        });\n        return this.fetcher.fetchStream({\n            method: \"GET\",\n            path: appRoute.functionsCall().path + qs,\n        });\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2021 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\n/**\n * Check whether the user's app is running in \"development mode\" (e.g. `npm run dev`\n * for a React app, or `NODE_ENV=development` for a Node app). Each platform's entry\n * point should define the value of this using `setIsDevelopmentMode`.\n * The default behaviour is to always return `false`.\n *\n * @returns true if the user's app is running in development mode, false otherwise\n */\nlet isDevelopmentMode = false;\n/**\n * Set the value of `isDevelopmentMode`. This allows each entry point (node vs DOM)\n * to use its own method for determining whether we are in development mode.\n *\n * @param state A boolean indicating whether the user's app is running in\n * development mode or not.\n */\nconst setIsDevelopmentMode = (state) => {\n    isDevelopmentMode = state;\n};\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * Display a deprecation warning for features being removed in the next major version\n * to users in development mode (as best as we can detect this, see `isDevelopmentMode`)\n *\n * @param deprecatedItem The method signature or name of the deprecated item\n * @param suggestedReplacement The method signature or name of the suggested replacement\n */\nconst deprecationWarning = (deprecatedItem, suggestedReplacement) => {\n    if (!isDevelopmentMode)\n        return;\n    console.warn(`Deprecation warning from Realm: ${deprecatedItem} is deprecated and will be removed in a future major release. Consider switching to ${suggestedReplacement}.`);\n};\n/**\n * Helper function for migrating from positional arguments to a single dictionary argument.\n * Check the arguments passed to a function, if the first argument is not an object (i.e. it\n * is presumed to be a deprecated positional-style call), shows a deprecation warning and\n * converts the positional arguments into an object matching the expected \"new\" shape.\n *\n * @param args Array of arguments passed to the function (captured with `...args`).\n * @param methodName The name of the method, used to show the deprecation warning.\n * @param argNames The list of positional argument names, used to covert them into\n * an object if a deprecated call is made and to show the deprecation warning.\n * @param hasRestArgs Optional flag indicating that the function's final argument is\n * `...args` (to capture any extra arguments), in which case we capture them and return\n * as the second element of the return array.\n *\n * @returns An object containing:\n *\n * argsObject: a dictionary of function arguments, either passed through from args[0] if\n * args[0] is an object, or created from `args` and `argNames` if the args are a\n * deprecated positional argument call.\n *\n * restArgs: an array of the \"...args\" passed to the function if `hasRestArgs` is true;\n * otherwise it is `undefined`.\n */\n// Allow use of `object` type\n// eslint-disable-next-line @typescript-eslint/ban-types\nconst handleDeprecatedPositionalArgs = (args, methodName, argNames, hasRestArgs) => {\n    if (typeof args[0] !== \"object\") {\n        const restArgsText = hasRestArgs ? \", ...args\" : \"\";\n        deprecationWarning(`${methodName}(${argNames.join(\", \")}${restArgsText})`, `${methodName}({ ${argNames.join(\", \")} }${restArgsText})`);\n        // Convert the array of arguments into a dictionary keyed by the relevant argName\n        const argsObject = argNames.reduce((prev, argName, index) => {\n            return { ...prev, [argName]: args[index] };\n        }, {});\n        const restArgs = hasRestArgs ? args.slice(argNames.length) : undefined;\n        return { argsObject, restArgs };\n    }\n    return { argsObject: args[0], restArgs: hasRestArgs ? args.slice(1) : undefined };\n};\n\n////////////////////////////////////////////////////////////////////////////\n// React/React Native set a global __DEV__ variable when running in dev mode\nsetIsDevelopmentMode(typeof __DEV__ !== \"undefined\" && __DEV__);\n\n////////////////////////////////////////////////////////////////////////////\n/** @inheritdoc */\nclass EmailPasswordAuth {\n    /**\n     * Construct an interface to the email / password authentication provider.\n     *\n     * @param fetcher The underlying fetcher used to request the services.\n     * @param providerName Optional custom name of the authentication provider.\n     */\n    constructor(fetcher, providerName = \"local-userpass\") {\n        this.fetcher = fetcher;\n        this.providerName = providerName;\n    }\n    async registerUser(...args) {\n        const { argsObject: userDetails } = handleDeprecatedPositionalArgs(args, \"registerUser\", [\"email\", \"password\"]);\n        const appRoute = this.fetcher.appRoute;\n        await this.fetcher.fetchJSON({\n            method: \"POST\",\n            path: appRoute.emailPasswordAuth(this.providerName).register().path,\n            body: userDetails,\n        });\n    }\n    async confirmUser(...args) {\n        const { argsObject: tokenDetails } = handleDeprecatedPositionalArgs(args, \"confirmUser\", [\"token\", \"tokenId\"]);\n        const appRoute = this.fetcher.appRoute;\n        await this.fetcher.fetchJSON({\n            method: \"POST\",\n            path: appRoute.emailPasswordAuth(this.providerName).confirm().path,\n            body: tokenDetails,\n        });\n    }\n    async resendConfirmationEmail(...args) {\n        const { argsObject: emailDetails } = handleDeprecatedPositionalArgs(args, \"resendConfirmationEmail\", [\"email\"]);\n        const appRoute = this.fetcher.appRoute;\n        await this.fetcher.fetchJSON({\n            method: \"POST\",\n            path: appRoute.emailPasswordAuth(this.providerName).confirmSend().path,\n            body: emailDetails,\n        });\n    }\n    async retryCustomConfirmation(...args) {\n        const { argsObject: emailDetails } = handleDeprecatedPositionalArgs(args, \"retryCustomConfirmation\", [\"email\"]);\n        const appRoute = this.fetcher.appRoute;\n        await this.fetcher.fetchJSON({\n            method: \"POST\",\n            path: appRoute.emailPasswordAuth(this.providerName).confirmCall().path,\n            body: emailDetails,\n        });\n    }\n    async resetPassword(...args) {\n        const { argsObject: resetDetails } = handleDeprecatedPositionalArgs(args, \"resetPassword\", [\"token\", \"tokenId\", \"password\"]);\n        const appRoute = this.fetcher.appRoute;\n        await this.fetcher.fetchJSON({\n            method: \"POST\",\n            path: appRoute.emailPasswordAuth(this.providerName).reset().path,\n            body: resetDetails,\n        });\n    }\n    async sendResetPasswordEmail(...args) {\n        const { argsObject: emailDetails } = handleDeprecatedPositionalArgs(args, \"sendResetPasswordEmail\", [\"email\"]);\n        const appRoute = this.fetcher.appRoute;\n        await this.fetcher.fetchJSON({\n            method: \"POST\",\n            path: appRoute.emailPasswordAuth(this.providerName).resetSend().path,\n            body: emailDetails,\n        });\n    }\n    async callResetPasswordFunction(...args) {\n        const { argsObject: resetDetails, restArgs, } = handleDeprecatedPositionalArgs(args, \"callResetPasswordFunction\", [\"email\", \"password\"], true);\n        const appRoute = this.fetcher.appRoute;\n        await this.fetcher.fetchJSON({\n            method: \"POST\",\n            path: appRoute.emailPasswordAuth(this.providerName).resetCall().path,\n            body: { ...resetDetails, arguments: restArgs },\n        });\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\n/**\n * @returns The base api route.\n */\nfunction api() {\n    return {\n        path: \"/api/client/v2.0\",\n        /**\n         * @param appId The id of the app.\n         * @returns The URL of the app endpoint.\n         */\n        app(appId) {\n            return {\n                path: this.path + `/app/${appId}`,\n                /**\n                 * @returns The URL of the app location endpoint.\n                 */\n                location() {\n                    return {\n                        path: this.path + \"/location\",\n                    };\n                },\n                /**\n                 * @param providerName The name of the provider.\n                 * @returns The app url concatinated with the /auth/providers/{providerName}\n                 */\n                authProvider(providerName) {\n                    return {\n                        path: this.path + `/auth/providers/${providerName}`,\n                        /**\n                         * @returns Get the URL of an authentication provider.\n                         */\n                        login() {\n                            return { path: this.path + \"/login\" };\n                        },\n                    };\n                },\n                /**\n                 * @param providerName The name of the provider.\n                 * @returns The app url concatinated with the /auth/providers/{providerName}\n                 */\n                emailPasswordAuth(providerName) {\n                    const authProviderRoutes = this.authProvider(providerName);\n                    return {\n                        ...authProviderRoutes,\n                        register() {\n                            return { path: this.path + \"/register\" };\n                        },\n                        confirm() {\n                            return { path: this.path + \"/confirm\" };\n                        },\n                        confirmSend() {\n                            return { path: this.path + \"/confirm/send\" };\n                        },\n                        confirmCall() {\n                            return { path: this.path + \"/confirm/call\" };\n                        },\n                        reset() {\n                            return { path: this.path + \"/reset\" };\n                        },\n                        resetSend() {\n                            return { path: this.path + \"/reset/send\" };\n                        },\n                        resetCall() {\n                            return { path: this.path + \"/reset/call\" };\n                        },\n                    };\n                },\n                functionsCall() {\n                    return {\n                        path: this.path + \"/functions/call\",\n                    };\n                },\n            };\n        },\n        auth() {\n            return {\n                path: this.path + \"/auth\",\n                apiKeys() {\n                    return {\n                        path: this.path + \"/api_keys\",\n                        key(id) {\n                            return {\n                                path: this.path + `/${id}`,\n                                enable() {\n                                    return { path: this.path + \"/enable\" };\n                                },\n                                disable() {\n                                    return { path: this.path + \"/disable\" };\n                                },\n                            };\n                        },\n                    };\n                },\n                profile() {\n                    return { path: this.path + \"/profile\" };\n                },\n                session() {\n                    return { path: this.path + \"/session\" };\n                },\n            };\n        },\n    };\n}\nvar routes = { api };\n\n////////////////////////////////////////////////////////////////////////////\n/** @inheritdoc */\nclass ApiKeyAuth {\n    /**\n     * Construct an interface to the API-key authentication provider.\n     *\n     * @param fetcher The fetcher used to send requests to services.\n     */\n    constructor(fetcher) {\n        this.fetcher = fetcher;\n    }\n    /** @inheritdoc */\n    create(name) {\n        return this.fetcher.fetchJSON({\n            method: \"POST\",\n            body: { name },\n            path: routes.api().auth().apiKeys().path,\n            tokenType: \"refresh\",\n        });\n    }\n    /** @inheritdoc */\n    fetch(keyId) {\n        return this.fetcher.fetchJSON({\n            method: \"GET\",\n            path: routes.api().auth().apiKeys().key(keyId).path,\n            tokenType: \"refresh\",\n        });\n    }\n    /** @inheritdoc */\n    fetchAll() {\n        return this.fetcher.fetchJSON({\n            method: \"GET\",\n            tokenType: \"refresh\",\n            path: routes.api().auth().apiKeys().path,\n        });\n    }\n    /** @inheritdoc */\n    async delete(keyId) {\n        await this.fetcher.fetchJSON({\n            method: \"DELETE\",\n            path: routes.api().auth().apiKeys().key(keyId).path,\n            tokenType: \"refresh\",\n        });\n    }\n    /** @inheritdoc */\n    async enable(keyId) {\n        await this.fetcher.fetchJSON({\n            method: \"PUT\",\n            path: routes.api().auth().apiKeys().key(keyId).enable().path,\n            tokenType: \"refresh\",\n        });\n    }\n    /** @inheritdoc */\n    async disable(keyId) {\n        await this.fetcher.fetchJSON({\n            method: \"PUT\",\n            path: routes.api().auth().apiKeys().key(keyId).disable().path,\n            tokenType: \"refresh\",\n        });\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\nlet environment = null;\n/**\n * Set the environment of execution.\n * Note: This should be called as the first thing before executing any code which calls getEnvironment()\n *\n * @param e An object containing environment specific implementations.\n */\nfunction setEnvironment(e) {\n    environment = e;\n}\n/**\n * Get the environment of execution.\n *\n * @returns An object containing environment specific implementations.\n */\nfunction getEnvironment() {\n    if (environment) {\n        return environment;\n    }\n    else {\n        throw new Error(\"Cannot get environment before it's set\");\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\n/**\n * An error occured during the parsing of a watch stream.\n */\nclass WatchError extends Error {\n    constructor({ message, code }) {\n        super(message);\n        /**\n         * The name of this type of error\n         */\n        this.name = \"WatchError\";\n        this.code = code;\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\n// NOTE: this is a fully processed event, not a single \"data: foo\" line!\n/**\n * The state of a WatchStream.\n */\nvar WatchStreamState;\n(function (WatchStreamState) {\n    /**\n     * Need to call one of the feed functions.\n     */\n    WatchStreamState[\"NEED_DATA\"] = \"NEED_DATA\";\n    /**\n     * Call nextEvent() to consume an event.\n     */\n    WatchStreamState[\"HAVE_EVENT\"] = \"HAVE_EVENT\";\n    /**\n     * Call error().\n     */\n    WatchStreamState[\"HAVE_ERROR\"] = \"HAVE_ERROR\";\n})(WatchStreamState || (WatchStreamState = {}));\n/**\n * Represents a stream of events\n */\nclass WatchStream {\n    constructor() {\n        this._state = WatchStreamState.NEED_DATA;\n        this._error = null;\n        // Used by feedBuffer to construct lines\n        this._textDecoder = new (getEnvironment().TextDecoder)();\n        this._buffer = \"\";\n        this._bufferOffset = 0;\n        // Used by feedLine for building the next SSE\n        this._eventType = \"\";\n        this._dataBuffer = \"\";\n    }\n    // Call these when you have data, in whatever shape is easiest for your SDK to get.\n    // Pick one, mixing and matching on a single instance isn't supported.\n    // These can only be called in NEED_DATA state, which is the initial state.\n    feedBuffer(buffer) {\n        this.assertState(WatchStreamState.NEED_DATA);\n        this._buffer += this._textDecoder.decode(buffer, { stream: true });\n        this.advanceBufferState();\n    }\n    feedLine(line) {\n        this.assertState(WatchStreamState.NEED_DATA);\n        // This is an implementation of the algorithm described at\n        // https://html.spec.whatwg.org/multipage/server-sent-events.html#event-stream-interpretation.\n        // Currently the server does not use id or retry lines, so that processing isn't implemented.\n        // ignore trailing LF if not removed by SDK.\n        if (line.endsWith(\"\\n\"))\n            line = line.substr(0, line.length - 1);\n        // ignore trailing CR from CRLF\n        if (line.endsWith(\"\\r\"))\n            line = line.substr(0, line.length - 1);\n        if (line.length === 0) {\n            // This is the \"dispatch the event\" portion of the algorithm.\n            if (this._dataBuffer.length === 0) {\n                this._eventType = \"\";\n                return;\n            }\n            if (this._dataBuffer.endsWith(\"\\n\"))\n                this._dataBuffer = this._dataBuffer.substr(0, this._dataBuffer.length - 1);\n            this.feedSse({\n                data: this._dataBuffer,\n                eventType: this._eventType,\n            });\n            this._dataBuffer = \"\";\n            this._eventType = \"\";\n        }\n        if (line[0] === \":\")\n            return;\n        const colon = line.indexOf(\":\");\n        const field = line.substr(0, colon);\n        let value = colon === -1 ? \"\" : line.substr(colon + 1);\n        if (value.startsWith(\" \"))\n            value = value.substr(1);\n        if (field === \"event\") {\n            this._eventType = value;\n        }\n        else if (field === \"data\") {\n            this._dataBuffer += value;\n            this._dataBuffer += \"\\n\";\n        }\n        else ;\n    }\n    feedSse(sse) {\n        this.assertState(WatchStreamState.NEED_DATA);\n        const firstPercentIndex = sse.data.indexOf(\"%\");\n        if (firstPercentIndex !== -1) {\n            // For some reason, the stich server decided to add percent-encoding for '%', '\\n', and '\\r' to its\n            // event-stream replies. But it isn't real urlencoding, since most characters pass through, so we can't use\n            // uri_percent_decode() here.\n            let buffer = \"\";\n            let start = 0;\n            for (let percentIndex = firstPercentIndex; percentIndex !== -1; percentIndex = sse.data.indexOf(\"%\", start)) {\n                buffer += sse.data.substr(start, percentIndex - start);\n                const encoded = sse.data.substr(percentIndex, 3); // may be smaller than 3 if string ends with %\n                if (encoded === \"%25\") {\n                    buffer += \"%\";\n                }\n                else if (encoded === \"%0A\") {\n                    buffer += \"\\x0A\"; // '\\n'\n                }\n                else if (encoded === \"%0D\") {\n                    buffer += \"\\x0D\"; // '\\r'\n                }\n                else {\n                    buffer += encoded; // propagate as-is\n                }\n                start = percentIndex + encoded.length;\n            }\n            // Advance the buffer with the last part\n            buffer += sse.data.substr(start);\n            sse.data = buffer;\n        }\n        if (!sse.eventType || sse.eventType === \"message\") {\n            try {\n                const parsed = EJSON.parse(sse.data);\n                if (typeof parsed === \"object\") {\n                    // ???\n                    this._nextEvent = parsed;\n                    this._state = WatchStreamState.HAVE_EVENT;\n                    return;\n                }\n            }\n            catch {\n                // fallthrough to same handling as for non-document value.\n            }\n            this._state = WatchStreamState.HAVE_ERROR;\n            this._error = new WatchError({\n                message: \"server returned malformed event: \" + sse.data,\n                code: \"bad bson parse\",\n            });\n        }\n        else if (sse.eventType === \"error\") {\n            this._state = WatchStreamState.HAVE_ERROR;\n            // default error message if we have issues parsing the reply.\n            this._error = new WatchError({\n                message: sse.data,\n                code: \"unknown\",\n            });\n            try {\n                const { error_code: errorCode, error } = EJSON.parse(sse.data);\n                if (typeof errorCode !== \"string\")\n                    return;\n                if (typeof error !== \"string\")\n                    return;\n                // XXX in realm-js, object-store will error if the error_code is not one of the known\n                // error code enum values.\n                this._error = new WatchError({\n                    message: error,\n                    code: errorCode,\n                });\n            }\n            catch {\n                return; // Use the default state.\n            }\n        }\n        else ;\n    }\n    get state() {\n        return this._state;\n    }\n    // Consumes the returned event. If you used feedBuffer(), there may be another event or error after this one,\n    // so you need to call state() again to see what to do next.\n    nextEvent() {\n        this.assertState(WatchStreamState.HAVE_EVENT);\n        // We can use \"as ChangeEvent<T>\" since we just asserted the state.\n        const out = this._nextEvent;\n        this._state = WatchStreamState.NEED_DATA;\n        this.advanceBufferState();\n        return out;\n    }\n    // Once this enters the error state, it stays that way. You should not feed any more data.\n    get error() {\n        return this._error;\n    }\n    ////////////////////////////////////////////\n    advanceBufferState() {\n        this.assertState(WatchStreamState.NEED_DATA);\n        while (this.state === WatchStreamState.NEED_DATA) {\n            if (this._bufferOffset === this._buffer.length) {\n                this._buffer = \"\";\n                this._bufferOffset = 0;\n                return;\n            }\n            // NOTE not supporting CR-only newlines, just LF and CRLF.\n            const nextNewlineIndex = this._buffer.indexOf(\"\\n\", this._bufferOffset);\n            if (nextNewlineIndex === -1) {\n                // We have a partial line.\n                if (this._bufferOffset !== 0) {\n                    // Slide the partial line down to the front of the buffer.\n                    this._buffer = this._buffer.substr(this._bufferOffset, this._buffer.length - this._bufferOffset);\n                    this._bufferOffset = 0;\n                }\n                return;\n            }\n            this.feedLine(this._buffer.substr(this._bufferOffset, nextNewlineIndex - this._bufferOffset));\n            this._bufferOffset = nextNewlineIndex + 1; // Advance past this line, including its newline.\n        }\n    }\n    assertState(state) {\n        if (this._state !== state) {\n            throw Error(`Expected WatchStream to be in state ${state}, but in state ${this._state}`);\n        }\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * A remote collection of documents.\n */\nclass MongoDBCollection {\n    /**\n     * Construct a remote collection of documents.\n     *\n     * @param fetcher The fetcher to use when requesting the service.\n     * @param serviceName The name of the remote service.\n     * @param databaseName The name of the database.\n     * @param collectionName The name of the remote collection.\n     */\n    constructor(fetcher, serviceName, databaseName, collectionName) {\n        this.functions = FunctionsFactory.create(fetcher, {\n            serviceName,\n        });\n        this.databaseName = databaseName;\n        this.collectionName = collectionName;\n        this.serviceName = serviceName;\n        this.fetcher = fetcher;\n    }\n    /** @inheritdoc */\n    find(filter = {}, options = {}) {\n        return this.functions.find({\n            database: this.databaseName,\n            collection: this.collectionName,\n            query: filter,\n            project: options.projection,\n            sort: options.sort,\n            limit: options.limit,\n        });\n    }\n    /** @inheritdoc */\n    findOne(filter = {}, options = {}) {\n        return this.functions.findOne({\n            database: this.databaseName,\n            collection: this.collectionName,\n            query: filter,\n            project: options.projection,\n            sort: options.sort,\n        });\n    }\n    /** @inheritdoc */\n    findOneAndUpdate(filter = {}, update, options = {}) {\n        return this.functions.findOneAndUpdate({\n            database: this.databaseName,\n            collection: this.collectionName,\n            filter,\n            update,\n            sort: options.sort,\n            projection: options.projection,\n            upsert: options.upsert,\n            returnNewDocument: options.returnNewDocument,\n        });\n    }\n    /** @inheritdoc */\n    findOneAndReplace(filter = {}, replacement, options = {}) {\n        return this.functions.findOneAndReplace({\n            database: this.databaseName,\n            collection: this.collectionName,\n            filter: filter,\n            update: replacement,\n            sort: options.sort,\n            projection: options.projection,\n            upsert: options.upsert,\n            returnNewDocument: options.returnNewDocument,\n        });\n    }\n    /** @inheritdoc */\n    findOneAndDelete(filter = {}, options = {}) {\n        return this.functions.findOneAndReplace({\n            database: this.databaseName,\n            collection: this.collectionName,\n            filter,\n            sort: options.sort,\n            projection: options.projection,\n        });\n    }\n    /** @inheritdoc */\n    aggregate(pipeline) {\n        return this.functions.aggregate({\n            database: this.databaseName,\n            collection: this.collectionName,\n            pipeline,\n        });\n    }\n    /** @inheritdoc */\n    count(filter = {}, options = {}) {\n        return this.functions.count({\n            database: this.databaseName,\n            collection: this.collectionName,\n            query: filter,\n            limit: options.limit,\n        });\n    }\n    /** @inheritdoc */\n    insertOne(document) {\n        return this.functions.insertOne({\n            database: this.databaseName,\n            collection: this.collectionName,\n            document,\n        });\n    }\n    /** @inheritdoc */\n    insertMany(documents) {\n        return this.functions.insertMany({\n            database: this.databaseName,\n            collection: this.collectionName,\n            documents,\n        });\n    }\n    /** @inheritdoc */\n    deleteOne(filter = {}) {\n        return this.functions.deleteOne({\n            database: this.databaseName,\n            collection: this.collectionName,\n            query: filter,\n        });\n    }\n    /** @inheritdoc */\n    deleteMany(filter = {}) {\n        return this.functions.deleteMany({\n            database: this.databaseName,\n            collection: this.collectionName,\n            query: filter,\n        });\n    }\n    /** @inheritdoc */\n    updateOne(filter, update, options = {}) {\n        return this.functions.updateOne({\n            database: this.databaseName,\n            collection: this.collectionName,\n            query: filter,\n            update,\n            upsert: options.upsert,\n        });\n    }\n    /** @inheritdoc */\n    updateMany(filter, update, options = {}) {\n        return this.functions.updateMany({\n            database: this.databaseName,\n            collection: this.collectionName,\n            query: filter,\n            update,\n            upsert: options.upsert,\n        });\n    }\n    async *watch({ ids, filter, } = {}) {\n        const iterator = await this.functions.callFunctionStreaming(\"watch\", {\n            database: this.databaseName,\n            collection: this.collectionName,\n            ids,\n            filter,\n        });\n        const watchStream = new WatchStream();\n        for await (const chunk of iterator) {\n            if (!chunk)\n                continue;\n            watchStream.feedBuffer(chunk);\n            while (watchStream.state == WatchStreamState.HAVE_EVENT) {\n                yield watchStream.nextEvent();\n            }\n            if (watchStream.state == WatchStreamState.HAVE_ERROR)\n                // XXX this is just throwing an error like {error_code: \"BadRequest, error: \"message\"},\n                // which matches realm-js, but is different from how errors are handled in realm-web\n                throw watchStream.error;\n        }\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * Creates an Remote MongoDB Collection.\n * Note: This method exists to enable function binding.\n *\n * @param fetcher The underlying fetcher.\n * @param serviceName A service name.\n * @param databaseName A database name.\n * @param collectionName A collection name.\n * @returns The collection.\n */\nfunction createCollection(fetcher, serviceName, databaseName, collectionName) {\n    return new MongoDBCollection(fetcher, serviceName, databaseName, collectionName);\n}\n/**\n * Creates a Remote MongoDB Database.\n * Note: This method exists to enable function binding.\n *\n * @param fetcher The underlying fetcher\n * @param serviceName A service name\n * @param databaseName A database name\n * @returns The database.\n */\nfunction createDatabase(fetcher, serviceName, databaseName) {\n    return {\n        collection: createCollection.bind(null, fetcher, serviceName, databaseName),\n    };\n}\n/**\n * Creates a Remote MongoDB Service.\n * Note: This method exists to enable function binding.\n *\n * @param fetcher The underlying fetcher.\n * @param serviceName An optional service name.\n * @returns The service.\n */\nfunction createService(fetcher, serviceName = \"mongo-db\") {\n    return { db: createDatabase.bind(null, fetcher, serviceName) };\n}\n\n////////////////////////////////////////////////////////////////////////////\nconst DEFAULT_DEVICE_ID = \"000000000000000000000000\";\n/** The state of a user within the app */\nvar UserState;\n(function (UserState) {\n    /** Active, with both access and refresh tokens */\n    UserState[\"Active\"] = \"active\";\n    /** Logged out, but there might still be data persisted about the user, in the browser. */\n    UserState[\"LoggedOut\"] = \"logged-out\";\n    /** Logged out and all data about the user has been removed. */\n    UserState[\"Removed\"] = \"removed\";\n})(UserState || (UserState = {}));\n/** The type of a user. */\nvar UserType$1;\n(function (UserType) {\n    /** Created by the user itself. */\n    UserType[\"Normal\"] = \"normal\";\n    /** Created by an administrator of the app. */\n    UserType[\"Server\"] = \"server\";\n})(UserType$1 || (UserType$1 = {}));\n/**\n * Representation of an authenticated user of an app.\n */\nclass User {\n    /**\n     * @param parameters Parameters of the user.\n     */\n    constructor(parameters) {\n        this.app = parameters.app;\n        this.id = parameters.id;\n        this.storage = new UserStorage(this.app.storage, this.id);\n        if (\"accessToken\" in parameters && \"refreshToken\" in parameters && \"providerType\" in parameters) {\n            this._accessToken = parameters.accessToken;\n            this._refreshToken = parameters.refreshToken;\n            this.providerType = parameters.providerType;\n            // Save the parameters to storage, for future instances to be hydrated from\n            this.storage.accessToken = parameters.accessToken;\n            this.storage.refreshToken = parameters.refreshToken;\n            this.storage.providerType = parameters.providerType;\n        }\n        else {\n            // Hydrate the rest of the parameters from storage\n            this._accessToken = this.storage.accessToken;\n            this._refreshToken = this.storage.refreshToken;\n            const providerType = this.storage.providerType;\n            this._profile = this.storage.profile;\n            if (providerType) {\n                this.providerType = providerType;\n            }\n            else {\n                throw new Error(\"Storage is missing a provider type\");\n            }\n        }\n        this.fetcher = this.app.fetcher.clone({\n            userContext: { currentUser: this },\n        });\n        this.apiKeys = new ApiKeyAuth(this.fetcher);\n        this.functions = FunctionsFactory.create(this.fetcher);\n    }\n    /**\n     * @returns The access token used to authenticate the user towards MongoDB Realm.\n     */\n    get accessToken() {\n        return this._accessToken;\n    }\n    /**\n     * @param token The new access token.\n     */\n    set accessToken(token) {\n        this._accessToken = token;\n        this.storage.accessToken = token;\n    }\n    /**\n     * @returns The refresh token used to issue new access tokens.\n     */\n    get refreshToken() {\n        return this._refreshToken;\n    }\n    /**\n     * @param token The new refresh token.\n     */\n    set refreshToken(token) {\n        this._refreshToken = token;\n        this.storage.refreshToken = token;\n    }\n    /**\n     * @returns The current state of the user.\n     */\n    get state() {\n        if (this.id in this.app.allUsers) {\n            return this.refreshToken === null ? UserState.LoggedOut : UserState.Active;\n        }\n        else {\n            return UserState.Removed;\n        }\n    }\n    /**\n     * @returns The logged in state of the user.\n     */\n    get isLoggedIn() {\n        return this.state === UserState.Active;\n    }\n    get customData() {\n        if (this.accessToken) {\n            const decodedToken = this.decodeAccessToken();\n            return decodedToken.userData;\n        }\n        else {\n            throw new Error(\"Cannot read custom data without an access token\");\n        }\n    }\n    /**\n     * @returns Profile containing detailed information about the user.\n     */\n    get profile() {\n        if (this._profile) {\n            return this._profile.data;\n        }\n        else {\n            throw new Error(\"A profile was never fetched for this user\");\n        }\n    }\n    get identities() {\n        if (this._profile) {\n            return this._profile.identities;\n        }\n        else {\n            throw new Error(\"A profile was never fetched for this user\");\n        }\n    }\n    get deviceId() {\n        if (this.accessToken) {\n            const payload = this.accessToken.split(\".\")[1];\n            if (payload) {\n                const parsedPayload = JSON.parse(gBase64.decode(payload));\n                const deviceId = parsedPayload[\"baas_device_id\"];\n                if (typeof deviceId === \"string\" && deviceId !== DEFAULT_DEVICE_ID) {\n                    return deviceId;\n                }\n            }\n        }\n        return null;\n    }\n    /**\n     * Refresh the users profile data.\n     */\n    async refreshProfile() {\n        // Fetch the latest profile\n        const response = await this.fetcher.fetchJSON({\n            method: \"GET\",\n            path: routes.api().auth().profile().path,\n        });\n        // Create a profile instance\n        this._profile = new UserProfile(response);\n        // Store this for later hydration\n        this.storage.profile = this._profile;\n    }\n    /**\n     * Log out the user, invalidating the session (and its refresh token).\n     */\n    async logOut() {\n        // Invalidate the refresh token\n        try {\n            if (this._refreshToken !== null) {\n                await this.fetcher.fetchJSON({\n                    method: \"DELETE\",\n                    path: routes.api().auth().session().path,\n                    tokenType: \"refresh\",\n                });\n            }\n        }\n        finally {\n            // Forget the access and refresh token\n            this.accessToken = null;\n            this.refreshToken = null;\n        }\n    }\n    /** @inheritdoc */\n    async linkCredentials(credentials) {\n        const response = await this.app.authenticator.authenticate(credentials, this);\n        // Sanity check the response\n        if (this.id !== response.userId) {\n            const details = `got user id ${response.userId} expected ${this.id}`;\n            throw new Error(`Link response ment for another user (${details})`);\n        }\n        // Update the access token\n        this.accessToken = response.accessToken;\n        // Refresh the profile to include the new identity\n        await this.refreshProfile();\n    }\n    /**\n     * Request a new access token, using the refresh token.\n     */\n    async refreshAccessToken() {\n        const response = await this.fetcher.fetchJSON({\n            method: \"POST\",\n            path: routes.api().auth().session().path,\n            tokenType: \"refresh\",\n        });\n        const { access_token: accessToken } = response;\n        if (typeof accessToken === \"string\") {\n            this.accessToken = accessToken;\n        }\n        else {\n            throw new Error(\"Expected an 'access_token' in the response\");\n        }\n    }\n    /** @inheritdoc */\n    async refreshCustomData() {\n        await this.refreshAccessToken();\n        return this.customData;\n    }\n    /** @inheritdoc */\n    callFunction(name, ...args) {\n        return this.functions.callFunction(name, ...args);\n    }\n    /**\n     * @returns A plain ol' JavaScript object representation of the user.\n     */\n    toJSON() {\n        return {\n            id: this.id,\n            accessToken: this.accessToken,\n            refreshToken: this.refreshToken,\n            profile: this._profile,\n            state: this.state,\n            customData: this.customData,\n        };\n    }\n    /** @inheritdoc */\n    push() {\n        throw new Error(\"Not yet implemented\");\n    }\n    /** @inheritdoc */\n    mongoClient(serviceName) {\n        return createService(this.fetcher, serviceName);\n    }\n    decodeAccessToken() {\n        if (this.accessToken) {\n            // Decode and spread the token\n            const parts = this.accessToken.split(\".\");\n            if (parts.length !== 3) {\n                throw new Error(\"Expected an access token with three parts\");\n            }\n            // Decode the payload\n            const encodedPayload = parts[1];\n            const decodedPayload = gBase64.decode(encodedPayload);\n            const parsedPayload = JSON.parse(decodedPayload);\n            const { exp: expires, iat: issuedAt, sub: subject, user_data: userData = {} } = parsedPayload;\n            // Validate the types\n            if (typeof expires !== \"number\") {\n                throw new Error(\"Failed to decode access token 'exp'\");\n            }\n            else if (typeof issuedAt !== \"number\") {\n                throw new Error(\"Failed to decode access token 'iat'\");\n            }\n            return { expires, issuedAt, subject, userData };\n        }\n        else {\n            throw new Error(\"Missing an access token\");\n        }\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\n// TODO: Ensure the static interface of the Credentials class implements the static interface of Realm.Credentials\n// See https://stackoverflow.com/a/43484801\n/**\n * Instances of this class can be passed to the `app.logIn` method to authenticate an end-user.\n */\nclass Credentials {\n    /**\n     * Constructs an instance of credentials.\n     *\n     * @param providerName The name of the authentication provider used when authenticating.\n     * @param providerType The type of the authentication provider used when authenticating.\n     * @param payload The data being sent to the service when authenticating.\n     */\n    constructor(providerName, providerType, payload) {\n        this.providerName = providerName;\n        this.providerType = providerType;\n        this.payload = payload;\n    }\n    /**\n     * Creates credentials that logs in using the [Anonymous Provider](https://docs.mongodb.com/realm/authentication/anonymous/).\n     *\n     * @returns The credentials instance, which can be passed to `app.logIn`.\n     */\n    static anonymous() {\n        return new Credentials(\"anon-user\", \"anon-user\", {});\n    }\n    /**\n     * Creates credentials that logs in using the [API Key Provider](https://docs.mongodb.com/realm/authentication/api-key/).\n     *\n     * @deprecated Use `Credentials.apiKey`.\n     * @param key The secret content of the API key.\n     * @returns The credentials instance, which can be passed to `app.logIn`.\n     */\n    static userApiKey(key) {\n        return new Credentials(\"api-key\", \"api-key\", { key });\n    }\n    /**\n     * Creates credentials that logs in using the [API Key Provider](https://docs.mongodb.com/realm/authentication/api-key/).\n     *\n     * @deprecated Use `Credentials.apiKey`.\n     * @param key The secret content of the API key.\n     * @returns The credentials instance, which can be passed to `app.logIn`.\n     */\n    static serverApiKey(key) {\n        return new Credentials(\"api-key\", \"api-key\", { key });\n    }\n    /**\n     * Creates credentials that logs in using the [API Key Provider](https://docs.mongodb.com/realm/authentication/api-key/).\n     *\n     * @param key The secret content of the API key.\n     * @returns The credentials instance, which can be passed to `app.logIn`.\n     */\n    static apiKey(key) {\n        return new Credentials(\"api-key\", \"api-key\", { key });\n    }\n    /**\n     * Creates credentials that logs in using the [Email/Password Provider](https://docs.mongodb.com/realm/authentication/email-password/).\n     * Note: This was formerly known as the \"Username/Password\" provider.\n     *\n     * @param email The end-users email address.\n     * @param password The end-users password.\n     * @returns The credentials instance, which can be passed to `app.logIn`.\n     */\n    static emailPassword(email, password) {\n        return new Credentials(\"local-userpass\", \"local-userpass\", {\n            username: email,\n            password,\n        });\n    }\n    /**\n     * Creates credentials that logs in using the [Custom Function Provider](https://docs.mongodb.com/realm/authentication/custom-function/).\n     *\n     * @param payload The custom payload as expected by the server.\n     * @returns The credentials instance, which can be passed to `app.logIn`.\n     */\n    static function(payload) {\n        return new Credentials(\"custom-function\", \"custom-function\", payload);\n    }\n    /**\n     * Creates credentials that logs in using the [Custom JWT Provider](https://docs.mongodb.com/realm/authentication/custom-jwt/).\n     *\n     * @param token The JSON Web Token (JWT).\n     * @returns The credentials instance, which can be passed to `app.logIn`.\n     */\n    static jwt(token) {\n        return new Credentials(\"custom-token\", \"custom-token\", {\n            token,\n        });\n    }\n    /**\n     * Creates credentials that logs in using the [Google Provider](https://docs.mongodb.com/realm/authentication/google/).\n     *\n     * @param payload The URL that users should be redirected to, the auth code or id token from Google.\n     * @returns The credentials instance, which can be passed to `app.logIn`.\n     */\n    static google(payload) {\n        return new Credentials(\"oauth2-google\", \"oauth2-google\", Credentials.derivePayload(payload));\n    }\n    /**\n     * @param payload The payload string.\n     * @returns A payload object based on the string.\n     */\n    static derivePayload(payload) {\n        if (typeof payload === \"string\") {\n            if (payload.includes(\"://\")) {\n                return this.derivePayload({ redirectUrl: payload });\n            }\n            else if (payload.startsWith(\"4/\")) {\n                return this.derivePayload({ authCode: payload });\n            }\n            else if (payload.startsWith(\"ey\")) {\n                return this.derivePayload({ idToken: payload });\n            }\n            else {\n                throw new Error(`Unexpected payload: ${payload}`);\n            }\n        }\n        else if (Object.keys(payload).length === 1) {\n            if (\"authCode\" in payload || \"redirectUrl\" in payload) {\n                return payload;\n            }\n            else if (\"idToken\" in payload) {\n                return { id_token: payload.idToken };\n            }\n            else {\n                throw new Error(\"Unexpected payload: \" + JSON.stringify(payload));\n            }\n        }\n        else {\n            throw new Error(\"Expected only one property in payload, got \" + JSON.stringify(payload));\n        }\n    }\n    /**\n     * Creates credentials that logs in using the [Facebook Provider](https://docs.mongodb.com/realm/authentication/facebook/).\n     *\n     * @param redirectUrlOrAccessToken The URL that users should be redirected to or the auth code returned from Facebook.\n     * @returns The credentials instance, which can be passed to `app.logIn`.\n     */\n    static facebook(redirectUrlOrAccessToken) {\n        return new Credentials(\"oauth2-facebook\", \"oauth2-facebook\", redirectUrlOrAccessToken.includes(\"://\")\n            ? { redirectUrl: redirectUrlOrAccessToken }\n            : { accessToken: redirectUrlOrAccessToken });\n    }\n    /**\n     * Creates credentials that logs in using the [Apple ID Provider](https://docs.mongodb.com/realm/authentication/apple/).\n     *\n     * @param redirectUrlOrIdToken The URL that users should be redirected to or the id_token returned from Apple.\n     * @returns The credentials instance, which can be passed to `app.logIn`.\n     */\n    static apple(redirectUrlOrIdToken) {\n        return new Credentials(\"oauth2-apple\", \"oauth2-apple\", redirectUrlOrIdToken.includes(\"://\") ? { redirectUrl: redirectUrlOrIdToken } : { id_token: redirectUrlOrIdToken });\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\nconst USER_IDS_STORAGE_KEY = \"userIds\";\nconst DEVICE_ID_STORAGE_KEY = \"deviceId\";\n/**\n * Storage specific to the app.\n */\nclass AppStorage extends PrefixedStorage {\n    /**\n     * @param storage The underlying storage to wrap.\n     * @param appId The id of the app.\n     */\n    constructor(storage, appId) {\n        super(storage, `app(${appId})`);\n    }\n    /**\n     * Reads out the list of user ids from storage.\n     *\n     * @returns A list of user ids.\n     */\n    getUserIds() {\n        const userIdsString = this.get(USER_IDS_STORAGE_KEY);\n        const userIds = userIdsString ? JSON.parse(userIdsString) : [];\n        if (Array.isArray(userIds)) {\n            // Remove any duplicates that might have been added\n            // The Set preserves insertion order\n            return [...new Set(userIds)];\n        }\n        else {\n            throw new Error(\"Expected the user ids to be an array\");\n        }\n    }\n    /**\n     * Sets the list of ids in storage.\n     * Optionally merging with existing ids stored in the storage, by prepending these while voiding duplicates.\n     *\n     * @param userIds The list of ids to store.\n     * @param mergeWithExisting Prepend existing ids to avoid data-races with other apps using this storage.\n     */\n    setUserIds(userIds, mergeWithExisting) {\n        if (mergeWithExisting) {\n            // Add any existing user id to the end of this list, avoiding duplicates\n            const existingIds = this.getUserIds();\n            for (const id of existingIds) {\n                if (userIds.indexOf(id) === -1) {\n                    userIds.push(id);\n                }\n            }\n        }\n        // Store the list of ids\n        this.set(USER_IDS_STORAGE_KEY, JSON.stringify(userIds));\n    }\n    /**\n     * Remove an id from the list of ids.\n     *\n     * @param userId The id of a User to be removed.\n     */\n    removeUserId(userId) {\n        const existingIds = this.getUserIds();\n        const userIds = existingIds.filter((id) => id !== userId);\n        // Store the list of ids\n        this.setUserIds(userIds, false);\n    }\n    /**\n     * @returns id of this device (if any exists)\n     */\n    getDeviceId() {\n        return this.get(DEVICE_ID_STORAGE_KEY);\n    }\n    /**\n     * @param deviceId The id of this device, to send on subsequent authentication requests.\n     */\n    setDeviceId(deviceId) {\n        this.set(DEVICE_ID_STORAGE_KEY, deviceId);\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\nconst LOWERCASE_LETTERS = \"abcdefghijklmnopqrstuvwxyz\";\nconst CLOSE_CHECK_INTERVAL = 100; // 10 times per second\nconst REDIRECT_HASH_TO_RESULT = {\n    _stitch_client_app_id: \"appId\",\n    _baas_client_app_id: \"appId\",\n    _stitch_ua: \"userAuth\",\n    _baas_ua: \"userAuth\",\n    _stitch_link: \"link\",\n    _baas_link: \"link\",\n    _stitch_error: \"error\",\n    _baas_error: \"error\",\n    _stitch_state: \"state\",\n    _baas_state: \"state\",\n};\n/**\n * A collection of methods helping implement the OAuth2 flow.\n */\nclass OAuth2Helper {\n    /**\n     * @param storage The underlying storage to use when storing and retriving secrets.\n     * @param openWindow An optional function called when a browser window needs to open.\n     */\n    constructor(storage, openWindow = getEnvironment().openWindow) {\n        this.storage = storage.prefix(\"oauth2\");\n        this.openWindow = openWindow;\n    }\n    /**\n     * Parses the query string from the final step of the OAuth flow.\n     *\n     * @param queryString The query string passed through in location.hash.\n     * @returns The result of the OAuth flow.\n     */\n    static parseRedirectLocation(queryString) {\n        const params = decodeQueryString(queryString);\n        const result = {};\n        for (const [p, r] of Object.entries(REDIRECT_HASH_TO_RESULT)) {\n            const value = params[p];\n            if (value) {\n                result[r] = value;\n            }\n        }\n        return result;\n    }\n    /**\n     * Handle the redirect querystring by parsing it and storing it for others to consume.\n     *\n     * @param queryString The query string containing the encoded result from the OAuth provider.\n     * @param storage The underlying storage used to persist the result.\n     */\n    static handleRedirect(queryString, storage = getEnvironment().defaultStorage) {\n        const result = OAuth2Helper.parseRedirectLocation(queryString);\n        const { state, error } = result;\n        if (typeof state === \"string\") {\n            const oauth2Storage = storage.prefix(\"oauth2\");\n            const stateStorage = OAuth2Helper.getStateStorage(oauth2Storage, state);\n            stateStorage.set(\"result\", JSON.stringify(result));\n        }\n        else if (error) {\n            throw new Error(`Failed to handle OAuth 2.0 redirect: ${error}`);\n        }\n        else {\n            throw new Error(\"Failed to handle OAuth 2.0 redirect.\");\n        }\n    }\n    /**\n     * Decodes the authInfo string into its seperate parts.\n     *\n     * @param authInfo An authInfo string returned from the server.\n     * @returns An object containing the separate parts of the authInfo string.\n     */\n    static decodeAuthInfo(authInfo) {\n        const parts = (authInfo || \"\").split(\"$\");\n        if (parts.length === 4) {\n            const [accessToken, refreshToken, userId, deviceId] = parts;\n            return { accessToken, refreshToken, userId, deviceId };\n        }\n        else {\n            throw new Error(\"Failed to decode 'authInfo' into ids and tokens\");\n        }\n    }\n    /**\n     * Get the storage key associated of an secret associated with a state.\n     *\n     * @param storage The root storage used to derive a \"state namespaced\" storage.\n     * @param state The random state.\n     * @returns The storage associated with a particular state.\n     */\n    static getStateStorage(storage, state) {\n        return storage.prefix(`state(${state})`);\n    }\n    /**\n     * Open a window and wait for the redirect to be handled.\n     *\n     * @param url The URL to open.\n     * @param state The state which will be used to listen for storage updates.\n     * @returns The result passed through the redirect.\n     */\n    openWindowAndWaitForRedirect(url, state) {\n        const stateStorage = OAuth2Helper.getStateStorage(this.storage, state);\n        // Return a promise that resolves when the  gets known\n        return new Promise((resolve, reject) => {\n            let redirectWindow = null;\n            // We're declaring the interval now to enable referencing before its initialized\n            let windowClosedInterval; // eslint-disable-line prefer-const\n            const handleStorageUpdate = () => {\n                // Trying to get the secret from storage\n                const result = stateStorage.get(\"result\");\n                if (result) {\n                    const parsedResult = JSON.parse(result);\n                    // The secret got updated!\n                    stateStorage.removeListener(handleStorageUpdate);\n                    // Clear the storage to prevent others from reading this\n                    stateStorage.clear();\n                    // Try closing the newly created window\n                    try {\n                        if (redirectWindow) {\n                            // Stop checking if the window closed\n                            clearInterval(windowClosedInterval);\n                            redirectWindow.close();\n                        }\n                    }\n                    catch (err) {\n                        console.warn(`Failed closing redirect window: ${err}`);\n                    }\n                    finally {\n                        resolve(parsedResult);\n                    }\n                }\n            };\n            // Add a listener to the state storage, awaiting an update to the secret\n            stateStorage.addListener(handleStorageUpdate);\n            // Open up a window\n            redirectWindow = this.openWindow(url);\n            // Not using a const, because we need the two listeners to reference each other when removing the other.\n            windowClosedInterval = setInterval(() => {\n                // Polling \"closed\" because registering listeners on the window violates cross-origin policies\n                if (!redirectWindow) {\n                    // No need to keep polling for a window that we can't check\n                    clearInterval(windowClosedInterval);\n                }\n                else if (redirectWindow.closed) {\n                    // Stop polling the window state\n                    clearInterval(windowClosedInterval);\n                    // Stop listening for changes to the storage\n                    stateStorage.removeListener(handleStorageUpdate);\n                    // Reject the promise\n                    const err = new Error(\"Window closed\");\n                    reject(err);\n                }\n            }, CLOSE_CHECK_INTERVAL);\n        });\n    }\n    /**\n     * Generate a random state string.\n     *\n     * @returns The random state string.\n     */\n    generateState() {\n        return generateRandomString(12, LOWERCASE_LETTERS);\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\nconst REDIRECT_LOCATION_HEADER = \"x-baas-location\";\n/**\n * Handles authentication and linking of users.\n */\nclass Authenticator {\n    /**\n     * @param fetcher The fetcher used to fetch responses from the server.\n     * @param storage The storage used when completing OAuth 2.0 flows (should not be scoped to a specific app).\n     * @param getDeviceInformation Called to get device information to be sent to the server.\n     */\n    constructor(fetcher, storage, getDeviceInformation) {\n        this.fetcher = fetcher;\n        this.oauth2 = new OAuth2Helper(storage);\n        this.getDeviceInformation = getDeviceInformation;\n    }\n    /**\n     * @param credentials Credentials to use when logging in.\n     * @param linkingUser A user requesting to link.\n     * @returns A promise resolving to the response from the server.\n     */\n    async authenticate(credentials, linkingUser) {\n        const deviceInformation = this.getDeviceInformation();\n        const isLinking = typeof linkingUser === \"object\";\n        if (credentials.providerType.startsWith(\"oauth2\") && typeof credentials.payload.redirectUrl === \"string\") {\n            // Initiate the OAuth2 flow by generating a state and fetch a redirect URL\n            const state = this.oauth2.generateState();\n            const url = await this.getLogInUrl(credentials, isLinking, {\n                state,\n                redirect: credentials.payload.redirectUrl,\n                // Ensure redirects are communicated in a header different from \"Location\" and status remains 200 OK\n                providerRedirectHeader: isLinking ? true : undefined,\n                // Add the device information, only if we're not linking - since that request won't have a body of its own.\n                device: !isLinking ? deviceInformation.encode() : undefined,\n            });\n            // If we're linking, we need to send the users access token in the request\n            if (isLinking) {\n                const response = await this.fetcher.fetch({\n                    method: \"GET\",\n                    url,\n                    tokenType: isLinking ? \"access\" : \"none\",\n                    user: linkingUser,\n                    // The response will set a cookie that we need to tell the browser to store\n                    mode: \"cors\",\n                    credentials: \"include\",\n                });\n                // If a response header contains a redirect URL: Open a window and wait for the redirect to be handled\n                const redirectUrl = response.headers.get(REDIRECT_LOCATION_HEADER);\n                if (redirectUrl) {\n                    return this.openWindowAndWaitForAuthResponse(redirectUrl, state);\n                }\n                else {\n                    throw new Error(`Missing ${REDIRECT_LOCATION_HEADER} header`);\n                }\n            }\n            else {\n                // Otherwise we can open a window and let the server redirect the user right away\n                // This gives lower latency (as we don't need the client to receive and execute the redirect in code)\n                // This also has less dependency on cookies and doesn't sent any tokens.\n                return this.openWindowAndWaitForAuthResponse(url, state);\n            }\n        }\n        else {\n            const logInUrl = await this.getLogInUrl(credentials, isLinking);\n            const response = await this.fetcher.fetchJSON({\n                method: \"POST\",\n                url: logInUrl,\n                body: {\n                    ...credentials.payload,\n                    options: {\n                        device: deviceInformation.toJSON(),\n                    },\n                },\n                tokenType: isLinking ? \"access\" : \"none\",\n                user: linkingUser,\n            });\n            // Spread out values from the response and ensure they're valid\n            const { user_id: userId, access_token: accessToken, refresh_token: refreshToken = null, device_id: deviceId, } = response;\n            if (typeof userId !== \"string\") {\n                throw new Error(\"Expected a user id in the response\");\n            }\n            if (typeof accessToken !== \"string\") {\n                throw new Error(\"Expected an access token in the response\");\n            }\n            if (typeof refreshToken !== \"string\" && refreshToken !== null) {\n                throw new Error(\"Expected refresh token to be a string or null\");\n            }\n            if (typeof deviceId !== \"string\") {\n                throw new Error(\"Expected device id to be a string\");\n            }\n            return { userId, accessToken, refreshToken, deviceId };\n        }\n    }\n    /**\n     * @param credentials Credentials to use when logging in.\n     * @param link Should the request link with the current user?\n     * @param extraQueryParams Any extra parameters to include in the query string\n     * @returns A promise resolving to the url to be used when logging in.\n     */\n    async getLogInUrl(credentials, link = false, extraQueryParams = {}) {\n        // See https://github.com/mongodb/stitch-js-sdk/blob/310f0bd5af80f818cdfbc3caf1ae29ffa8e9c7cf/packages/core/sdk/src/auth/internal/CoreStitchAuth.ts#L746-L780\n        const appRoute = this.fetcher.appRoute;\n        const loginRoute = appRoute.authProvider(credentials.providerName).login();\n        const qs = encodeQueryString({\n            link: link ? \"true\" : undefined,\n            ...extraQueryParams,\n        });\n        const locationUrl = await this.fetcher.locationUrl;\n        return locationUrl + loginRoute.path + qs;\n    }\n    async openWindowAndWaitForAuthResponse(redirectUrl, state) {\n        const redirectResult = await this.oauth2.openWindowAndWaitForRedirect(redirectUrl, state);\n        // Decode the auth info (id, tokens, etc.) from the result of the redirect\n        return OAuth2Helper.decodeAuthInfo(redirectResult.userAuth);\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\n// TODO: Determine if the shape of an error response is specific to each service or widely used.\n/**\n * An error produced while communicating with the MongoDB Realm server.\n */\nclass MongoDBRealmError extends Error {\n    constructor(method, url, statusCode, statusText, error, errorCode, link) {\n        const summary = statusText ? `status ${statusCode} ${statusText}` : `status ${statusCode}`;\n        if (typeof error === \"string\") {\n            super(`Request failed (${method} ${url}): ${error} (${summary})`);\n        }\n        else {\n            super(`Request failed (${method} ${url}): (${summary})`);\n        }\n        this.method = method;\n        this.url = url;\n        this.statusText = statusText;\n        this.statusCode = statusCode;\n        this.error = error;\n        this.errorCode = errorCode;\n        this.link = link;\n    }\n    /**\n     * Constructs and returns an error from a request and a response.\n     * Note: The caller must throw this error themselves.\n     *\n     * @param request The request sent to the server.\n     * @param response A raw response, as returned from the server.\n     * @returns An error from a request and a response.\n     */\n    static async fromRequestAndResponse(request, response) {\n        var _a;\n        const { url, method } = request;\n        const { status, statusText } = response;\n        if ((_a = response.headers.get(\"content-type\")) === null || _a === void 0 ? void 0 : _a.startsWith(\"application/json\")) {\n            const body = await response.json();\n            if (typeof body === \"object\" && body) {\n                const { error, error_code: errorCode, link } = body;\n                return new MongoDBRealmError(method, url, status, statusText, typeof error === \"string\" ? error : undefined, typeof errorCode === \"string\" ? errorCode : undefined, typeof link === \"string\" ? link : undefined);\n            }\n        }\n        return new MongoDBRealmError(method, url, status, statusText);\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * @param body A possible resonse body.\n * @returns An async iterator.\n */\nfunction asyncIteratorFromResponseBody(body) {\n    if (typeof body !== \"object\" || body === null) {\n        throw new Error(\"Expected a non-null object\");\n    }\n    else if (Symbol.asyncIterator in body) {\n        return body;\n    }\n    else if (\"getReader\" in body) {\n        const stream = body;\n        return {\n            [Symbol.asyncIterator]() {\n                const reader = stream.getReader();\n                return {\n                    next() {\n                        return reader.read();\n                    },\n                    async return() {\n                        await reader.cancel();\n                        return { done: true, value: null };\n                    },\n                };\n            },\n        };\n    }\n    else {\n        throw new Error(\"Expected an AsyncIterable or a ReadableStream\");\n    }\n}\n/**\n * Wraps a NetworkTransport from the \"realm-network-transport\" package.\n * Extracts error messages and throws `MongoDBRealmError` objects upon failures.\n * Injects access or refresh tokens for a current or specific user.\n * Refreshes access tokens if requests fails due to a 401 error.\n * Optionally parses response as JSON before returning it.\n * Fetches and exposes an app's location url.\n */\nclass Fetcher {\n    /**\n     * @param config A configuration of the fetcher.\n     * @param config.appId The application id.\n     * @param config.transport The transport used when fetching.\n     * @param config.userContext An object used to determine the requesting user.\n     * @param config.locationUrlContext An object used to determine the location / base URL.\n     */\n    constructor({ appId, transport, userContext, locationUrlContext }) {\n        this.appId = appId;\n        this.transport = transport;\n        this.userContext = userContext;\n        this.locationUrlContext = locationUrlContext;\n    }\n    /**\n     * @param user An optional user to generate the header for.\n     * @param tokenType The type of token (access or refresh).\n     * @returns An object containing the user's token as \"Authorization\" header or undefined if no user is given.\n     */\n    static buildAuthorizationHeader(user, tokenType) {\n        if (!user || tokenType === \"none\") {\n            return {};\n        }\n        else if (tokenType === \"access\") {\n            return { Authorization: `Bearer ${user.accessToken}` };\n        }\n        else if (tokenType === \"refresh\") {\n            return { Authorization: `Bearer ${user.refreshToken}` };\n        }\n        else {\n            throw new Error(`Unexpected token type (${tokenType})`);\n        }\n    }\n    /**\n     * @param body The body string or object passed from a request.\n     * @returns An object optionally specifying the \"Content-Type\" header.\n     */\n    static buildBody(body) {\n        if (!body) {\n            return;\n        }\n        else if (typeof body === \"object\" && body !== null) {\n            return JSON.stringify(serialize(body));\n        }\n        else if (typeof body === \"string\") {\n            return body;\n        }\n        else {\n            console.log(\"body is\", body);\n            throw new Error(\"Unexpected type of body\");\n        }\n    }\n    /**\n     * @param body The body string or object passed from a request.\n     * @returns An object optionally specifying the \"Content-Type\" header.\n     */\n    static buildJsonHeader(body) {\n        if (body && body.length > 0) {\n            return { \"Content-Type\": \"application/json\" };\n        }\n        else {\n            return {};\n        }\n    }\n    clone(config) {\n        return new Fetcher({\n            appId: this.appId,\n            transport: this.transport,\n            userContext: this.userContext,\n            locationUrlContext: this.locationUrlContext,\n            ...config,\n        });\n    }\n    /**\n     * Fetch a network resource as an authenticated user.\n     *\n     * @param request The request which should be sent to the server.\n     * @returns The response from the server.\n     */\n    async fetch(request) {\n        const { path, url, tokenType = \"access\", user = this.userContext.currentUser, ...restOfRequest } = request;\n        if (typeof path === \"string\" && typeof url === \"string\") {\n            throw new Error(\"Use of 'url' and 'path' mutually exclusive\");\n        }\n        else if (typeof path === \"string\") {\n            // Derive the URL\n            const url = (await this.locationUrlContext.locationUrl) + path;\n            return this.fetch({ ...request, path: undefined, url });\n        }\n        else if (typeof url === \"string\") {\n            const response = await this.transport.fetch({\n                ...restOfRequest,\n                url,\n                headers: {\n                    ...Fetcher.buildAuthorizationHeader(user, tokenType),\n                    ...request.headers,\n                },\n            });\n            if (response.ok) {\n                return response;\n            }\n            else if (user && response.status === 401 && tokenType === \"access\") {\n                // If the access token has expired, it would help refreshing it\n                await user.refreshAccessToken();\n                // Retry with the specific user, since the currentUser might have changed.\n                return this.fetch({ ...request, user });\n            }\n            else {\n                if (user && response.status === 401 && tokenType === \"refresh\") {\n                    // A 401 error while using the refresh token indicates the token has an issue.\n                    // Reset the tokens to prevent a lock.\n                    user.accessToken = null;\n                    user.refreshToken = null;\n                }\n                // Throw an error with a message extracted from the body\n                throw await MongoDBRealmError.fromRequestAndResponse(request, response);\n            }\n        }\n        else {\n            throw new Error(\"Expected either 'url' or 'path'\");\n        }\n    }\n    /**\n     * Fetch a network resource as an authenticated user and parse the result as extended JSON.\n     *\n     * @param request The request which should be sent to the server.\n     * @returns The response from the server, parsed as extended JSON.\n     */\n    async fetchJSON(request) {\n        const { body } = request;\n        const serializedBody = Fetcher.buildBody(body);\n        const contentTypeHeaders = Fetcher.buildJsonHeader(serializedBody);\n        const response = await this.fetch({\n            ...request,\n            body: serializedBody,\n            headers: {\n                Accept: \"application/json\",\n                ...contentTypeHeaders,\n                ...request.headers,\n            },\n        });\n        const contentType = response.headers.get(\"content-type\");\n        if (contentType === null || contentType === void 0 ? void 0 : contentType.startsWith(\"application/json\")) {\n            const responseBody = await response.json();\n            return deserialize(responseBody);\n        }\n        else if (contentType === null) {\n            return null;\n        }\n        else {\n            throw new Error(`Expected JSON response, got \"${contentType}\"`);\n        }\n    }\n    /**\n     * Fetch an \"event-stream\" resource as an authenticated user.\n     *\n     * @param request The request which should be sent to the server.\n     * @returns An async iterator over the response body.\n     */\n    async fetchStream(request) {\n        const { body } = await this.fetch({\n            ...request,\n            headers: {\n                Accept: \"text/event-stream\",\n                ...request.headers,\n            },\n        });\n        return asyncIteratorFromResponseBody(body);\n    }\n    /**\n     * @returns The path of the app route.\n     */\n    get appRoute() {\n        return routes.api().app(this.appId);\n    }\n    /**\n     * @returns A promise of the location URL of the app.\n     */\n    get locationUrl() {\n        return this.locationUrlContext.locationUrl;\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * The key in a storage on which the device id is stored.\n */\nconst DEVICE_ID_STORAGE_KEY$1 = \"deviceId\";\nvar DeviceFields;\n(function (DeviceFields) {\n    DeviceFields[\"DEVICE_ID\"] = \"deviceId\";\n    DeviceFields[\"APP_ID\"] = \"appId\";\n    DeviceFields[\"APP_VERSION\"] = \"appVersion\";\n    DeviceFields[\"PLATFORM\"] = \"platform\";\n    DeviceFields[\"PLATFORM_VERSION\"] = \"platformVersion\";\n    DeviceFields[\"SDK_VERSION\"] = \"sdkVersion\";\n})(DeviceFields || (DeviceFields = {}));\n/**\n * Information describing the device, app and SDK.\n */\nclass DeviceInformation {\n    /**\n     * @param params Construct the device information from these parameters.\n     * @param params.appId A user-defined application id.\n     * @param params.appVersion A user-defined application version.\n     * @param params.deviceId An unique id for the end-users device.\n     */\n    constructor({ appId, appVersion, deviceId }) {\n        /**\n         * The version of the Realm Web SDK (constant provided by Rollup).\n         */\n        this.sdkVersion = \"1.5.1\";\n        const environment = getEnvironment();\n        this.platform = environment.platform;\n        this.platformVersion = environment.platformVersion;\n        this.appId = appId;\n        this.appVersion = appVersion;\n        this.deviceId = deviceId;\n    }\n    /**\n     * @returns An base64 URI encoded representation of the device information.\n     */\n    encode() {\n        const obj = removeKeysWithUndefinedValues(this);\n        return gBase64.encode(JSON.stringify(obj));\n    }\n    /**\n     * @returns The defaults\n     */\n    toJSON() {\n        return removeKeysWithUndefinedValues(this);\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * Default base url to prefix all requests if no baseUrl is specified in the configuration.\n */\nconst DEFAULT_BASE_URL = \"https://stitch.mongodb.com\";\n/**\n * MongoDB Realm App\n */\nclass App {\n    /**\n     * Construct a Realm App, either from the Realm App id visible from the MongoDB Realm UI or a configuration.\n     *\n     * @param idOrConfiguration The Realm App id or a configuration to use for this app.\n     */\n    constructor(idOrConfiguration) {\n        /**\n         * An array of active and logged-out users.\n         * Elements in the beginning of the array is considered more recent than the later elements.\n         */\n        this.users = [];\n        /**\n         * A promise resolving to the App's location url.\n         */\n        this._locationUrl = null;\n        // If the argument is a string, convert it to a simple configuration object.\n        const configuration = typeof idOrConfiguration === \"string\" ? { id: idOrConfiguration } : idOrConfiguration;\n        // Initialize properties from the configuration\n        if (typeof configuration === \"object\" && typeof configuration.id === \"string\") {\n            this.id = configuration.id;\n        }\n        else {\n            throw new Error(\"Missing a MongoDB Realm app-id\");\n        }\n        this.baseUrl = configuration.baseUrl || DEFAULT_BASE_URL;\n        if (configuration.skipLocationRequest) {\n            // Use the base url directly, instead of requesting a location URL from the server\n            this._locationUrl = Promise.resolve(this.baseUrl);\n        }\n        this.localApp = configuration.app;\n        const { storage, transport = new DefaultNetworkTransport() } = configuration;\n        // Construct a fetcher wrapping the network transport\n        this.fetcher = new Fetcher({\n            appId: this.id,\n            userContext: this,\n            locationUrlContext: this,\n            transport,\n        });\n        // Construct the auth providers\n        this.emailPasswordAuth = new EmailPasswordAuth(this.fetcher);\n        // Construct the storage\n        const baseStorage = storage || getEnvironment().defaultStorage;\n        this.storage = new AppStorage(baseStorage, this.id);\n        this.authenticator = new Authenticator(this.fetcher, baseStorage, () => this.deviceInformation);\n        // Hydrate the app state from storage\n        try {\n            this.hydrate();\n        }\n        catch (err) {\n            // The storage was corrupted\n            this.storage.clear();\n            // A failed hydration shouldn't throw and break the app experience\n            // Since this is \"just\" persisted state that unfortunately got corrupted or partially lost\n            console.warn(\"Realm app hydration failed:\", err.message);\n        }\n    }\n    /**\n     * Get or create a singleton Realm App from an id.\n     * Calling this function multiple times with the same id will return the same instance.\n     *\n     * @param id The Realm App id visible from the MongoDB Realm UI or a configuration.\n     * @returns The Realm App instance.\n     */\n    static getApp(id) {\n        if (id in App.appCache) {\n            return App.appCache[id];\n        }\n        else {\n            const instance = new App(id);\n            App.appCache[id] = instance;\n            return instance;\n        }\n    }\n    /**\n     * Switch user.\n     *\n     * @param nextUser The user or id of the user to switch to.\n     */\n    switchUser(nextUser) {\n        const index = this.users.findIndex((u) => u === nextUser);\n        if (index === -1) {\n            throw new Error(\"The user was never logged into this app\");\n        }\n        // Remove the user from the stack\n        const [user] = this.users.splice(index, 1);\n        // Insert the user in the beginning of the stack\n        this.users.unshift(user);\n    }\n    /**\n     * Log in a user.\n     *\n     * @param credentials Credentials to use when logging in.\n     * @param fetchProfile Should the users profile be fetched? (default: true)\n     * @returns A promise resolving to the newly logged in user.\n     */\n    async logIn(credentials, fetchProfile = true) {\n        const response = await this.authenticator.authenticate(credentials);\n        const user = this.createOrUpdateUser(response, credentials.providerType);\n        // Let's ensure this will be the current user, in case the user object was reused.\n        this.switchUser(user);\n        // If neeeded, fetch and set the profile on the user\n        if (fetchProfile) {\n            await user.refreshProfile();\n        }\n        // Persist the user id in the storage,\n        // merging to avoid overriding logins from other apps using the same underlying storage\n        this.storage.setUserIds(this.users.map((u) => u.id), true);\n        // Read out and store the device id from the server\n        const deviceId = response.deviceId;\n        if (deviceId && deviceId !== \"000000000000000000000000\") {\n            this.storage.set(DEVICE_ID_STORAGE_KEY$1, deviceId);\n        }\n        // Return the user\n        return user;\n    }\n    /**\n     * @inheritdoc\n     */\n    async removeUser(user) {\n        // Remove the user from the list of users\n        const index = this.users.findIndex((u) => u === user);\n        if (index === -1) {\n            throw new Error(\"The user was never logged into this app\");\n        }\n        this.users.splice(index, 1);\n        // Log out the user - this removes access and refresh tokens from storage\n        await user.logOut();\n        // Remove the users profile from storage\n        this.storage.remove(`user(${user.id}):profile`);\n        // Remove the user from the storage\n        this.storage.removeUserId(user.id);\n    }\n    /**\n     * The currently active user (or null if no active users exists).\n     *\n     * @returns the currently active user or null.\n     */\n    get currentUser() {\n        const activeUsers = this.users.filter((user) => user.state === UserState.Active);\n        if (activeUsers.length === 0) {\n            return null;\n        }\n        else {\n            // Current user is the top of the stack\n            return activeUsers[0];\n        }\n    }\n    /**\n     * All active and logged-out users:\n     *  - First in the list are active users (ordered by most recent call to switchUser or login)\n     *  - Followed by logged out users (also ordered by most recent call to switchUser or login).\n     *\n     * @returns An array of users active or loggedout users (current user being the first).\n     */\n    get allUsers() {\n        // Returning a freezed copy of the list of users to prevent outside changes\n        return Object.fromEntries(this.users.map((user) => [user.id, user]));\n    }\n    /**\n     * @returns A promise of the app URL, with the app location resolved.\n     */\n    get locationUrl() {\n        if (!this._locationUrl) {\n            const path = routes.api().app(this.id).location().path;\n            this._locationUrl = this.fetcher\n                .fetchJSON({\n                method: \"GET\",\n                url: this.baseUrl + path,\n                tokenType: \"none\",\n            })\n                .then((body) => {\n                if (typeof body !== \"object\") {\n                    throw new Error(\"Expected response body be an object\");\n                }\n                else {\n                    return body;\n                }\n            })\n                .then(({ hostname }) => {\n                if (typeof hostname !== \"string\") {\n                    throw new Error(\"Expected response to contain a 'hostname'\");\n                }\n                else {\n                    return hostname;\n                }\n            })\n                .catch((err) => {\n                // Reset the location to allow another request to fetch again.\n                this._locationUrl = null;\n                throw err;\n            });\n        }\n        return this._locationUrl;\n    }\n    /**\n     * @returns Information about the current device, sent to the server when authenticating.\n     */\n    get deviceInformation() {\n        const deviceIdStr = this.storage.getDeviceId();\n        const deviceId = typeof deviceIdStr === \"string\" && deviceIdStr !== \"000000000000000000000000\"\n            ? new ObjectId(deviceIdStr)\n            : undefined;\n        return new DeviceInformation({\n            appId: this.localApp ? this.localApp.name : undefined,\n            appVersion: this.localApp ? this.localApp.version : undefined,\n            deviceId,\n        });\n    }\n    /**\n     * Create (and store) a new user or update an existing user's access and refresh tokens.\n     * This helps de-duplicating users in the list of users known to the app.\n     *\n     * @param response A response from the Authenticator.\n     * @param providerType The type of the authentication provider used.\n     * @returns A new or an existing user.\n     */\n    createOrUpdateUser(response, providerType) {\n        const existingUser = this.users.find((u) => u.id === response.userId);\n        if (existingUser) {\n            // Update the users access and refresh tokens\n            existingUser.accessToken = response.accessToken;\n            existingUser.refreshToken = response.refreshToken;\n            return existingUser;\n        }\n        else {\n            // Create and store a new user\n            if (!response.refreshToken) {\n                throw new Error(\"No refresh token in response from server\");\n            }\n            const user = new User({\n                app: this,\n                id: response.userId,\n                accessToken: response.accessToken,\n                refreshToken: response.refreshToken,\n                providerType,\n            });\n            this.users.unshift(user);\n            return user;\n        }\n    }\n    /**\n     * Restores the state of the app (active and logged-out users) from the storage\n     */\n    hydrate() {\n        const userIds = this.storage.getUserIds();\n        this.users = userIds.map((id) => new User({ app: this, id }));\n    }\n}\n/**\n * A map of app instances returned from calling getApp.\n */\nApp.appCache = {};\n/**\n * Instances of this class can be passed to the `app.logIn` method to authenticate an end-user.\n */\nApp.Credentials = Credentials;\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * Get or create a singleton Realm App from an id.\n * Calling this function multiple times with the same id will return the same instance.\n *\n * @param id The Realm App id visible from the MongoDB Realm UI or a configuration.\n * @returns The Realm App instance.\n */\nfunction getApp(id) {\n    return App.getApp(id);\n}\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * In-memory storage that will not be persisted.\n */\nclass LocalStorage {\n    /**\n     * Constructs a LocalStorage using the global window.\n     */\n    constructor() {\n        if (typeof globalThis.localStorage === \"object\") {\n            this.global = globalThis;\n        }\n        else {\n            throw new Error(\"Cannot use LocalStorage without a global localStorage object\");\n        }\n    }\n    /** @inheritdoc */\n    get(key) {\n        return this.global.localStorage.getItem(key);\n    }\n    /** @inheritdoc */\n    set(key, value) {\n        return this.global.localStorage.setItem(key, value);\n    }\n    /** @inheritdoc */\n    remove(key) {\n        return this.global.localStorage.removeItem(key);\n    }\n    /** @inheritdoc */\n    prefix(keyPart) {\n        return new PrefixedStorage(this, keyPart);\n    }\n    /** @inheritdoc */\n    clear(prefix) {\n        const keys = [];\n        // Iterate all keys to find the once have a matching prefix.\n        for (let i = 0; i < this.global.localStorage.length; i++) {\n            const key = this.global.localStorage.key(i);\n            if (key && (!prefix || key.startsWith(prefix))) {\n                keys.push(key);\n            }\n        }\n        // Remove the items in a seperate loop to avoid updating while iterating.\n        for (const key of keys) {\n            this.global.localStorage.removeItem(key);\n        }\n    }\n    /** @inheritdoc */\n    addListener(listener) {\n        return this.global.addEventListener(\"storage\", listener);\n    }\n    /** @inheritdoc */\n    removeListener(listener) {\n        return this.global.removeEventListener(\"storage\", listener);\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\nconst browser = detect();\nconst DefaultStorage = \"localStorage\" in globalThis ? LocalStorage : MemoryStorage;\n/**\n * Attempt to use the browser to open a window\n *\n * @param url The url to open a window to.\n * @returns Then newly create window.\n */\nfunction openWindow(url) {\n    if (typeof globalThis.open === \"function\") {\n        return globalThis.open(url);\n    }\n    else {\n        console.log(`Please open ${url}`);\n        return null;\n    }\n}\nconst environment$1 = {\n    defaultStorage: new DefaultStorage().prefix(\"realm-web\"),\n    openWindow,\n    platform: (browser === null || browser === void 0 ? void 0 : browser.name) || \"web\",\n    platformVersion: (browser === null || browser === void 0 ? void 0 : browser.version) || \"0.0.0\",\n    TextDecoder,\n};\nsetEnvironment(environment$1);\n/**\n * Handle an OAuth 2.0 redirect.\n *\n * @param location An optional location to use (defaults to the windows current location).\n * @param storage Optional storage used to save any results from the location.\n */\nfunction handleAuthRedirect(location = globalThis.location, storage = environment$1.defaultStorage) {\n    try {\n        const queryString = location.hash.substr(1); // Strip the initial # from the hash\n        OAuth2Helper.handleRedirect(queryString, storage);\n    }\n    catch (err) {\n        // Ensure calling this never throws: It should not interrupt a users flow.\n        console.warn(err);\n    }\n}\n\nexport { App, Credentials, DEFAULT_BASE_URL, LocalStorage, MongoDBRealmError, User, UserState, UserType$1 as UserType, getApp, getEnvironment, handleAuthRedirect, setEnvironment };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}